{"version":3,"sources":["webpack:///./src/gtw-ui-tab-navigation.js","webpack:///./src/gtw-ui-select-location.js"],"names":["fromPos","fromName","toPos","toName","async","enable","fromPrepend","$","i18n","fromPlaceholder","toPrepend","toPlaceholder","tabPanelHtml","html","currentLoc","posToName","val","on","pos","selectFromLocation","selectToLocation","disable","console","log","nearbyStops","lat","lng","length","localizedName","stop","Math","round","selectedLocation","marker","eventCenterChgListener","select","text","selectedListener","backListener","EVENT_MAP_CENTER_CHANGED","center","loc","css","EVENT_LOCATION_SELECTED","show","Promise","resolve","reject","EVENT_UI_BACK"],"mappings":"0FAAA,6IAMIA,GAAU,EACVC,GAAW,EACXC,GAAQ,EACRC,GAAS,EAENC,eAAeC,IAClB,IAAIC,EAAcC,EAAEC,KAAK,gCACrBC,EAAkBF,EAAEC,KAAK,+BACzBE,EAAYH,EAAEC,KAAK,8BACnBG,EAAgBJ,EAAEC,KAAK,6BACvBI,EACA,0IAEwEN,EAAc,uHAEuBG,EAAkB,iBAAqBA,EAAkB,0LAIhGC,EAAY,qHAEyBC,EAAgB,iBAAqBA,EAAgB,wDAKpK,GAFAJ,EAAE,cAAcM,KAAKD,GAEjB,MAAiB,CACjB,IAAIE,EAAa,MACjBd,EAAUc,EACVb,QAAiBc,EAAUD,GAC3BP,EAAE,wBAAwBS,IAAIf,GAGlCM,EAAE,wBAAwBU,GAAG,SAAS,YAS1Cb,iBACQJ,GACA,IAAcA,GAElB,IAAIkB,QAAY,MACZA,IACAlB,EAAUkB,EACVjB,QAAiBc,EAAUG,GAC3BX,EAAE,wBAAwBS,IAAIf,IAhB9BkB,MAGJZ,EAAE,sBAAsBU,GAAG,SAAS,YAiBxCb,iBACQF,GACA,IAAcA,GAElB,IAAIgB,QAAY,MACZA,IACAhB,EAAQgB,EACRf,QAAeY,EAAUG,GACzBX,EAAE,sBAAsBS,IAAIb,IAxB5BiB,MA4BD,SAASC,IACfC,QAAQC,IAAI,gBAGbnB,eAAeW,EAAUG,GACrB,IAAIM,QAAoB,IAAuBN,EAAIO,IAAKP,EAAIQ,IAAK,GAAG,GACpE,GAAIF,EAAYG,OAAS,EAAG,CACxB,IAAIC,EAAgB,eAAkBJ,EAAY,GAAGK,KAAM,aAC3D,OAAO,IAA+BD,GAEtC,OAAQE,KAAKC,MAAgB,IAAVb,EAAIO,KAAkB,IAAY,KAAQK,KAAKC,MAAgB,IAAVb,EAAIQ,KAAkB,M,mDClFtG,wEAIIM,GAAmB,EACnBC,GAAS,EACTC,GAAyB,EA6CtB9B,eAAe+B,EAAOC,GAEzB,IAAIC,EACAC,GA9CR,SAAcF,GACVJ,GAAmB,EAEnB,MACA,MAEIE,IACA,IAAqB,IAAaK,yBAA0BL,GAC5DA,GAAyB,GAG7B,IAAIM,EAAS,MACbP,EAAS,IAAcO,GACvB,IAAkB,IAAaD,yBAA0BL,EAAyB,SAASO,GACvF,IAAsBR,EAAQQ,KAGlClC,EAAE,mBAAmBmC,IAAI,UAAW,QACpCnC,EAAE,qBAAqBmC,IAAI,UAAW,QACtCnC,EAAE,2BAA2BmC,IAAI,SAAU,OAC3CnC,EAAE,wBAAwBM,KAAK,IAE1BuB,IACDA,EAAO7B,EAAEC,KAAK,sCAGlB,IAAII,EACA,gDAC2BwB,EAAO,yFACyD7B,EAAEC,KAAK,iDAAmD,kBAGzJD,EAAE,wBAAwBM,KAAKD,GAE/BL,EAAE,0BAA0BU,GAAG,SAAS,WACpCe,EAAmB,MACnB,IAAoB,IAAaW,wBAAyBX,GAC1D,SAGJ,MAIAY,CAAKR,GAGL,IAAIpB,QAAY,IAAI6B,QAAQ,CAACC,EAASC,KAClC,IAAkB,IAAaJ,wBAAyBN,EAAmB,SAAUI,GACjFK,EAAQL,KAEZ,IAAkB,IAAaO,cAAeV,EAAe,WACzDQ,GAAQ,OAQhB,OALA,IAAqB,IAAaH,wBAAyBN,GAC3D,IAAqB,IAAaW,cAAeV,GACjD,IAAqB,IAAaC,yBAA0BL,GAC5DA,GAAyB,EACzB,IAAiBD,GACVjB,K","file":"1.c91737d578c4a03c20ca.js","sourcesContent":["import * as selectLoc from './gtw-ui-select-location';\r\nimport * as Loc from './gtw-location';\r\nimport * as gtfs from './gtw-citydata-transit-gtfs';\r\nimport * as Lang from './gtw-lang';\r\nimport * as Map from './gtw-map';\r\n\r\nvar fromPos = false;\r\nvar fromName = false;\r\nvar toPos = false;\r\nvar toName = false;\r\n\r\nexport async function enable() {\r\n    var fromPrepend = $.i18n(\"location-from-location-short\");\r\n    var fromPlaceholder = $.i18n(\"location-from-location-long\");\r\n    var toPrepend = $.i18n(\"location-to-location-short\");\r\n    var toPlaceholder = $.i18n(\"location-to-location-long\");\r\n    var tabPanelHtml =\r\n        \"<div class=\\\"input-group mt-2 mb-2\\\">\" +\r\n        \"    <div class=\\\"input-group-prepend\\\">\" +\r\n        \"        <span class=\\\"input-group-text\\\" id=\\\"from-location-text\\\">\" + fromPrepend + \"</span>\" +\r\n        \"    </div>\" +\r\n        \"    <input type=\\\"text\\\" class=\\\"form-control select-location-field from-location-field\\\" placeholder=\\\"\" + fromPlaceholder + \"\\\" aria-label=\\\"\" + fromPlaceholder + \"\\\" aria-describedby=\\\"from-location-text\\\" readonly>\" +\r\n        \"</div>\" +\r\n        \"<div class=\\\"input-group mb-2\\\">\" +\r\n        \"    <div class=\\\"input-group-prepend\\\">\" +\r\n        \"        <span class=\\\"input-group-text\\\" id=\\\"to-location-text\\\">\" + toPrepend + \"</span>\" +\r\n        \"    </div>\" +\r\n        \"    <input type=\\\"text\\\" class=\\\"form-control select-location-field to-location-field\\\" placeholder=\\\"\" + toPlaceholder + \"\\\" aria-label=\\\"\" + toPlaceholder + \"\\\" aria-describedby=\\\"to-location-text\\\" readonly>\" +\r\n        \"</div>\"\r\n        ;\r\n    $(\".tab-panel\").html(tabPanelHtml);\r\n\r\n    if (Loc.isLocated()) {\r\n        var currentLoc = Loc.getCurrentPosition();\r\n        fromPos = currentLoc;\r\n        fromName = await posToName(currentLoc);\r\n        $(\".from-location-field\").val(fromName);\r\n    }\r\n\r\n    $(\".from-location-field\").on(\"click\", function () {\r\n        selectFromLocation();\r\n    });\r\n\r\n    $(\".to-location-field\").on(\"click\", function () {\r\n        selectToLocation();\r\n    });\r\n}\r\n\r\nasync function selectFromLocation() {\r\n    if (fromPos) {\r\n        Map.setCenter(fromPos);\r\n    }\r\n    var pos = await selectLoc.select();\r\n    if (pos) {\r\n        fromPos = pos;\r\n        fromName = await posToName(pos);\r\n        $(\".from-location-field\").val(fromName);\r\n    }\r\n}\r\n\r\nasync function selectToLocation() {\r\n    if (toPos) {\r\n        Map.setCenter(toPos);\r\n    }\r\n    var pos = await selectLoc.select();\r\n    if (pos) {\r\n        toPos = pos;\r\n        toName = await posToName(pos);\r\n        $(\".to-location-field\").val(toName);\r\n    }\r\n}\r\n\r\nexport function disable(){\r\n\tconsole.log(\"Call disable\");\r\n}\r\n\r\nasync function posToName(pos) {\r\n    var nearbyStops = await gtfs.searchNearbyStops(pos.lat, pos.lng, 1, true);\r\n    if (nearbyStops.length > 0) {\r\n        var localizedName = Lang.localizedKey(nearbyStops[0].stop, \"stop_name\");\r\n        return gtfs.selectFirstAgencyStopName(localizedName);\r\n    } else {\r\n        return (Math.round(pos.lat * 10000000) / 10000000) + \", \" + (Math.round(pos.lng * 10000000) / 10000000);\r\n    }\r\n}","import * as UI from './gtw-ui';\r\nimport * as Map from './gtw-map';\r\nimport * as Event from './gtw-event';\r\n\r\nvar selectedLocation = false;\r\nvar marker = false;\r\nvar eventCenterChgListener = false;\r\n\r\nfunction show(text) {\r\n    selectedLocation = false;\r\n\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n\r\n    if (eventCenterChgListener) {\r\n        Event.removeListener(Event.EVENTS.EVENT_MAP_CENTER_CHANGED, eventCenterChgListener);\r\n        eventCenterChgListener = false;\r\n    }\r\n\r\n    var center = Map.getCenter();\r\n    marker = Map.addMarker(center);\r\n    Event.addListener(Event.EVENTS.EVENT_MAP_CENTER_CHANGED, eventCenterChgListener = function(loc) {\r\n        Map.setMarkerPosition(marker, loc);\r\n    });\r\n\r\n    $(\".ui-pull-up-btn\").css(\"display\", \"none\");\r\n    $(\".ui-pull-down-btn\").css(\"display\", \"none\");\r\n    $(\".mobile-split-container\").css(\"height\", \"20%\");\r\n    $(\".split-map-container\").html(\"\");\r\n\r\n    if (!text) {\r\n        text = $.i18n(\"location-move-to-desired-location\");\r\n    }\r\n\r\n    var tabPanelHtml =\r\n        \"<div class=\\\"text-center\\\">\" +\r\n        \"    <p class=\\\"lead\\\">\" + text + \"</p>\" +\r\n        \"    <button class=\\\"btn btn-block btn-success location-move-confirm\\\" type=\\\"button\\\">\" + $.i18n(\"location-move-to-desired-location-confirm-btn\") + \"</button>\" +\r\n        \"</div>\"\r\n        ;\r\n    $(\".split-map-tab-panel\").html(tabPanelHtml);\r\n\r\n    $(\".location-move-confirm\").on(\"click\", function () {\r\n        selectedLocation = Map.getCenter();\r\n        Event.dispatchEvent(Event.EVENTS.EVENT_LOCATION_SELECTED, selectedLocation);\r\n        UI.showPanel();\r\n    });\r\n\r\n    UI.hidePanel();\r\n}\r\n\r\nexport async function select(text) {\r\n    show(text);\r\n    var selectedListener;\r\n    var backListener;\r\n    var val = await new Promise((resolve, reject) => {\r\n        Event.addListener(Event.EVENTS.EVENT_LOCATION_SELECTED, selectedListener = function (loc) {\r\n            resolve(loc);\r\n        });\r\n        Event.addListener(Event.EVENTS.EVENT_UI_BACK, backListener = function () {\r\n            resolve(false);\r\n        });\r\n    });\r\n    Event.removeListener(Event.EVENTS.EVENT_LOCATION_SELECTED, selectedListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_UI_BACK, backListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_MAP_CENTER_CHANGED, eventCenterChgListener);\r\n    eventCenterChgListener = false;\r\n    Map.removeMarker(marker);\r\n    return val;\r\n}\r\n\r\nexport function getSelectedLocation() {\r\n    return selectedLocation;\r\n}"],"sourceRoot":""}