{"version":3,"sources":["webpack:///./src/gtw-ui-touchkeypad.js","webpack:///./src/gtw-ui-tab-transit.js"],"names":["onClickListeners","mouseClickTouchKeypadValue","$","this","hasClass","listener","reset","each","removeClass","addClass","showTouchKeypad","css","adjustMargin","hideTouchKeypad","addListener","push","removeListener","index","indexOf","splice","setEnabled","keyMap","val","html","keys","Object","sort","a","b","charCodeAt","letterKeypadHtml","key","on","searchTimeout","updateStopEtaTimer","updateEtaTimer","allNearbyRoutes","maxRequest","touchKeypadListener","eventUiBackListener","eventLocChgListener","lastLat","lastLng","fromSearch","attr","filterProviderSort","listNodeCss","provider","length","searchRoutes","i","path","lastStop","t","routes","len","foundList","doNotShow","stopId","route","console","log","Date","now","paths","bound","j","mid","midVal","compare","indexesList","routeName","value","substr","routeIndex","pathIndex","localeCompare","start","end","Math","floor","availableKeypads","charAt","id","routeId","i18n","mouseEnterPreviewRoute","mouseClickSelectRoute","resetProviderSort","clearSearch","drawRouteOnMap","pos","dbStop","coords","lat","lng","title","stopName","label","parent","getRouteById","stop","pathStop","distance","nearestDistance","nearestStop","showRouteList","scroll","x","lastStopId","screen","width","node","icon","children","scrollIntoView","targetPos","clearInterval","func","content","p","etaProviders","selectedPath","parseInt","then","data","h","options","code","schedules","active","schedule","eta","time","serverTime","error","colspan","undefined","msg","isLive","getHours","getMinutes","catch","err","showStopEta","setInterval","sstop","latlngs","parseFloat","updateEta","requestLen","fadeIn","max","fadeOut","result","text","badgeClass","calcEta","badge","findNearbyRoutes","range","allNearbyStops","testRange","append","ceil","maxNearbyBusDisplay","stopResult","routeResults","routeResult","round","enable","obj","searchText","slice","EVENT_UI_BACK","EVENT_LOCATION_CHANGE","newLoc","providers","buttonScroll","iprovider","image","type","TransitType","BUS","TRAIN","searchField","removeAttr","clearTimeout","setTimeout","disable"],"mappings":"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","file":"1.49bd390841558969bedc.js","sourcesContent":["var onClickListeners = [];\r\n\r\n$(\".touch-keypad-function-clear\").on(\"click\", mouseClickTouchKeypadValue);\r\n$(\".touch-keypad-function-backspace\").on(\"click\", mouseClickTouchKeypadValue);\r\n$(\".touch-keypad-value\").on(\"click\", mouseClickTouchKeypadValue);\r\n\r\nfunction mouseClickTouchKeypadValue() {\r\n    if ($(this).hasClass(\"disabled\")) {\r\n        return;\r\n    }\r\n    for (var listener of onClickListeners) {\r\n        listener(this);\r\n    }\r\n}\r\n\r\nexport function reset() {\r\n    $(\".numeric-keypad .touch-keypad-value\").each(function () {\r\n        $(this).removeClass(\"disabled\");\r\n        $(this).removeClass(\"btn-secondary\");\r\n        $(this).addClass(\"btn-outline-secondary\");\r\n    });\r\n}\r\n\r\nexport function showTouchKeypad() {\r\n    $(\".touch-keypad\").css(\"display\", \"flex\");\r\n    adjustMargin();\r\n}\r\n\r\nexport function hideTouchKeypad() {\r\n    $(\".touch-keypad\").css(\"display\", \"\");\r\n    adjustMargin();\r\n}\r\n\r\nexport function addListener(listener) {\r\n    if (typeof listener !== \"function\") {\r\n        return false;\r\n    }\r\n    onClickListeners.push(listener);\r\n    return true;\r\n}\r\n\r\nexport function removeListener(listener) {\r\n    if (typeof listener !== \"function\") {\r\n        return false;\r\n    }\r\n    var index = onClickListeners.indexOf(listener);\r\n    if (index !== -1) {\r\n        onClickListeners.splice(index, 1);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function setEnabled(keyMap) {\r\n    $(\".numeric-keypad .touch-keypad-value\").each(function () {\r\n        var val = $(this).html();\r\n        if (!keyMap[val]) {\r\n            $(this).addClass(\"disabled\");\r\n            $(this).addClass(\"btn-secondary\");\r\n            $(this).removeClass(\"btn-outline-secondary\");\r\n        } else {\r\n            $(this).removeClass(\"disabled\");\r\n            $(this).removeClass(\"btn-secondary\");\r\n            $(this).addClass(\"btn-outline-secondary\");\r\n        }\r\n        delete keyMap[val];\r\n    });\r\n\r\n    var keys = Object.keys(keyMap);\r\n    keys.sort(function (a, b) {\r\n        return a.charCodeAt(0) - b.charCodeAt(0);\r\n    });\r\n\r\n    var letterKeypadHtml = \"\";\r\n    for (var key of keys) {\r\n        letterKeypadHtml += \"<button type=\\\"button\\\" class=\\\"btn btn-outline-secondary py-3 touch-keypad-key touch-keypad-value\\\">\" + key + \"</button>\";\r\n    }\r\n    $(\".letter-keypad\").html(letterKeypadHtml);\r\n\r\n    $(\".letter-keypad .touch-keypad-value\").on(\"click\", mouseClickTouchKeypadValue);\r\n}","import * as Transit from './gtw-citydata-transit';\r\nimport * as TransitRoutes from './gtw-citydata-transit-routes';\r\nimport * as TransitStops from './gtw-citydata-transit-stops';\r\nimport * as TransitEta from './gtw-citydata-transit-eta';\r\nimport * as RequestLimiter from './gtw-requestlimiter';\r\nimport * as Settings from './gtw-settings';\r\nimport * as Misc from './gtw-misc';\r\nimport * as Lang from './gtw-lang';\r\nimport * as Loc from './gtw-location';\r\nimport * as TouchKeypad from './gtw-ui-touchkeypad';\r\nimport * as Event from './gtw-event';\r\nimport * as UI from './gtw-ui';\r\nimport * as Map from './gtw-map';\r\n\r\nvar searchTimeout;\r\nvar updateStopEtaTimer;\r\nvar updateEtaTimer;\r\nvar allNearbyRoutes;\r\nvar maxRequest;\r\nvar touchKeypadListener;\r\nvar eventUiBackListener;\r\nvar eventLocChgListener;\r\nvar lastLat = false;\r\nvar lastLng = false;\r\nvar fromSearch = false;\r\n\r\nfunction showTouchKeypad() {\r\n    $(\"#search-transit-text\").removeAttr(\"readonly\");\r\n    TouchKeypad.showTouchKeypad();\r\n}\r\n\r\nfunction hideTouchKeypad() {\r\n    $(\"#search-transit-text\").attr(\"readonly\", \"readonly\");\r\n    TouchKeypad.hideTouchKeypad();\r\n}\r\n\r\nfunction showSearchRoutes() {\r\n    $(\"#button-cancel-search\").removeClass(\"btn-light\");\r\n    $(\"#button-cancel-search\").removeClass(\"disabled\");\r\n    $(\"#button-cancel-search\").addClass(\"btn-danger\");\r\n    $(\"#button-cancel-search\").html(\"<i class=\\\"fas fa-times\\\"></i>\");\r\n\r\n    $(\".nearby-route-list\").css(\"display\", \"none\");\r\n    $(\".all-route-list\").css(\"display\", \"flex\");\r\n    Map.setCenter(Loc.getCurrentPosition());\r\n    Map.setZoom(16);\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n    searchRoutes();\r\n    resetProviderSort();\r\n    filterProviderSort(\".all-route-list\");\r\n}\r\n\r\nfunction hideSearchRoutes() {\r\n    $(\"#button-cancel-search\").addClass(\"btn-light\");\r\n    $(\"#button-cancel-search\").addClass(\"disabled\");\r\n    $(\"#button-cancel-search\").removeClass(\"btn-danger\");\r\n    $(\"#button-cancel-search\").html(\"<i class=\\\"fas fa-search\\\"></i>\");\r\n\r\n    $(\".nearby-route-list\").css(\"display\", \"flex\");\r\n    $(\".all-route-list\").css(\"display\", \"none\");\r\n\r\n    Map.setCenter(Loc.getCurrentPosition());\r\n    Map.setZoom(16);\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n\r\n    resetProviderSort();\r\n    filterProviderSort(\".nearby-route-list\");\r\n}\r\n\r\nfunction filterProviderSort(listNodeCss) {\r\n    $(\".gtw-providersort-provider\").each(function () {\r\n        var provider = $(this).attr(\"gtw-provider\");\r\n        var contain = $(listNodeCss + \" .route-selection[gtw-provider='\" + provider + \"']\").length > 0;\r\n        if (contain) {\r\n            $(this).css(\"display\", \"\");\r\n        } else {\r\n            $(this).css(\"display\", \"none\");\r\n        }\r\n    });\r\n}\r\n\r\nfunction searchRoutes() {\r\n    var val = $(\"#search-transit-text\").val();\r\n    var useKeypad = true;\r\n    if (!useKeypad) {\r\n        clearSearch();\r\n        return;\r\n    }\r\n\r\n    var routes = TransitRoutes.getAllRoutes();\r\n\r\n    var len = val.length;\r\n\r\n    var foundList = [];\r\n\r\n    var i;\r\n    var provider;\r\n    var route;\r\n    var path;\r\n    var lastStop;\r\n    var doNotShow = false;\r\n\r\n    var t;\r\n    if (len === 0) {\r\n        doNotShow = true;\r\n        console.log(\"No query input.\");\r\n        t = Date.now();\r\n        var stopId;\r\n        for (var route of routes) {\r\n            provider = TransitRoutes.getProvider(route.provider);\r\n            for (i = 0; i < route.paths.length; i++) {\r\n                path = route.paths[i];\r\n                stopId = path[path.length - 1];\r\n                lastStop = TransitStops.getStopById(stopId);\r\n                foundList.push({\r\n                    provider: provider,\r\n                    route: route,\r\n                    lastStop: lastStop,\r\n                    bound: i\r\n                });\r\n            }\r\n        }\r\n        console.log(\"AllRoutesArrayBuild used \" + (Date.now() - t) + \" ms\");\r\n    } else {\r\n        t = Date.now();\r\n        var j;\r\n        var indexesList = [];\r\n        for (i = 0; i < routes.length; i++) {\r\n            routeName = Lang.localizedKey(routes[i], \"routeName\");\r\n            if (routeName.length >= len) {\r\n                for (j = 0; j < routes[i].paths.length; j++) {\r\n                    indexesList.push({\r\n                        value: routeName.substr(0, len),\r\n                        routeIndex: i,\r\n                        pathIndex: j\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        console.log(\"SearchRoutesArrayBuild used \" + (Date.now() - t) + \" ms\");\r\n\r\n        t = Date.now();\r\n        indexesList.sort(function (a, b) {\r\n            return a.value.localeCompare(b.value);//Misc.stringCompare(a.value, b.value);\r\n        });\r\n        console.log(\"SortArray used \" + (Date.now() - t) + \" ms\");\r\n\r\n        var mid;\r\n        var midVal;\r\n        var compare;\r\n        var start = 0;\r\n        var end = indexesList.length - 1;\r\n\r\n        t = Date.now();\r\n        while (start < end) {\r\n            mid = Math.floor((start + end) / 2);\r\n            midVal = indexesList[mid];\r\n            compare = val.localeCompare(midVal.value);//Misc.stringCompare(val, midVal.value);\r\n\r\n            if (compare === 0) {\r\n                end = mid;\r\n            } else if (compare > 0) {\r\n                start = mid + 1;\r\n            } else {\r\n                end = mid - 1;\r\n            }\r\n        }\r\n        console.log(\"Search used \" + (Date.now() - t) + \" ms\");\r\n\r\n        var u;\r\n        if (indexesList[start].value === val) {\r\n            t = Date.now();\r\n            var index;\r\n            for (i = start; i < indexesList.length; i++) {\r\n                index = indexesList[i];\r\n\r\n                if (index.value !== val) {\r\n                    break;\r\n                }\r\n\r\n                route = routes[index.routeIndex];\r\n                provider = TransitRoutes.getProvider(route.provider);\r\n                path = route.paths[index.pathIndex];\r\n                lastStop = TransitStops.getStopById(path[path.length - 1]);\r\n                \r\n                foundList.push({\r\n                    provider: provider,\r\n                    route: routes[index.routeIndex],\r\n                    lastStop: lastStop,\r\n                    bound: index.pathIndex\r\n                });\r\n            }\r\n            console.log(\"Found list build used \" + (Date.now() - t) + \" ms\");\r\n        }\r\n    }\r\n\r\n    var html = \"<ul class=\\\"list-group\\\">\";\r\n\r\n    t = Date.now();\r\n    var routeName;\r\n    var availableKeypads = {};\r\n    for (i = 0; i < foundList.length; i++) {\r\n        routeName = Lang.localizedKey(foundList[i].route, \"routeName\");\r\n\r\n        if (val.length < routeName.length) {\r\n            var letter = routeName.charAt(val.length);\r\n            availableKeypads[letter] = true;\r\n        }\r\n\r\n        if (!doNotShow) {\r\n            html +=\r\n                \"<li class=\\\"list-group-item list-group-item-action d-flex align-items-center route-selection\\\" gtw-provider=\\\"\" + foundList[i].provider.id + \"\\\" gtw-route-id=\\\"\" + foundList[i].route.routeId + \"\\\" gtw-bound=\\\"\" + foundList[i].bound + \"\\\">\" +\r\n                \"    <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n                \"        <div>\" + Lang.localizedKey(foundList[i].provider, \"name\") + \"</div>\" +\r\n                \"        <div>\" + routeName + \"</div>\" +\r\n                \"    </div>\" +\r\n                \"    <div><b>\" + $.i18n(\"transit-eta-to\") + \":</b> \" + Lang.localizedKey(foundList[i].lastStop, \"stopName\") + \"</div>\" +\r\n                \"</li>\";\r\n        }\r\n    }\r\n    console.log(\"HTML build used \" + (Date.now() - t) + \" ms\");\r\n\r\n    html += \"</ul>\";\r\n    $(\".all-route-list\").html(html);\r\n\r\n    TouchKeypad.setEnabled(availableKeypads);\r\n\r\n    $(\".all-route-list .route-selection\").on(\"mouseenter\", mouseEnterPreviewRoute);\r\n    $(\".all-route-list .route-selection\").on(\"click\", mouseClickSelectRoute);\r\n\r\n    //$(\".all-route-list .route-selection:nth-child(1)\").mouseenter();\r\n\r\n    filterProviderSort(\".all-route-list\");\r\n}\r\n\r\nfunction resetProviderSort() {\r\n    $(\".gtw-providersort\").removeClass(\"btn-primary\");\r\n    $(\".gtw-providersort-all\").addClass(\"btn-primary\");\r\n\r\n    //$(\".gtw-providersort-provider\").addClass(\"btn-default\");\r\n    $(\".route-selection\").attr(\"style\", \"\");\r\n}\r\n\r\nfunction clearSearch() {\r\n    hideTouchKeypad();\r\n    $(\"#search-transit-text\").val(\"\");\r\n    hideSearchRoutes();\r\n    TouchKeypad.reset();\r\n}\r\n\r\nfunction drawRouteOnMap(route, bound) {\r\n    var path = route.paths[bound];\r\n\r\n    var coords = [];\r\n    var pos;\r\n    var dbStop;\r\n    var i;\r\n    for (i = 0; i < path.length; i++) {\r\n        console.log(\"Finding stop \" + path[i])\r\n        dbStop = TransitStops.getStopById(path[i]);\r\n        console.log(\"DBSTOP \" + i);\r\n        console.log(dbStop);\r\n        pos = { lat: dbStop.lat, lng: dbStop.lng };\r\n        coords.push(pos);\r\n        Map.addMarker(pos, {\r\n            title: dbStop.stopName,\r\n            label: \"\" + (i + 1)\r\n        });\r\n    }\r\n    console.log(coords);\r\n    Map.addPolyline(coords, \"#FF0000\", 2);\r\n}\r\n\r\nfunction mouseClickSelectRoute() {\r\n    fromSearch = $(this).parent().parent().hasClass(\"all-route-list\");\r\n\r\n    UI.hidePanel();\r\n    hideTouchKeypad();\r\n\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n\r\n    var provider = TransitRoutes.getProvider($(this).attr(\"gtw-provider\"));\r\n    var route = provider.getRouteById($(this).attr(\"gtw-route-id\"));\r\n    var stop = TransitStops.getStopById($(this).attr(\"gtw-stop-id\"));\r\n    var bound = $(this).attr(\"gtw-bound\");\r\n\r\n    if (!stop) {\r\n        var pos = Loc.getCurrentPosition();\r\n        var path = route.paths[bound];\r\n        var pathStop;\r\n        var distance;\r\n        var nearestDistance = false;\r\n        var nearestStop = false;\r\n        for (var stopId of path) {\r\n            pathStop = TransitStops.getStopById(stopId);\r\n            distance = Misc.geoDistance(pathStop.lat, pathStop.lng, pos.lat, pos.lng);\r\n            if (!nearestDistance || !nearestStop || distance < nearestDistance) {\r\n                nearestDistance = distance;\r\n                nearestStop = pathStop;\r\n            }\r\n        }\r\n\r\n        console.log(nearestDistance);\r\n        if (nearestDistance <= 2) {\r\n            stop = nearestStop;\r\n        }\r\n    }\r\n\r\n    showRouteList(route, bound, stop, true);\r\n    drawRouteOnMap(route, bound);\r\n}\r\n\r\nfunction mouseEnterPreviewRoute() {\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n    var provider = TransitRoutes.getProvider($(this).attr(\"gtw-provider\"));\r\n    var route = provider.getRouteById($(this).attr(\"gtw-route-id\"));\r\n    var sstop = TransitStops.getStopById($(this).attr(\"gtw-stop-id\"));\r\n    var bound = $(this).attr(\"gtw-bound\");\r\n    drawRouteOnMap(route, bound);\r\n\r\n    if (sstop) {\r\n        var targetPos = { lat: sstop.lat, lng: sstop.lng };\r\n        Map.setCenter(targetPos);\r\n        Map.setZoom(18);\r\n    } else {\r\n        var path = route.paths[bound];\r\n\r\n        var latlngs = [];\r\n        var stop;\r\n        for (var stopId of path) {\r\n            stop = TransitStops.getStopById(stopId);\r\n            latlngs.push({ lat: parseFloat(stop.lat), lng: parseFloat(stop.lng) });\r\n        }\r\n        Map.fitBounds(latlngs);\r\n    }\r\n}\r\n\r\nfunction showRouteList(route, bound, stop = false, scroll = false) {\r\n    var html = \"<div class=\\\"row\\\" style=\\\"padding: 2%;\\\"><div class=\\\"timeline-centered\\\">\";\r\n    var path = route.paths[bound];\r\n    var dbStop;\r\n    var i;\r\n    for (i = 0; i < path.length; i++) {\r\n        dbStop = TransitStops.getStopById(path[i]);\r\n        html +=\r\n            \"<article class=\\\"timeline-entry\\\" stop-id=\\\"\" + dbStop.stopId + \"\\\" stop-index=\\\"\" + i + \"\\\">\" +\r\n            \"    <div class=\\\"timeline-entry-inner\\\">\" +\r\n            \"        <div class=\\\"timeline-icon bg-light\\\">\" +\r\n            \"            \" + (i + 1) +\r\n            \"        </div>\" +\r\n            \"        <div class=\\\"timeline-label\\\">\" +\r\n            \"            <h2><button style=\\\"padding: 0px;\\\" class=\\\"btn btn-link\\\" stop-id=\\\"\" + dbStop.stopId + \"\\\">\" + Lang.localizedKey(dbStop, \"stopName\") + \"</button></h2>\" +\r\n            \"            <p></p>\" +\r\n            \"        </div>\" +\r\n            \"    </div>\" +\r\n            \"</article>\"\r\n            ;\r\n    }\r\n    html += \"</div></div>\";\r\n    $(\".half-map-container\").html(html);\r\n\r\n    $(\".half-map-container button\").on(\"click\", function () {\r\n        var x = TransitStops.getStopById($(this).attr(\"stop-id\"));\r\n        if (x) {\r\n            showRouteList(route, bound, x);\r\n        }\r\n    });\r\n\r\n    var provider = TransitRoutes.getProvider(route.provider);\r\n    var lastStopId = path[path.length - 1];\r\n    html =\r\n        \"<ul class=\\\"list-group\\\"><li class=\\\"list-group-item d-flex align-items-center route-selection\\\">\" +\r\n        \"    <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n        \"        <div>\" + Lang.localizedKey(provider, \"name\") + \"</div>\" +\r\n        \"        <div>\" + Lang.localizedKey(route, \"routeName\") + \"</div>\" +\r\n        \"    </div>\" +\r\n        \"    <div><b>\" + $.i18n(\"transit-eta-to\") + \":</b> \" + Lang.localizedKey(TransitStops.getStopById(lastStopId), \"stopName\") + \"</div>\" +\r\n        \"</li></ul>\"\r\n        ;\r\n    $(\".half-map-tab-panel\").html(html);\r\n\r\n    adjustMargin();\r\n    if (stop) {\r\n        var parent = screen.width >= 768 ? \".desktop\" : \".mobile\";\r\n\r\n        var node = $(parent + \" .timeline-entry[stop-id='\" + stop.stopId + \"']\");\r\n\r\n        var icon = node.children().children(\".timeline-icon\");\r\n        icon.removeClass(\"bg-light\");\r\n        icon.addClass(\"bg-primary\");\r\n\r\n        if (scroll) {\r\n            node[0].scrollIntoView();\r\n        }\r\n\r\n        var targetPos = { lat: stop.lat, lng: stop.lng };\r\n\r\n        Map.setCenter(targetPos);\r\n        Map.setZoom(18);\r\n\r\n        clearInterval(updateStopEtaTimer);\r\n        var func = function () {\r\n            showStopEta(route, bound, stop);\r\n        };\r\n        func();\r\n        updateStopEtaTimer = setInterval(func, 30000);\r\n    }\r\n}\r\n\r\nfunction showStopEta(route, bound, stop) {\r\n    var node = $(\".timeline-entry[stop-id='\" + stop.stopId + \"'] p\");\r\n\r\n    var content =\r\n        \"<p><u>\" + $.i18n(\"transit-eta\") + \"</u></p>\" +\r\n        \"<table class=\\\"table stop-eta\\\">\"\r\n        ;\r\n\r\n    var p = TransitEta.fetchEta({\r\n        provider: route.provider,\r\n        etaProviders: route.etaProviders,\r\n        routeId: route.routeId,\r\n        selectedPath: parseInt(bound),\r\n        stopId: stop.stopId\r\n    });\r\n    if (!p) {\r\n        content +=\r\n            \"<tr class=\\\"table-dark\\\">\" +\r\n            \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-route-not-available\") + \"</td>\" +\r\n            //\"    <td>---</td>\" +\r\n            \"</tr>\"\r\n            ;\r\n    } else {\r\n        content +=\r\n            \"<tr class=\\\"table-dark\\\">\" +\r\n            \"    <td colspan=\\\"4\\\"><div class=\\\"spinner-border spinner-border-sm\\\" role=\\\"status\\\"></div> \" + $.i18n(\"transit-eta-retrieving-data\") + \"</td>\" +\r\n            \"</tr>\";\r\n        p.then(function (data) {\r\n            var h = data.options;\r\n            var content = \"\";\r\n            var node = $(\".timeline-entry[stop-id='\" + h.stopId + \"'] p table tbody\");\r\n            if (data.code && data.code === -2) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-eta-providers\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else if (!data.schedules || data.code && data.code === -1) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-data-received\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else if (data.schedules.length === 0) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-schedules-pending\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else {\r\n                var active = false;\r\n                for (var schedule of data.schedules) {\r\n                    var eta = Math.floor((schedule.time - schedule.serverTime) / 1000 / 60);\r\n\r\n                    var html = \"<tr class=\\\"table-\";\r\n\r\n                    if (eta >= 20) {\r\n                        html += \"secondary\";\r\n                    } else if (eta >= 15) {\r\n                        html += \"info\";\r\n                    } else if (eta >= 10) {\r\n                        html += \"success\";\r\n                    } else if (eta >= 5) {\r\n                        html += \"warning\";\r\n                    } else if (eta >= 1) {\r\n                        html += \"danger\";\r\n                    } else {\r\n                        html += \"dark\";\r\n                    }\r\n\r\n                    if (!active && eta > 0) {\r\n                        active = true;\r\n                        html += \" active\";\r\n                    }\r\n\r\n                    html += \"\\\">\";\r\n\r\n                    //TODO: isOutdated\r\n\r\n                    var provider = TransitEta.getProvider(schedule.provider);\r\n                    if (!provider) {\r\n                        console.error(\"Error: Could not find TransitEta provider to get localized names: \" + schedule.provider);\r\n                        return;\r\n                    }\r\n\r\n                    var colspan = 4;\r\n\r\n                    if (h.etaProviders.length > 1) {\r\n                        html += \"<td>\" + Lang.localizedKey(provider, \"name\") + \"</td>\";\r\n                        colspan--;\r\n                    }\r\n\r\n                    if (schedule.msg !== undefined && schedule.time === undefined) {\r\n                        html += \"<td colspan=\\\"\" + colspan + \"\\\">\" + schedule.msg + \"</td>\";\r\n                    } else {\r\n                        html += \"<td>\";\r\n                        if (schedule.msg !== undefined) {\r\n                            html += schedule.msg;\r\n                        }\r\n                        if (schedule.time !== undefined) {\r\n                            if (schedule.msg !== undefined) {\r\n                                html += \"<br />\";\r\n                            }\r\n                            if (eta > 0) {\r\n                                html += $.i18n(\"transit-eta-minutes\", eta);\r\n                            } else {\r\n                                html += $.i18n(\"transit-eta-arrived-left\");\r\n                            }\r\n                        }\r\n\r\n                        html += \"</td><td\";\r\n\r\n                        if (schedule.isLive === undefined) {\r\n                            html += \" colspan=\\\"2\\\"\";\r\n                        }\r\n\r\n                        html += \">\";\r\n\r\n                        var time = new Date(schedule.time);\r\n\r\n                        if (schedule.time !== undefined) {\r\n                            html += Misc.fillZero(time.getHours()) + \":\" + Misc.fillZero(time.getMinutes());\r\n                        } else {\r\n                            html += \"---\";\r\n                        }\r\n\r\n                        html += \"</td>\";\r\n\r\n                        if (schedule.isLive !== undefined) {\r\n                            if (schedule.isLive) {\r\n                                html += \"<td><span style=\\\"color: red; float: right; font-size: 10px;\\\"><i class=\\\"fa fa-circle\\\"></i> \" + $.i18n(\"transit-eta-live\") + \"</span></td>\";\r\n                            } else {\r\n                                html += \"<td><span style=\\\"font-size: 10px; float: right; font-style: italic;\\\">\" + $.i18n(\"transit-eta-scheduled\") + \"</span></td>\";\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    //TODO: Features\r\n\r\n                    html += \"</tr>\";\r\n                    content += html;\r\n                }\r\n            }\r\n            node.html(content);\r\n        }).catch(function (options, err) {\r\n            var node = $(\".timeline-entry[stop-id='\" + options.stopId + \"'] p table tbody\");\r\n            node.html(\"<tr class=\\\"table-danger\\\"><td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-error-fetching-eta\") + \"</td></tr>\");\r\n        });\r\n    }\r\n\r\n    content += \"</table>\";\r\n\r\n    node.html(content);\r\n}\r\n\r\nfunction updateEta() {\r\n    var requestLen = RequestLimiter.requests.length;\r\n    if (requestLen > 0) {\r\n        $(\".request-progress-panel\").fadeIn(500);\r\n\r\n        var max = maxRequest;\r\n        if (!max || requestLen > max) {\r\n            max = maxRequest = requestLen;\r\n        }\r\n\r\n        $(\".request-progress-panel .progress-bar\").html($.i18n(\"transit-eta-requesting-data\", max - requestLen, max));\r\n        //$(\".request-progress-panel .progress-bar\").html(Math.floor((max - requestLen) / max * 100) + \"%\");\r\n        $(\".request-progress-panel .progress-bar\").css(\"width\", Math.floor((max - requestLen) / max * 100) + \"%\");\r\n    } else {\r\n        maxRequest = 0;\r\n        $(\".request-progress-panel .progress-bar\").css(\"width\", \"100%\");\r\n        $(\".request-progress-panel\").fadeOut(500, function () {\r\n            $(\".request-progress-panel .progress-bar\").css(\"width\", \"0%\");\r\n        });\r\n    }\r\n    //var h;\r\n    for (var result of allNearbyRoutes) {\r\n        var p = TransitEta.fetchEta({\r\n            provider: result.route.provider,\r\n            etaProviders: result.route.etaProviders,\r\n            routeId: result.route.routeId,\r\n            selectedPath: result.bound,\r\n            stopId: result.stop.stopId\r\n        });\r\n        p.then(function (eta) {\r\n            var text = \"\";\r\n            var h = eta.options;\r\n\r\n            var node = $(\".nearby-route-list .route-selection[gtw-provider=\\\"\" + h.provider + \"\\\"][gtw-route-id=\\\"\" + h.routeId + \"\\\"][gtw-bound=\\\"\" + h.selectedPath + \"\\\"][gtw-stop-id=\\\"\" + h.stopId + \"\\\"]\");\r\n\r\n            node.removeClass(\"list-group-item-secondary\");\r\n            node.removeClass(\"list-group-item-info\");\r\n            node.removeClass(\"list-group-item-success\");\r\n            node.removeClass(\"list-group-item-warning\");\r\n            node.removeClass(\"list-group-item-danger\");\r\n            node.removeClass(\"list-group-item-light\");\r\n            node.removeClass(\"list-group-item-dark\");\r\n\r\n            var badgeClass = \"btn-secondary\";\r\n\r\n            if (!eta || !eta.schedules || eta.code && eta.code < 0) {\r\n                text = $.i18n(\"transit-eta-route-not-available-short\");\r\n                node.addClass(\"list-group-item-light\");\r\n            } else if (eta.schedules.length === 0) {\r\n                text = $.i18n(\"transit-eta-no-schedules-pending-short\");\r\n                node.addClass(\"list-group-item-light\");\r\n            } else {\r\n                var schedule = eta.schedules[0];\r\n\r\n                var calcEta = Math.floor((schedule.time - schedule.serverTime) / 1000 / 60);\r\n\r\n                var css = \"\";\r\n\r\n                if (calcEta >= 20) {\r\n                    css = \"secondary\";\r\n                } else if (calcEta >= 15) {\r\n                    css = \"info\";\r\n                } else if (calcEta >= 10) {\r\n                    css = \"success\";\r\n                } else if (calcEta >= 5) {\r\n                    css = \"warning\";\r\n                } else if (calcEta >= 1) {\r\n                    css = \"danger\";\r\n                } else {\r\n                    css = \"dark\";\r\n                }\r\n                node.addClass(\"list-group-item-\" + css);\r\n\r\n                //TODO: isOutdated\r\n\r\n                if (schedule.msg !== undefined) {\r\n                    var msg = schedule.msg;\r\n                    if (msg.length > 20) {\r\n                        text = $.i18n(\"transit-eta-transit-notice\");\r\n                    } else {\r\n                        text = schedule.msg;\r\n                    }\r\n                    badgeClass = \"badge-warning\";\r\n                } else if (schedule.time !== undefined) {\r\n                    if (schedule.msg !== undefined) {\r\n                        text += \"<br />\";\r\n                    }\r\n\r\n                    badgeClass = \"badge-primary\";\r\n                    if (calcEta > 0) {\r\n                        text += $.i18n(\"transit-eta-minutes\", calcEta);\r\n                    } else {\r\n                        text += $.i18n(\"transit-eta-arrived-left\", calcEta);\r\n                        badgeClass = \"badge-dark\";\r\n                    }\r\n\r\n                    if (schedule.isLive !== undefined) {\r\n                        text += \"<br /><span style=\\\"font-size: 10px; position: absolute; top: 16px; right: 16px; \";\r\n                        if (schedule.isLive) {\r\n                            text += \"color: red;\\\"><i class=\\\"fa fa-circle\\\"></i> \" + $.i18n(\"transit-eta-live\") + \"</span>\";\r\n                        } else {\r\n                            text += \"color: black; font-style: italic;\\\">\" + $.i18n(\"transit-eta-scheduled\") + \"</span>\";\r\n                        }\r\n                    }\r\n                }\r\n\r\n                /*\r\n                if (schedule.hasTime) {\r\n                    text += Misc.fillZero(schedule.time.hr) + \":\" + Misc.fillZero(schedule.time.min);\r\n                } else {\r\n                    text += \"---\";\r\n                }\r\n                */\r\n\r\n                //TODO: Features\r\n            }\r\n            var badge = node.children(\".transit-eta\");\r\n\r\n            badge.removeClass(\"badge-primary\");\r\n            badge.removeClass(\"badge-secondary\");\r\n            badge.removeClass(\"badge-warning\");\r\n            badge.removeClass(\"badge-danger\");\r\n            badge.removeClass(\"badge-dark\");\r\n            badge.addClass(badgeClass);\r\n\r\n            badge.html(text);\r\n        }).catch(function (options, err) {\r\n            var node = $(\".nearby-route-list .route-selection[gtw-provider=\\\"\" + options.provider + \"\\\"][gtw-route-id=\\\"\" + options.routeId + \"\\\"][gtw-bound=\\\"\" + options.selectedPath + \"\\\"][gtw-stop-id=\\\"\" + options.stopId + \"\\\"]\");\r\n\r\n            node.removeClass(\"list-group-item-secondary\");\r\n            node.removeClass(\"list-group-item-info\");\r\n            node.removeClass(\"list-group-item-success\");\r\n            node.removeClass(\"list-group-item-warning\");\r\n            node.removeClass(\"list-group-item-danger\");\r\n            node.removeClass(\"list-group-item-light\");\r\n            node.removeClass(\"list-group-item-dark\");\r\n            node.addClass(\"list-group-item-light\");\r\n\r\n            var badge = node.children(\".transit-eta\");\r\n\r\n            badge.removeClass(\"badge-primary\");\r\n            badge.removeClass(\"badge-secondary\");\r\n            badge.removeClass(\"badge-warning\");\r\n            badge.removeClass(\"badge-danger\");\r\n            badge.removeClass(\"badge-dark\");\r\n            badge.addClass(\"badge-danger\");\r\n\r\n            badge.html($.i18n(\"transit-eta-error-fetching-eta-short\"));\r\n        });\r\n    }\r\n}\r\n\r\nfunction findNearbyRoutes() {\r\n    clearInterval(updateEtaTimer);\r\n\r\n    var pos = Loc.getCurrentPosition();\r\n\r\n    var lat = pos.lat;\r\n    var lng = pos.lng;\r\n\r\n    lastLat = lat;\r\n    lastLng = lng;\r\n\r\n    var range = Settings.get(\"min_nearby_transit_range\", 200) / 1000.0;\r\n\r\n    var allNearbyStops = TransitStops.getAllStopsNearby(lat, lng, range, true, true);\r\n\r\n    if (allNearbyStops.length === 0) {\r\n        var testRange = range;\r\n        do {\r\n            testRange += 0.05;\r\n            allNearbyStops = TransitStops.getAllStopsNearby(lat, lng, testRange, true, true);\r\n        } while (allNearbyStops.length === 0 && testRange < 10);\r\n\r\n        if (testRange >= 10) {\r\n            $(\".tab-panel\").append(\r\n                \"<div class=\\\"alert alert-danger alert-dismissable\\\">\" +\r\n                \"<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\" aria-hidden=\\\"true\\\" >&#215;</button>\" +\r\n                \"No routes are found in 10 km range.\" +\r\n                \"</div>\"\r\n            );\r\n        } else {\r\n            $(\".tab-panel\").append(\r\n                \"<div class=\\\"alert alert-warning alert-dismissable\\\">\" +\r\n                \"<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\" aria-hidden=\\\"true\\\" >&#215;</button>\" +\r\n                $.i18n(\"transit-eta-no-routes-found-nearby-extended-range\", range * 1000, Math.ceil(testRange * 1000)) +\r\n                \"</div>\"\r\n            );\r\n        }\r\n    }\r\n\r\n    var maxNearbyBusDisplay = Settings.get(\"max_nearby_transit_to_display\", 20);\r\n    allNearbyRoutes = [];\r\n    for (var stopResult of allNearbyStops) {\r\n        if (allNearbyRoutes.length >= maxNearbyBusDisplay) {\r\n            break;\r\n        }\r\n\r\n        var routeResults = Transit.searchRoutesOfStop(stopResult.stop);\r\n\r\n        for (var routeResult of routeResults) {\r\n            allNearbyRoutes.push({\r\n                route: routeResult.route,\r\n                bound: routeResult.bound,\r\n                stop: stopResult.stop,\r\n                distance: stopResult.distance\r\n            });\r\n        }\r\n    }\r\n\r\n    var html;\r\n    var distance;\r\n    var paths;\r\n    var stopId;\r\n    var provider;\r\n    html = \"<div class=\\\"row item-list nearby-route-list\\\"><ul class=\\\"list-group\\\">\";\r\n    for (var result of allNearbyRoutes) {\r\n        paths = result.route.paths[result.bound];\r\n        stopId = paths[paths.length - 1];\r\n        distance = Math.round(result.distance * 1000);\r\n        provider = TransitRoutes.getProvider(result.route.provider);\r\n        html +=\r\n            \"    <li class=\\\"list-group-item list-group-item-action d-flex justify-content-between align-items-center route-selection\\\" gtw-provider=\\\"\" + result.route.provider + \"\\\" gtw-route-id=\\\"\" + result.route.routeId + \"\\\" gtw-stop-id=\\\"\" + result.stop.stopId + \"\\\" gtw-bound=\\\"\" + result.bound + \"\\\">\" +\r\n            \"        <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n            \"            <div>\" + Lang.localizedKey(provider, \"name\") + \"</div>\" +\r\n            \"            <div>\" + Lang.localizedKey(result.route, \"routeName\") + \"</div>\" +\r\n            \"        </div>\" +\r\n            \"        <div class=\\\"d-flex flex-column stop-info mr-auto\\\">\" +\r\n            \"            <div>\" +\r\n            \"                <b>\" + $.i18n(\"transit-eta-to\") + \":</b> <small>\" + Lang.localizedKey(TransitStops.getStopById(stopId), \"stopName\") +\r\n            \"</small></div>\" +\r\n            \"            <div>\" +\r\n            \"                \" + Lang.localizedKey(result.stop, \"stopName\") + \" (\" + distance + $.i18n(\"transit-eta-metres\") + \")\" +\r\n            \"            </div>\" +\r\n            \"        </div>\" +\r\n            \"        <span class=\\\"badge badge-primary badge-pill transit-eta\\\">\" + $.i18n(\"transit-eta-retrieving\") + \"</span>\" +\r\n            \"    </li>\";\r\n    }\r\n    html += \"</ul></div><div class=\\\"row item-list all-route-list\\\"></div>\";\r\n\r\n    $(\".content-panel-container\").html(html);\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"mouseenter\", mouseEnterPreviewRoute);\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"mouseleave\", function () {\r\n        //Map.setCenter(Loc.getCurrentPosition());\r\n        //Map.setZoom(16);\r\n        //Map.removeAllMarkers();\r\n        //Map.removeAllPolylines();\r\n    });\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"click\", mouseClickSelectRoute);\r\n\r\n    filterProviderSort(\".nearby-route-list\");\r\n\r\n    updateEta();\r\n    updateEtaTimer = setInterval(updateEta, 30000);\r\n}\r\n\r\nexport function enable() {\r\n    RequestLimiter.clear();\r\n    TransitEta.clearCache();\r\n\r\n    TouchKeypad.addListener(touchKeypadListener = function (obj) {\r\n        var searchText;\r\n        if ($(obj).hasClass(\"touch-keypad-function-clear\")) {\r\n            clearSearch();\r\n        } else if ($(obj).hasClass(\"touch-keypad-function-backspace\")) {\r\n            searchText = $(\"#search-transit-text\").val();\r\n            $(\"#search-transit-text\").val(searchText.slice(0, -1));\r\n            searchRoutes();\r\n        } else if ($(obj).hasClass(\"touch-keypad-value\")) {\r\n            var val = $(obj).html();\r\n            searchText = $(\"#search-transit-text\").val();\r\n            $(\"#search-transit-text\").val(searchText + val);\r\n            searchRoutes();\r\n        }\r\n    });\r\n\r\n    Event.addListener(Event.EVENTS.EVENT_UI_BACK, eventUiBackListener = function (){\r\n        if (fromSearch) {\r\n            TouchKeypad.showTouchKeypad();\r\n        }\r\n        clearInterval(updateStopEtaTimer);\r\n    });\r\n\r\n    Event.addListener(Event.EVENTS.EVENT_LOCATION_CHANGE, eventLocChgListener = function () {\r\n        if (lastLat && lastLng) {\r\n            var newLoc = Loc.getCurrentPosition();\r\n            var dst = Misc.geoDistance(newLoc.lat, newLoc.lng, lastLat, lastLng);\r\n            if (dst > 0.025) {\r\n                console.log(\"Location moved 25 m away. Finding new nearby routes.\");\r\n                findNearbyRoutes();\r\n            }\r\n        }\r\n    });\r\n\r\n    var providers = TransitRoutes.getProviders();\r\n\r\n    if (providers.length > 0) {\r\n        var buttonScroll =\r\n            \"<div class=\\\"hori-scroll btn-group\\\">\" +\r\n            \"    <button type=\\\"button\\\" class=\\\"btn btn-primary gtw-providersort gtw-providersort-all\\\"><i class=\\\"fa fa-reply-all\\\"></i><br />\" + $.i18n(\"transit-eta-sort-all\") + \"</button>\";\r\n\r\n        for (var iprovider of providers) {\r\n            var image = \"\";\r\n            if (iprovider.type === TransitType.BUS) {\r\n                image = \"fa-bus\";\r\n            } else if (iprovider.type === TransitType.TRAIN) {\r\n                image = \"fa-train\";\r\n            } else {\r\n                image = \"fa-question\";\r\n            }\r\n            buttonScroll += \" <button type=\\\"button\\\" class=\\\"btn btn-default gtw-providersort gtw-providersort-provider\\\" gtw-provider=\\\"\" + iprovider.id + \"\\\"><i class=\\\"fa \" + image + \"\\\"></i><br />\" + Lang.localizedKey(iprovider, \"name\") + \"</button>\";\r\n        }\r\n\r\n        buttonScroll += \"</div>\";\r\n\r\n        $(\".tab-panel\").append(buttonScroll);\r\n\r\n        var searchField =\r\n            \"<div class=\\\"input-group mb-3\\\" style=\\\"margin-top: 16px;\\\">\" +\r\n            \"    <input type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"\" + $.i18n(\"transit-eta-placeholder-search-for-transit\") + \"\\\" aria-label=\\\"\" + $.i18n(\"transit-eta-placeholder-search-for-transit\") + \"\\\" aria-describedby=\\\"search-transit-icon\\\" id=\\\"search-transit-text\\\" readonly/>\" +\r\n            \"    <div class=\\\"input-group-append\\\">\" +\r\n            //\"        <span class=\\\"input-group-text\\\" id=\\\"search-transit-icon\\\"><i class=\\\"fas fa-search\\\"></i></span>\" +\r\n            \"        <button class=\\\"btn btn-light disabled\\\" type=\\\"button\\\" id=\\\"button-cancel-search\\\"><i class=\\\"fas fa-search\\\"></i></button>\" +\r\n            \"    </div>\" +\r\n            \"</div>\"\r\n            ;\r\n\r\n        $(\".tab-panel\").append(searchField);\r\n\r\n        var requestProgressBar =\r\n            \"<div class=\\\"request-progress-panel\\\">\" +\r\n            \"    <div class=\\\"progress bg-white\\\">\" +\r\n            \"        <div class=\\\"progress-bar progress-bar-striped progress-bar-animated\\\" role=\\\"progressbar\\\" style=\\\"width: 0%;\\\"></div>\" +\r\n            \"    </div>\" +\r\n            \"</div>\"\r\n            ;\r\n\r\n        $(\".tab-panel\").append(requestProgressBar);\r\n\r\n        $(\".gtw-providersort\").on(\"click\", function () {\r\n            if ($(this).hasClass(\"btn-primary\")) {\r\n                return;\r\n            }\r\n            //$(\".gtw-providersort\").removeClass(\"btn-default\");\r\n\r\n            if ($(this).hasClass(\"gtw-providersort-all\")) {\r\n                resetProviderSort();\r\n            } else {\r\n                $(\".gtw-providersort\").removeClass(\"btn-primary\");\r\n\r\n                var provider = $(this).attr(\"gtw-provider\");\r\n                $(this).addClass(\"btn-primary\");\r\n\r\n                $(\".gtw-providersort-provider:not([gtw-provider='\" + provider + \"'])\").addClass(\"btn-default\");\r\n                $(\".route-selection[gtw-provider='\" + provider + \"']\").attr(\"style\", \"\");\r\n                $(\".route-selection:not([gtw-provider='\" + provider + \"'])\").attr(\"style\", \"display: none!important\");\r\n            }\r\n        });\r\n\r\n        $(\"#button-cancel-search\").on(\"click\", function () {\r\n            if (!$(this).hasClass(\"disabled\")) {\r\n                clearSearch();\r\n            }\r\n        });\r\n\r\n        var useKeypad = true;\r\n        if (useKeypad) {\r\n            $(\"#search-transit-text\").on(\"click\", function () {\r\n                showTouchKeypad();\r\n                showSearchRoutes();\r\n            });\r\n        }\r\n\r\n        $(\"#search-transit-text\").on(\"input\", function () {\r\n            clearTimeout(searchTimeout);\r\n            searchTimeout = setTimeout(function () {\r\n                searchRoutes();\r\n            }, 500);\r\n        });\r\n\r\n        findNearbyRoutes();\r\n    } else {\r\n        //TODO: better message or auto add plugins according to region\r\n        $(\".tab-panel\").html(\"<br /><div class=\\\"alert alert-danger\\\" role=\\\"alert\\\"><i class=\\\"fas fa-exclamation-triangle\\\"></i> \" + $.i18n(\"transit-eta-no-plugins-providing-transit-data\") + \"</div>\");\r\n    }\r\n}\r\n\r\nexport function disable() {\r\n    TouchKeypad.removeListener(touchKeypadListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_UI_BACK, eventUiBackListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_LOCATION_CHANGE, eventLocChgListener);\r\n    clearTimeout(searchTimeout);\r\n    clearInterval(updateEtaTimer);\r\n    clearInterval(updateStopEtaTimer);\r\n    searchTimeout = false;\r\n    updateEtaTimer = false;\r\n}"],"sourceRoot":""}