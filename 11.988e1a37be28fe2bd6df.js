(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{108:function(t,a,e){"use strict";e.r(a),function(t){e.d(a,"enable",(function(){return J})),e.d(a,"disable",(function(){return W}));e(9);var i,s,r,n,l,o,d,c,p,g=e(33),u=e(43),v=e(8),h=e(5),m=e(32),f=e(23),y=e(94),b=e(6),w=e(21),_=e(2),C=e(7),k=!1,x=!1,T=!1;function E(){y.d()}function D(a){t(".gtw-providersort-provider").each((function(){var e=t(this).attr("data-gtw-package"),i=t(this).attr("data-gtw-provider"),s=t(this).attr("data-gtw-agency");t(a+" .route-selection"+("[data-gtw-package='"+e+"'][data-gtw-provider='"+i+"'][data-gtw-agency='"+s+"']")).length>0?t(this).css("display",""):t(this).css("display","none")}))}var I=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],U=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],O=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];function N(t){var a,e,i={};for(a=0;a<I.length;a++)i[I[a]]=0;for(a=0;a<t.length;a++)for(e=0;e<I.length;e++)i[I[e]]|=t[a][I[e]];return i}function A(a,e=!1){if(a.monday&&a.tuesday&&a.wednesday&&a.thursday&&a.friday&&a.saturday&&a.sunday)return!!e&&t.i18n("transit-calendar-from-monday-to-sunday-dates");if(a.monday&&a.tuesday&&a.wednesday&&a.thursday&&a.friday&&a.saturday)return t.i18n("transit-calendar-from-monday-to-saturday"+(e?"-dates":""));if(a.monday&&a.tuesday&&a.wednesday&&a.thursday&&a.friday)return t.i18n("transit-calendar-from-monday-to-friday"+(e?"-dates":""));if(a.monday&&a.tuesday&&a.wednesday&&a.thursday)return t.i18n("transit-calendar-from-monday-to-thursday"+(e?"-dates":""));if(a.saturday&&a.sunday)return t.i18n("transit-calendar-from-saturday-to-sunday"+(e?"-dates":""));if(a.saturday)return t.i18n("transit-calendar-on-saturday"+(e?"-dates":""));if(a.sunday)return t.i18n("transit-calendar-on-sunday"+(e?"-dates":""));var i,s="";for(i=0;i<I.length;i++)s+=a[I[i]]?U[i].substr(0,1):".";return s}var K,S=!1;async function R(){var a=setTimeout((function(){t(".loading-overlay").fadeIn(500)}),500);y.g({}),y.b();var e,i=t("#search-transit-text").val();var s,r='<ul class="list-group">';if(s=Date.now(),0===i.length)console.log("FIRSTLETTERS"),S?e=S:(e=await C.f(i.length,1,!0),S=e),console.log("Used "+(Date.now()-s)+" ms"),s=Date.now();else{console.log("SEARCH");var n,l,o,d,c,p,g,u,v,h,f,b,w,_=await C.r(i);console.log("Used "+(Date.now()-s)+" ms"),s=Date.now();var k,x,T,E,I,U,O,K={};e=[];var R,q={},z={},V={},j={},H=0,F=0,B=0,P=0;for(n=0;n<_.length;n++){if(R=Date.now(),h=(u=_[n]).route_id,c=m.localizedKey(u,"route_short_name"),I=u.package,U=u.provider,O=u.agency_id,i.length<c.length){var G=c.substr(i.length,1);e.includes(G)||e.push(G)}for(v=q[(d=I+","+U+",")+O]?q[d+O]:q[d+O]=await C.e(I,U,O),p=z[d+h]?z[d+h]:z[d+h]=await C.n(I,U,h),E=[],x=[],l=0;l<p.length;l++)T=(g=p[l]).path_id,k=g.service_id,E.includes(T)||E.push(T),x.includes(k)||x.push(k);for(H+=Date.now()-R,F++,l=0;l<E.length;l++){R=Date.now(),T=E[l],r+='<li class="list-group-item list-group-item-action d-flex align-items-center route-selection"  data-gtw-package="'+I+'" data-gtw-provider="'+U+'" data-gtw-agency="'+O+'" data-gtw-route-id="'+u.route_id+'" data-gtw-path-id="'+T+'">    <div class="d-flex flex-column route-id">        <div>'+m.localizedKey(v,"agency_short_name")+"</div>        <div>"+c+'</div>    </div>    <div class="d-flex flex-column stop-info mr-auto">',f=j[d+(b=(w=V[d+T]?V[d+T]:V[d+T]=await C.m(I,U,T))[w.length-1].stop_id)]?j[d+b]:j[d+b]=await C.l(I,U,b),r+="        <div><b>"+t.i18n("transit-eta-to")+":</b> "+C.t(v.agency_id,m.localizedKey(f,"stop_name"))+"</div>";var J=[];for(o=0;o<x.length;o++)K[k=x[o]]||(K[k]=await C.g(I,U,k)),J.push(K[k]);r+="<div>";var W=!1;w[0].stop_id===f.stop_id&&(W=!0,r+='<span class="badge badge-secondary">'+t.i18n("transit-circular-path")+"</span>");var Q=A(N(J));Q&&(W&&(r+=" ",W=!1),r+='<span class="badge badge-secondary">'+Q+"</span>"),r+="        </div>    </div></li>",B+=Date.now()-R,P++}}}console.log("Used "+(Date.now()-s)+" ms"),console.log("BeforeLoopAvg: "+H/F+" ms ("+F+" times)"),console.log("AfterLoopAvg: "+B/P+" ms ("+P+" times)"),s=Date.now(),r+="</ul>",t(".all-route-list").html(r),console.log(e);var X={};for(var Y of e)X[Y]=!0;console.log(X),y.g(X),y.c(),t(".all-route-list .route-selection").on("mouseenter",M),t(".all-route-list .route-selection").on("click",L),D(".all-route-list"),clearTimeout(a),t(".loading-overlay").fadeOut(500),adjustMargin(),console.log("Used "+(Date.now()-s)+" ms")}function q(){t(".gtw-providersort").removeClass("btn-primary"),t(".gtw-providersort-all").addClass("btn-primary"),t(".route-selection").attr("style","")}function z(){t(".all-route-list").html(""),E(),t("#search-transit-text").val(""),T=!1,t("#button-cancel-search").addClass("btn-light"),t("#button-cancel-search").addClass("disabled"),t("#button-cancel-search").removeClass("btn-danger"),t("#button-cancel-search").html('<i class="fas fa-search"></i>'),t(".nearby-route-list").css("display","flex"),t(".all-route-list").css("display","none"),_.i(f.a()),_.k(16),_.f(),_.g(),q(),D(".nearby-route-list"),y.f()}async function L(){var a=t(this).attr("data-gtw-package"),e=t(this).attr("data-gtw-provider"),i=t(this).attr("data-gtw-agency"),s=t(this).attr("data-gtw-route-id"),r=t(this).attr("data-gtw-path-id"),n=t(this).attr("data-gtw-stop-id"),l=await C.m(a,e,r);if(!n&&f.d()){var o,d,c=f.a(),p=!1,g=!1;for(var u of l)o=await C.l(a,e,u.stop_id),d=h.c(o.stop_lat,o.stop_lon,c.lat,c.lng),(!p||!g||d<p)&&(p=d,g=o);console.log(p),p<=2&&(n=g.stop_id)}var v=setTimeout((function(){t(".loading-overlay").fadeIn(500)}),500);_.f(),_.g(),await async function(a,e,i,s,r,n,l=!1,o=!1){var d,c,p,g=await C.m(a,e,r),u=await C.j(a,e,s),v=await C.e(a,e,i),h=g[g.length-1],f=await C.l(a,e,h.stop_id),y=await C.n(a,e,s),b={};for(j=0;j<y.length;j++)if(r===y[j].path_id)for(var w of(c=y[j].trip_id,D=y[j].service_id,b[D]||(b[D]={calendar:await C.g(a,e,D),freqs:[]}),d=b[D],await C.i(a,e,c))){for(var k of(p=!1,d.freqs))if(k.start_time===w.start_time&&k.end_time===w.end_time&&k.headway_secs===w.headway_secs){p=!0;break}p||d.freqs.push(w)}var x='<ul class="list-group"><li class="list-group-item d-flex align-items-center route-selection">    <div class="d-flex flex-column route-id">        <div>'+m.localizedKey(v,"agency_short_name")+"</div>        <div>"+m.localizedKey(u,"route_short_name")+'</div>    </div>    <div class="d-flex flex-column stop-info mr-auto">        <div><b>'+t.i18n("transit-eta-to")+":</b> "+C.t(i,m.localizedKey(f,"stop_name"))+"</div><div>",T=!1;g[0].stop_id===f.stop_id&&(T=!0,x+='<span class="badge badge-secondary">'+t.i18n("transit-circular-path")+"</span>");var E=[];for(var D in b)E.push(b[D].calendar);var I,U=A(N(E));U&&(T&&(x+=" ",T=!1),x+='<span class="badge badge-secondary">'+U+"</span>");for(x+='</div></div></li></ul><ul class="nav nav-pills nav-fill m-2" role="tablist" id="pills-route-list-tab">    <li class="nav-item">        <a class="nav-link active" id="pills-route-tab" data-toggle="pill" href="#pills-route" role="tab" aria-controls="pills-route" aria-selected="true">'+t.i18n("transit-route-tab-route-list")+'</a>    </li>    <li class="nav-item">        <a class="nav-link" id="pills-timetable-tab" data-toggle="pill" href="#pills-timetable" role="tab" aria-controls="pills-timetable" aria-selected="false">'+t.i18n("transit-route-tab-timetable")+'</a>    </li>    <li class="nav-item">        <a class="nav-link disabled" id="pills-other-routes-tab" data-toggle="pill" href="#pills-other-routes" role="tab" aria-controls="pills-other-routes" aria-selected="false">'+t.i18n("transit-route-tab-other-routes")+"</a>    </li></ul>",t(".split-map-tab-panel").html(x),x='<div class="tab-content" id="pills-route-list-tabContent">    <div class="tab-pane fade show active" id="pills-route" role="tabpanel" aria-labelledby="pills-route-tab">        <div class="row" style="padding: 2%;">            <div class="timeline-centered">',j=0;j<g.length;j++)I=await C.l(a,e,g[j].stop_id),x+='<article class="timeline-entry" data-gtw-package="'+a+'" data-gtw-provider="'+e+'" data-gtw-agency="'+i+'" data-gtw-route-id="'+s+'" data-gtw-path-id="'+r+'" data-gtw-stop-id="'+I.stop_id+'">    <div class="timeline-entry-inner">        <div class="timeline-icon bg-light">            '+(j+1)+'        </div>        <div class="timeline-label">            <h2><button style="padding: 0px;" class="btn btn-link" data-gtw-package="'+a+'" data-gtw-provider="'+e+'" data-gtw-agency="'+i+'" data-gtw-route-id="'+s+'" data-gtw-path-id="'+r+'" data-gtw-stop-id="'+I.stop_id+'" data-gtw-stop-sequence="'+g[j].stop_sequence+'" data-gtw-stop-index="'+j+'">'+C.t(i,m.localizedKey(I,"stop_name"))+'</button></h2>            <p class="stop-eta-info"></p>        </div>    </div></article>';x+='            </div>        </div>    </div>    <div class="tab-pane fade" id="pills-timetable" role="tabpanel" aria-labelledby="pills-timetable-tab">';var K,S='<ul class="nav nav-pills nav-fill mb-3" id="calendar-tab" role="tablist">',R='<div class="tab-content" id="calendar-tabContent">',q=new Date,z={},L=!1;for(var D in b){var M=1===b[D].calendar[O[q.getDay()]];z[D]=M,L|=M}var j=0;for(var D in b){var H,F;if(d=b[D],K=A(d.calendar,!0),L?(F=z[D],H=F):(F=!1,H=0===j),S+='<li class="nav-item">    <a class="nav-link'+(H?" active":"")+'" id="calendar-'+D+'-tab" data-toggle="pill" href="#calendar-'+D+'" role="tab" aria-controls="calendar-'+D+'" aria-selected="'+(H?"true":"false")+'">'+(F?'<i class="fas fa-hourglass-half"></i> ':"")+K+"</a></li>",R+='<div class="tab-pane fade'+(H?" show active":"")+'" id="calendar-'+D+'" role="tabpanel" aria-labelledby="calendar-'+D+'-tab">    <table class="table">        <thead class="thead-light">            <tr>                <th scope="col" colspan="'+(F&&L?"4":"3")+'">'+t.i18n("transit-calendar-header-timeslot")+'</th>                <th scope="col">'+t.i18n("transit-calendar-header-headway-min")+"</th>            </tr>        </thead>        <tbody>",j++,d.freqs.length>0)for(var w of d.freqs){var B=Math.round(w.headway_secs/60);R+="            <tr>",F&&L&&(C.o(w)?R+='                <td><i class="fas fa-hourglass-half"></i></td>':R+="                <td></td>"),R+="                <td>"+w.start_time+"</td>                <td>-</td>                <td>"+w.end_time+"</td>                <td>"+B+"</td>            </tr>"}else R+='                <td colspan="4">'+t.i18n("transit-eta-no-timetable")+"</td>            </tr>";R+="        </tbody>    </table></div>"}x+=(S+="</ul>")+R+'    </div>    <div class="tab-pane fade" id="pills-other-routes" role="tabpanel" aria-labelledby="pills-other-routes-tab">',x+="</div></div>",t(".split-map-container").html(x),t(".split-map-container button").on("click",(function(){var a=t(this).attr("data-gtw-package"),e=t(this).attr("data-gtw-provider"),i=t(this).attr("data-gtw-agency"),s=t(this).attr("data-gtw-route-id"),r=t(this).attr("data-gtw-path-id"),n=t(this).attr("data-gtw-stop-id");V(a,e,i,s,r,g,n)})),t(".nav-pills[role='tablist'] .nav-item a").on("click",(function(){var a=t(this).parent().parent().attr("id"),e=a.lastIndexOf("-tab"),i=a.substr(0,e)+"-tabContent",s=t(this).attr("aria-controls");t(".tab-content[id='"+i+"']").children(".tab-pane").each((function(){var a=t(this).attr("id");a!==s?(t(this).removeClass("show"),t(this).removeClass("active")):(t(this).addClass("show"),t(this).addClass("active"),a.startsWith("calendar-")||t(this)[0].scrollIntoView())}))})),o&&await async function(t){var a,e,i,s=[];for(i=0;i<t.length;i++)a={lat:(e=await C.l(t[i].package,t[i].provider,t[i].stop_id)).stop_lat,lng:e.stop_lon},s.push(a),_.a(a,{title:e.stop_name,label:""+(i+1)});_.b(s,"#FF0000",2)}(g);adjustMargin()}(a,e,i,s,r,0,!0,!0),w.b(),E(),await V(a,e,i,s,r,l,n),clearTimeout(v),t(".loading-overlay").fadeOut(500)}function M(){console.warn("TODO: Preview route")}async function V(a,e,i,r,n,l,o){var d=screen.width>=768?".desktop":".mobile",c=t(d+" .timeline-entry[data-gtw-stop-id='"+o+"']"),p=t(d+" .timeline-entry:not([data-gtw-stop-id='"+o+"'])"),u=c.children(".timeline-entry-inner").children(".timeline-icon"),v=c.children(".timeline-entry-inner").children(".timeline-icon");if(u.removeClass("bg-light"),u.addClass("bg-primary"),v.addClass("bg-light"),v.removeClass("bg-primary"),p.children(".timeline-entry-inner").children(".timeline-label").children("p").html(""),scroll){var f=c[0];void 0===f&&(f=t(d+" .timeline-entry")[0]),f.scrollIntoView()}if(o){var y=await C.e(a,e,i),b=await C.j(a,e,r),k=await C.h(a,e,b.route_id),x=await C.l(a,e,o),T={lat:x.stop_lat,lng:x.stop_lon};_.i(T),_.k(18),async function(a,e,i,r,n){if(H)return;H=!0;var l=t(".timeline-entry[data-gtw-stop-id='"+n.stop_id+"'] .stop-eta-info"),o="<u>"+t.i18n("transit-eta")+'</u> <div class="spinner-border spinner-border-sm eta-loading-spinner" role="status"></div><table class="table stop-eta">    <tr class="table-dark">        <td colspan="4"><div class="spinner-border spinner-border-sm" role="status"></div> '+t.i18n("transit-eta-retrieving-data")+"</td>    </tr></table>";l.html(o),K=!1,async function(a,e,i,s,r){var n=t(".timeline-entry[data-gtw-stop-id='"+s+"'] p table tbody"),l=await C.k(a,e,i,r),o=-1;for(p=0;p<l.length;p++)if(C.o(l[p])){o=p;break}var d="";if(-1!==o)for(var c=o+3>=l.length?l.length:o+3,p=o;p<c;p++){var g=Math.round(l[p].headway_secs/60),u=C.v(l[p].start_time);d+='<tr class="table-secondary'+(p==o?" active":"")+'">    <td>'+t.i18n("transit-eta-every-minutes",g)+'</td>    <td colspan="2">'+h.b(u.getHours())+":"+h.b(u.getMinutes())+"</td></tr>"}else 0===l.length?d+='<tr class="table-dark">    <td colspan="4">'+t.i18n("transit-eta-no-timetable")+"</td></tr>":d+='<tr class="table-dark">    <td colspan="4">'+t.i18n("transit-eta-not-in-service")+"</td></tr>";K||n.html(d)}(e.package,e.provider,e.route_id,n.stop_id,r[0].path_id),clearInterval(s);var d=function(){!async function(a,e,i,s,r){if(j)return;j=!0,t(".eta-loading-spinner").css("display","");try{var n=await g.fetchEta({etaProviders:a.agency_id.split("+"),agency:a,route:e,trip:i,stopTimes:s,stop:r});t(".stop-eta-msg").remove(),t(".eta-loading-spinner").css("display","none"),console.log(n);var l=n.options,o="";t(".timeline-entry[data-gtw-stop-id='"+l.stop.stop_id+"'] .stop-eta-info table tbody");if(-2===n.code){var d='<p class="stop-eta-msg">*'+t.i18n("transit-eta-no-eta-providers")+"</p>";t(".timeline-entry[data-gtw-stop-id='"+l.stop.stop_id+"'] .stop-eta-info").append(d)}else if(-1===n.code||n.feeds&&0===n.feeds.length){d='<p class="stop-eta-msg">*'+t.i18n("transit-eta-no-data-received")+"</p>";t(".timeline-entry[data-gtw-stop-id='"+l.stop.stop_id+"'] .stop-eta-info").append(d)}else{var c=[],p=[];for(var u of n.feeds)for(var v of u.entity){var f=v.tripUpdate;if(f){var y=f.timestamp?f.timestamp:u.header.timestamp;p.push({timestamp:y,entity:v})}v.alert&&c.push(v.alert)}if(c.length>0){var b="";b=1===c.length?'<div class="stop-eta-msg alert alert-warning"><i class="fas fa-exclamation-triangle"></i> <b>'+m.translatedString(c[0].headerText)+"</b></div>":'<div class="stop-eta-msg alert alert-warning"><i class="fas fa-exclamation-triangle"></i> <b>'+t.i18n("transit-eta-alerts-affecting-stop",c.length)+'</b> <button class="btn btn-link view-alert-btn">'+t.i18n("transit-eta-view-alerts-affecting-stop")+"</button></div>",t(".timeline-entry[data-gtw-stop-id='"+l.stop.stop_id+"'] .stop-eta-info").prepend(b),t(".view-alert-btn").on("click",(function(){w.d("viewgtfsalerts",c)}))}if(0===p.length){d='<p class="stop-eta-msg">*'+t.i18n("transit-eta-no-schedules-pending")+"</p>";t(".timeline-entry[data-gtw-stop-id='"+l.stop.stop_id+"'] .stop-eta-info").append(d)}else{o="";var _=!1;for(var C of p){var k=C.entity.tripUpdate.stopTimeUpdate;if(k&&k.length>0)for(var x of k)if(!x.scheduleRelationship||"SCHEDULED"===x.scheduleRelationship){var T;x.departure?T=x.departure.time:x.arrival&&(T=x.arrival.time);var E=Math.floor((T-C.timestamp)/1e3/60);d='<tr class="table-';d+=E>=20?"secondary":E>=15?"info":E>=10?"success":E>=5?"warning":E>=1?"danger":"dark",!_&&E>0&&(_=!0,d+=" active"),d+='">';C.entity.vehicle&&C.entity.vehicle.vehicle&&C.entity.vehicle.vehicle.label&&(d+="<td>"+C.entity.vehicle.vehicle.label+"</td>"),d+="<td>",d+=E>0?t.i18n("transit-eta-minutes",E):t.i18n("transit-eta-arrived-left"),d+="</td><td",d+=' colspan="2"',d+=">";var D=new Date(T);d+=h.b(D.getHours())+":"+h.b(D.getMinutes()),d+="</td>",o+=d+="</tr>"}}t(".timeline-entry[data-gtw-stop-id='"+l.stop.stop_id+"'] .stop-eta-info table tbody").html(o),K=!0}}}catch(a){t(".eta-loading-spinner").css("display","none");d='<p class="text-danger stop-eta-msg">*'+t.i18n("transit-eta-error-fetching-eta")+"</p>";t(".timeline-entry[data-gtw-stop-id='"+r.stop_id+"'] .stop-eta-info").append(d)}j=!1}(a,e,i,r,n)};d(),s=setInterval(d,3e4),H=!1}(y,b,k,l,x)}}var j=!1;var H=!1;function F(){for(var a of n){g.fetchEta({etaProviders:a.route.agency_id.split("+"),agency:a.agency,route:a.route,trip:a.trip,stop:a.stop,stopTimes:a.path}).then((function(a){var e="",i=a.options,s=t('.nearby-route-list .route-selection[data-gtw-package="'+i.agency.package+'"][data-gtw-provider="'+i.agency.provider+'"][data-gtw-agency="'+i.agency.agency_id+'"][data-gtw-route-id="'+i.route.route_id+'"][data-gtw-path-id="'+i.trip.path_id+'"][data-gtw-stop-id="'+i.stop.stop_id+'"]');s.removeClass("list-group-item-secondary"),s.removeClass("list-group-item-info"),s.removeClass("list-group-item-success"),s.removeClass("list-group-item-warning"),s.removeClass("list-group-item-danger"),s.removeClass("list-group-item-light"),s.removeClass("list-group-item-dark");var r="btn-secondary";if(a.code<0)e=t.i18n("transit-eta-route-not-available-short"),s.addClass("list-group-item-light");else if(0===a.feeds.length)e=t.i18n("transit-eta-no-feed-received"),s.addClass("list-group-item-light");else{var n=[];for(var l of a.feeds)for(var o of l.entity){var d=o.tripUpdate;if(d){var c=d.timestamp?d.timestamp:l.header.timestamp;n.push({timestamp:c,tripUpdate:d})}}if(0===n.length)e=t.i18n("transit-eta-no-schedules-pending-short"),s.addClass("list-group-item-light");else{var p=n[0],g=p.tripUpdate.stopTimeUpdate;if(g&&g.length>0){var u=g[0];if(u.scheduleRelationship&&"SCHEDULED"!==u.scheduleRelationship)console.log("NODATA");else{var v;u.departure?v=u.departure.time:u.arrival&&(v=u.arrival.time);var h=Math.floor((v-p.timestamp)/1e3/60),m="";m=h>=20?"secondary":h>=15?"info":h>=10?"success":h>=5?"warning":h>=1?"danger":"dark",s.addClass("list-group-item-"+m),r="badge-primary",h>0?e+=t.i18n("transit-eta-minutes",h):(e+=t.i18n("transit-eta-arrived-left",h),r="badge-dark")}}else console.log("Cancelled")}}var f=s.children(".transit-eta");f.removeClass("badge-primary"),f.removeClass("badge-secondary"),f.removeClass("badge-warning"),f.removeClass("badge-danger"),f.removeClass("badge-dark"),f.addClass(r),f.html(e)})).catch((function(a,e){var i=t('.nearby-route-list .route-selection[data-gtw-package="'+a.agency.package+'"][data-gtw-provider="'+a.agency.provider+'"][data-gtw-agency="'+a.agency.agency_id+'"][data-gtw-route-id="'+a.route.route_id+'"][data-gtw-path-id="'+a.trip.path_id+'"][data-gtw-stop-id="'+a.stop.stop_id+'"]');i.removeClass("list-group-item-secondary"),i.removeClass("list-group-item-info"),i.removeClass("list-group-item-success"),i.removeClass("list-group-item-warning"),i.removeClass("list-group-item-danger"),i.removeClass("list-group-item-light"),i.removeClass("list-group-item-dark"),i.addClass("list-group-item-light");var s=i.children(".transit-eta");s.removeClass("badge-primary"),s.removeClass("badge-secondary"),s.removeClass("badge-warning"),s.removeClass("badge-danger"),s.removeClass("badge-dark"),s.addClass("badge-danger"),s.html(t.i18n("transit-eta-error-fetching-eta-short"))}))}}async function B(){clearInterval(r);var a=f.a(),e=a.lat,i=a.lng;k=e,x=i;var s=v.get("min_nearby_transit_range",200)/1e3,l=Date.now(),o=await C.q(e,i,s,!0);if(0===o.length){var d=s;do{d+=.05,o=await C.q(e,i,d,!0,!0)}while(0===o.length&&d<10);d>=10?t(".tab-panel").append('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" >&#215;</button>'+t.i18n("transit-eta-no-routes-found-10-km")+"</div>"):t(".tab-panel").append('<div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" >&#215;</button>'+t.i18n("transit-eta-no-routes-found-nearby-extended-range",1e3*s,Math.ceil(1e3*d))+"</div>")}console.log("Used: "+(Date.now()-l)),l=Date.now();var c,p,g,u=v.get("max_nearby_transit_to_display",20);for(var h of(n=[],console.log(o),o)){if(n.length>=u)break;var y,b=(y=h.stop).package,w=y.provider,_=await C.s(b,w,y.stop_id);for(var T in _.trips){var E=_.trips[T],I=await C.e(b,w,_.routes[T].agency_id),U=await C.m(b,w,E.path_id);n.push({agency:I,route:_.routes[T],trip:E,stop:y,stopTime:_.stopTimes[E.path_id],path:U,distance:h.distance})}}console.log("Used: "+(Date.now()-l)),l=Date.now(),n.sort((t,a)=>t.distance-a.distance),console.log("Used: "+(Date.now()-l)),l=Date.now(),console.log(n);var O='<ul class="list-group">';for(var N of n)c=Math.round(1e3*N.distance),I=await C.e(N.route.package,N.route.provider,N.route.agency_id),y=await C.l(N.stopTime.package,N.stopTime.provider,N.stopTime.stop_id),p=N.path[N.path.length-1].stop_id,g=await C.l(N.route.package,N.route.provider,p),O+='    <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center route-selection" data-gtw-package="'+N.route.package+'" data-gtw-provider="'+N.route.provider+'" data-gtw-agency="'+N.route.agency_id+'" data-gtw-route-id="'+N.route.route_id+'" data-gtw-path-id="'+N.trip.path_id+'" data-gtw-stop-id="'+N.stopTime.stop_id+'" data-gtw-stop-seq="'+N.stopTime.stop_sequence+'">        <div class="d-flex flex-column route-id">            <div>'+m.localizedKey(I,"agency_short_name")+"</div>            <div>"+m.localizedKey(N.route,"route_short_name")+'</div>        </div>        <div class="d-flex flex-column stop-info mr-auto">            <div>                <b>'+t.i18n("transit-eta-to")+":</b> <small>"+C.t(I.agency_id,m.localizedKey(g,"stop_name"))+"</small></div>            <div>                "+C.t(I.agency_id,m.localizedKey(y,"stop_name"))+" ("+c+t.i18n("transit-eta-metres")+')            </div>        </div>        <span class="badge badge-primary badge-pill transit-eta">'+t.i18n("transit-eta-retrieving")+"</span>    </li>";O+="</ul>",t(".nearby-route-list").html(O),console.log("Used: "+(Date.now()-l)),t(".nearby-route-list .route-selection").on("mouseenter",M),t(".nearby-route-list .route-selection").on("mouseleave",(function(){})),t(".nearby-route-list .route-selection").on("click",L),D(".nearby-route-list"),F(),r=setInterval(F,3e4)}function P(){var a='<div class="d-flex justify-content-center w-100">    <div class="text-center">        <div class="spinner-grow m-5" style="width: 3rem; height: 3rem;"></div>        <div>'+t.i18n("transit-searching-nearby-routes")+"</div>    </div></div>";t(".nearby-route-list").html(a),B()}function G(a){console.log(a);var e='<div class="d-flex justify-content-center w-100">    <div class="text-center text-dark">        <i class="fas fa-exclamation-triangle m-5" style="width: 3rem; height: 3rem;"></i>        <div class="ml-3 mr-3">'+(1===a.code?t.i18n("location-error-user-denied-location"):2===a.code||3===a.code?t.i18n("location-error-could-not-get-location"):t.i18n("location-error-unknown",a.message))+"</div>    </div></div>";t(".nearby-route-list").html(e)}async function J(){u.a(),g.clearCache(),y.a(l=function(a){var e;if(t(a).hasClass("touch-keypad-function-done"))E(),adjustMargin();else if(t(a).hasClass("touch-keypad-function-backspace"))e=t("#search-transit-text").val(),t("#search-transit-text").val(e.slice(0,-1)),R();else if(t(a).hasClass("touch-keypad-value")){var i=t(a).html();e=t("#search-transit-text").val(),t("#search-transit-text").val(e+i),R()}}),b.b(b.a.EVENT_UI_BACK,o=function(){T&&y.h(),clearInterval(s)}),b.b(b.a.EVENT_LOCATION_ERROR,p=function(t){G(t)}),b.b(b.a.EVENT_LOCATION_SUCCESS,c=function(){P()}),b.b(b.a.EVENT_LOCATION_CHANGE,d=function(){if(k&&x){var t=f.a();h.c(t.lat,t.lng,k,x)>.125&&(console.log("Location moved 125 m away. Finding new nearby routes."),B())}});var a=await C.d();if(a.length>0){var e='<div class="hori-scroll btn-group">    <button type="button" class="btn btn-primary gtw-providersort gtw-providersort-all"><i class="fa fa-reply-all"></i><br />'+t.i18n("transit-eta-sort-all")+"</button>";for(var r of a){e+=' <button type="button" class="btn btn-default gtw-providersort gtw-providersort-provider" data-gtw-package="'+r.package+'" data-gtw-provider="'+r.provider+'" data-gtw-agency="'+r.agency_id+'"><i class="fa fa-bus"></i><br />'+m.localizedKey(r,"agency_short_name")+"</button>"}e+="</div>",t(".tab-panel").append(e);var n='<div class="input-group mb-3" style="margin-top: 16px;">    <input type="text" class="form-control" placeholder="'+t.i18n("transit-eta-placeholder-search-for-transit")+'" aria-label="'+t.i18n("transit-eta-placeholder-search-for-transit")+'" aria-describedby="search-transit-icon" id="search-transit-text" readonly/>    <div class="input-group-append">        <button class="btn btn-light disabled" type="button" id="button-cancel-search"><i class="fas fa-search"></i></button>    </div></div>';t(".tab-panel").append(n);t(".tab-panel").append('<div class="request-progress-panel">    <div class="progress bg-white">        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;"></div>    </div></div>'),t(".gtw-providersort").on("click",(function(){if(!t(this).hasClass("btn-primary"))if(t(this).hasClass("gtw-providersort-all"))q();else{t(".gtw-providersort").removeClass("btn-primary");var a=t(this).attr("data-gtw-package"),e=t(this).attr("data-gtw-provider"),i=t(this).attr("data-gtw-agency");t(this).addClass("btn-primary");var s="[data-gtw-package='"+a+"'][data-gtw-provider='"+e+"'][data-gtw-agency='"+i+"']";t(".gtw-providersort-provider:not("+s+")").addClass("btn-default"),t(".route-selection"+s).attr("style",""),t(".route-selection:not("+s+")").attr("style","display: none!important")}})),t("#button-cancel-search").on("click",(function(){t(this).hasClass("disabled")||z()}));t("#search-transit-text").on("click",(function(){y.h(),T=!0,t("#button-cancel-search").removeClass("btn-light"),t("#button-cancel-search").removeClass("disabled"),t("#button-cancel-search").addClass("btn-danger"),t("#button-cancel-search").html('<i class="fas fa-times"></i>'),t(".nearby-route-list").css("display","none"),t(".all-route-list").css("display","flex"),_.i(f.a()),_.k(16),_.f(),_.g(),R(),q(),D(".all-route-list")})),t("#search-transit-text").on("input",(function(){clearTimeout(i),i=setTimeout((function(){R()}),500)}));if(t(".content-panel-container").html('<div class="row item-list nearby-route-list"></div><div class="row item-list all-route-list"></div>'),f.c())G(f.b());else if(f.d())P();else{var v='<div class="d-flex justify-content-center w-100">    <div class="text-center">        <div class="spinner-grow m-5" style="width: 3rem; height: 3rem;"></div>        <div>'+t.i18n("transit-locating-your-location")+"</div>    </div></div>";t(".nearby-route-list").html(v)}}else t(".tab-panel").html('<br /><div class="alert alert-danger" role="alert"><i class="fas fa-exclamation-triangle"></i> '+t.i18n("transit-eta-no-plugins-providing-transit-data")+"</div>")}function W(){y.e(l),b.d(b.a.EVENT_UI_BACK,o),b.d(b.a.EVENT_LOCATION_ERROR,p),b.d(b.a.EVENT_LOCATION_SUCCESS,c),b.d(b.a.EVENT_LOCATION_CHANGE,d),clearTimeout(i),clearInterval(r),clearInterval(s),i=!1,r=!1}}.call(this,e(0))}}]);
//# sourceMappingURL=11.988e1a37be28fe2bd6df.js.map