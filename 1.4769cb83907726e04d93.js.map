{"version":3,"sources":["webpack:///./src/gtw-ui-touchkeypad.js","webpack:///./src/gtw-ui-tab-transit.js"],"names":["onClickListeners","mouseClickTouchKeypadValue","$","this","hasClass","listener","reset","each","removeClass","addClass","showTouchKeypad","css","adjustMargin","hideTouchKeypad","addListener","push","removeListener","index","indexOf","splice","setEnabled","keyMap","val","html","keys","Object","sort","a","b","charCodeAt","letterKeypadHtml","key","on","searchTimeout","updateStopEtaTimer","updateEtaTimer","allNearbyRoutes","maxRequest","touchKeypadListener","eventUiBackListener","eventLocChgListener","lastLat","lastLng","fromSearch","attr","filterProviderSort","listNodeCss","provider","length","searchRoutes","i","path","lastStop","routes","len","foundList","doNotShow","stopId","route","console","log","paths","bound","j","mid","midVal","compare","indexesList","routeName","value","substr","routeIndex","pathIndex","localeCompare","start","end","Math","floor","availableKeypads","charAt","id","routeId","i18n","mouseEnterPreviewRoute","mouseClickSelectRoute","resetProviderSort","clearSearch","drawRouteOnMap","pos","dbStop","coords","lat","lng","title","stopName","label","parent","getRouteById","stop","pathStop","distance","nearestDistance","nearestStop","showRouteList","scroll","x","lastStopId","screen","width","node","icon","children","scrollIntoView","targetPos","clearInterval","func","content","p","etaProviders","selectedPath","parseInt","then","data","h","options","code","schedules","active","schedule","eta","time","serverTime","error","colspan","undefined","msg","isLive","Date","getHours","getMinutes","catch","err","showStopEta","setInterval","sstop","latlngs","parseFloat","updateEta","requestLen","fadeIn","max","fadeOut","result","text","badgeClass","calcEta","badge","findNearbyRoutes","range","allNearbyStops","testRange","append","ceil","maxNearbyBusDisplay","stopResult","routeResults","routeResult","round","enable","obj","searchText","slice","EVENT_UI_BACK","EVENT_LOCATION_CHANGE","newLoc","providers","buttonScroll","iprovider","image","type","TransitType","BUS","TRAIN","searchField","removeAttr","clearTimeout","setTimeout","disable"],"mappings":"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","file":"1.4769cb83907726e04d93.js","sourcesContent":["var onClickListeners = [];\r\n\r\n$(\".touch-keypad-function-clear\").on(\"click\", mouseClickTouchKeypadValue);\r\n$(\".touch-keypad-function-backspace\").on(\"click\", mouseClickTouchKeypadValue);\r\n$(\".touch-keypad-value\").on(\"click\", mouseClickTouchKeypadValue);\r\n\r\nfunction mouseClickTouchKeypadValue() {\r\n    if ($(this).hasClass(\"disabled\")) {\r\n        return;\r\n    }\r\n    for (var listener of onClickListeners) {\r\n        listener(this);\r\n    }\r\n}\r\n\r\nexport function reset() {\r\n    $(\".numeric-keypad .touch-keypad-value\").each(function () {\r\n        $(this).removeClass(\"disabled\");\r\n        $(this).removeClass(\"btn-secondary\");\r\n        $(this).addClass(\"btn-outline-secondary\");\r\n    });\r\n}\r\n\r\nexport function showTouchKeypad() {\r\n    $(\".touch-keypad\").css(\"display\", \"flex\");\r\n    adjustMargin();\r\n}\r\n\r\nexport function hideTouchKeypad() {\r\n    $(\".touch-keypad\").css(\"display\", \"\");\r\n    adjustMargin();\r\n}\r\n\r\nexport function addListener(listener) {\r\n    if (typeof listener !== \"function\") {\r\n        return false;\r\n    }\r\n    onClickListeners.push(listener);\r\n    return true;\r\n}\r\n\r\nexport function removeListener(listener) {\r\n    if (typeof listener !== \"function\") {\r\n        return false;\r\n    }\r\n    var index = onClickListeners.indexOf(listener);\r\n    if (index !== -1) {\r\n        onClickListeners.splice(index, 1);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function setEnabled(keyMap) {\r\n    $(\".numeric-keypad .touch-keypad-value\").each(function () {\r\n        var val = $(this).html();\r\n        if (!keyMap[val]) {\r\n            $(this).addClass(\"disabled\");\r\n            $(this).addClass(\"btn-secondary\");\r\n            $(this).removeClass(\"btn-outline-secondary\");\r\n        } else {\r\n            $(this).removeClass(\"disabled\");\r\n            $(this).removeClass(\"btn-secondary\");\r\n            $(this).addClass(\"btn-outline-secondary\");\r\n        }\r\n        delete keyMap[val];\r\n    });\r\n\r\n    var keys = Object.keys(keyMap);\r\n    keys.sort(function (a, b) {\r\n        return a.charCodeAt(0) - b.charCodeAt(0);\r\n    });\r\n\r\n    var letterKeypadHtml = \"\";\r\n    for (var key of keys) {\r\n        letterKeypadHtml += \"<button type=\\\"button\\\" class=\\\"btn btn-outline-secondary py-3 touch-keypad-key touch-keypad-value\\\">\" + key + \"</button>\";\r\n    }\r\n    $(\".letter-keypad\").html(letterKeypadHtml);\r\n\r\n    $(\".letter-keypad .touch-keypad-value\").on(\"click\", mouseClickTouchKeypadValue);\r\n}","import * as Transit from './gtw-citydata-transit';\r\nimport * as TransitRoutes from './gtw-citydata-transit-routes';\r\nimport * as TransitStops from './gtw-citydata-transit-stops';\r\nimport * as TransitEta from './gtw-citydata-transit-eta';\r\nimport * as RequestLimiter from './gtw-requestlimiter';\r\nimport * as Settings from './gtw-settings';\r\nimport * as Misc from './gtw-misc';\r\nimport * as Lang from './gtw-lang';\r\nimport * as Loc from './gtw-location';\r\nimport * as TouchKeypad from './gtw-ui-touchkeypad';\r\nimport * as Event from './gtw-event';\r\nimport * as UI from './gtw-ui';\r\nimport * as Map from './gtw-map';\r\n\r\nvar searchTimeout;\r\nvar updateStopEtaTimer;\r\nvar updateEtaTimer;\r\nvar allNearbyRoutes;\r\nvar maxRequest;\r\nvar touchKeypadListener;\r\nvar eventUiBackListener;\r\nvar eventLocChgListener;\r\nvar lastLat = false;\r\nvar lastLng = false;\r\nvar fromSearch = false;\r\n\r\nfunction showTouchKeypad() {\r\n    $(\"#search-transit-text\").removeAttr(\"readonly\");\r\n    TouchKeypad.showTouchKeypad();\r\n}\r\n\r\nfunction hideTouchKeypad() {\r\n    $(\"#search-transit-text\").attr(\"readonly\", \"readonly\");\r\n    TouchKeypad.hideTouchKeypad();\r\n}\r\n\r\nfunction showSearchRoutes() {\r\n    $(\"#button-cancel-search\").removeClass(\"btn-light\");\r\n    $(\"#button-cancel-search\").removeClass(\"disabled\");\r\n    $(\"#button-cancel-search\").addClass(\"btn-danger\");\r\n    $(\"#button-cancel-search\").html(\"<i class=\\\"fas fa-times\\\"></i>\");\r\n\r\n    $(\".nearby-route-list\").css(\"display\", \"none\");\r\n    $(\".all-route-list\").css(\"display\", \"flex\");\r\n    Map.setCenter(Loc.getCurrentPosition());\r\n    Map.setZoom(16);\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n    searchRoutes();\r\n    resetProviderSort();\r\n    filterProviderSort(\".all-route-list\");\r\n}\r\n\r\nfunction hideSearchRoutes() {\r\n    $(\"#button-cancel-search\").addClass(\"btn-light\");\r\n    $(\"#button-cancel-search\").addClass(\"disabled\");\r\n    $(\"#button-cancel-search\").removeClass(\"btn-danger\");\r\n    $(\"#button-cancel-search\").html(\"<i class=\\\"fas fa-search\\\"></i>\");\r\n\r\n    $(\".nearby-route-list\").css(\"display\", \"flex\");\r\n    $(\".all-route-list\").css(\"display\", \"none\");\r\n\r\n    Map.setCenter(Loc.getCurrentPosition());\r\n    Map.setZoom(16);\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n\r\n    resetProviderSort();\r\n    filterProviderSort(\".nearby-route-list\");\r\n}\r\n\r\nfunction filterProviderSort(listNodeCss) {\r\n    $(\".gtw-providersort-provider\").each(function () {\r\n        var provider = $(this).attr(\"gtw-provider\");\r\n        var contain = $(listNodeCss + \" .route-selection[gtw-provider='\" + provider + \"']\").length > 0;\r\n        if (contain) {\r\n            $(this).css(\"display\", \"\");\r\n        } else {\r\n            $(this).css(\"display\", \"none\");\r\n        }\r\n    });\r\n}\r\n\r\nfunction searchRoutes() {\r\n    var val = $(\"#search-transit-text\").val();\r\n    var useKeypad = true;\r\n    if (!useKeypad) {\r\n        clearSearch();\r\n        return;\r\n    }\r\n\r\n    var routes = TransitRoutes.getAllRoutes();\r\n\r\n    var len = val.length;\r\n\r\n    var foundList = [];\r\n\r\n    var i;\r\n    var provider;\r\n    var route;\r\n    var path;\r\n    var lastStop;\r\n    var doNotShow = false;\r\n\r\n    if (len === 0) {\r\n        doNotShow = true;\r\n        console.log(\"No query input.\");\r\n        var stopId;\r\n        for (var route of routes) {\r\n            provider = TransitRoutes.getProvider(route.provider);\r\n            for (i = 0; i < route.paths.length; i++) {\r\n                path = route.paths[i];\r\n                stopId = path[path.length - 1];\r\n                lastStop = TransitStops.getStopById(stopId);\r\n                foundList.push({\r\n                    provider: provider,\r\n                    route: route,\r\n                    lastStop: lastStop,\r\n                    bound: i\r\n                });\r\n            }\r\n        }\r\n    } else {\r\n        var j;\r\n        var indexesList = [];\r\n        for (i = 0; i < routes.length; i++) {\r\n            routeName = Lang.localizedKey(routes[i], \"routeName\");\r\n            if (routeName.length >= len) {\r\n                for (j = 0; j < routes[i].paths.length; j++) {\r\n                    indexesList.push({\r\n                        value: routeName.substr(0, len),\r\n                        routeIndex: i,\r\n                        pathIndex: j\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        indexesList.sort(function (a, b) {\r\n            return a.value.localeCompare(b.value);//Misc.stringCompare(a.value, b.value);\r\n        });\r\n\r\n        var mid;\r\n        var midVal;\r\n        var compare;\r\n        var start = 0;\r\n        var end = indexesList.length - 1;\r\n\r\n        while (start < end) {\r\n            mid = Math.floor((start + end) / 2);\r\n            midVal = indexesList[mid];\r\n            compare = val.localeCompare(midVal.value);//Misc.stringCompare(val, midVal.value);\r\n\r\n            if (compare === 0) {\r\n                end = mid;\r\n            } else if (compare > 0) {\r\n                start = mid + 1;\r\n            } else {\r\n                end = mid - 1;\r\n            }\r\n        }\r\n\r\n        if (indexesList[start].value === val) {\r\n            var index;\r\n            for (i = start; i < indexesList.length; i++) {\r\n                index = indexesList[i];\r\n\r\n                if (index.value !== val) {\r\n                    break;\r\n                }\r\n\r\n                route = routes[index.routeIndex];\r\n                provider = TransitRoutes.getProvider(route.provider);\r\n                path = route.paths[index.pathIndex];\r\n                lastStop = TransitStops.getStopById(path[path.length - 1]);\r\n\r\n                foundList.push({\r\n                    provider: provider,\r\n                    route: routes[index.routeIndex],\r\n                    lastStop: lastStop,\r\n                    bound: index.pathIndex\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    var html = \"<ul class=\\\"list-group\\\">\";\r\n\r\n    var routeName;\r\n    var availableKeypads = {};\r\n    for (i = 0; i < foundList.length; i++) {\r\n        routeName = Lang.localizedKey(foundList[i].route, \"routeName\");\r\n\r\n        if (val.length < routeName.length) {\r\n            var letter = routeName.charAt(val.length);\r\n            availableKeypads[letter] = true;\r\n        }\r\n\r\n        if (!doNotShow) {\r\n            html +=\r\n                \"<li class=\\\"list-group-item list-group-item-action d-flex align-items-center route-selection\\\" gtw-provider=\\\"\" + foundList[i].provider.id + \"\\\" gtw-route-id=\\\"\" + foundList[i].route.routeId + \"\\\" gtw-bound=\\\"\" + foundList[i].bound + \"\\\">\" +\r\n                \"    <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n                \"        <div>\" + Lang.localizedKey(foundList[i].provider, \"name\") + \"</div>\" +\r\n                \"        <div>\" + routeName + \"</div>\" +\r\n                \"    </div>\" +\r\n                \"    <div><b>\" + $.i18n(\"transit-eta-to\") + \":</b> \" + Lang.localizedKey(foundList[i].lastStop, \"stopName\") + \"</div>\" +\r\n                \"</li>\";\r\n        }\r\n    }\r\n\r\n    html += \"</ul>\";\r\n    $(\".all-route-list\").html(html);\r\n\r\n    TouchKeypad.setEnabled(availableKeypads);\r\n\r\n    $(\".all-route-list .route-selection\").on(\"mouseenter\", mouseEnterPreviewRoute);\r\n    $(\".all-route-list .route-selection\").on(\"click\", mouseClickSelectRoute);\r\n\r\n    //$(\".all-route-list .route-selection:nth-child(1)\").mouseenter();\r\n\r\n    filterProviderSort(\".all-route-list\");\r\n}\r\n\r\nfunction resetProviderSort() {\r\n    $(\".gtw-providersort\").removeClass(\"btn-primary\");\r\n    $(\".gtw-providersort-all\").addClass(\"btn-primary\");\r\n\r\n    //$(\".gtw-providersort-provider\").addClass(\"btn-default\");\r\n    $(\".route-selection\").attr(\"style\", \"\");\r\n}\r\n\r\nfunction clearSearch() {\r\n    hideTouchKeypad();\r\n    $(\"#search-transit-text\").val(\"\");\r\n    hideSearchRoutes();\r\n    TouchKeypad.reset();\r\n}\r\n\r\nfunction drawRouteOnMap(route, bound) {\r\n    var path = route.paths[bound];\r\n\r\n    var coords = [];\r\n    var pos;\r\n    var dbStop;\r\n    var i;\r\n    for (i = 0; i < path.length; i++) {\r\n        dbStop = TransitStops.getStopById(path[i]);\r\n        pos = { lat: dbStop.lat, lng: dbStop.lng };\r\n        coords.push(pos);\r\n        Map.addMarker(pos, {\r\n            title: dbStop.stopName,\r\n            label: \"\" + (i + 1)\r\n        });\r\n    }\r\n\r\n    Map.addPolyline(coords, \"#FF0000\", 2);\r\n}\r\n\r\nfunction mouseClickSelectRoute() {\r\n    fromSearch = $(this).parent().parent().hasClass(\"all-route-list\");\r\n\r\n    UI.hidePanel();\r\n    hideTouchKeypad();\r\n\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n\r\n    var provider = TransitRoutes.getProvider($(this).attr(\"gtw-provider\"));\r\n    var route = provider.getRouteById($(this).attr(\"gtw-route-id\"));\r\n    var stop = TransitStops.getStopById($(this).attr(\"gtw-stop-id\"));\r\n    var bound = $(this).attr(\"gtw-bound\");\r\n\r\n    if (!stop) {\r\n        var pos = Loc.getCurrentPosition();\r\n        var path = route.paths[bound];\r\n        var pathStop;\r\n        var distance;\r\n        var nearestDistance = false;\r\n        var nearestStop = false;\r\n        for (var stopId of path) {\r\n            pathStop = TransitStops.getStopById(stopId);\r\n            distance = Misc.geoDistance(pathStop.lat, pathStop.lng, pos.lat, pos.lng);\r\n            if (!nearestDistance || !nearestStop || distance < nearestDistance) {\r\n                nearestDistance = distance;\r\n                nearestStop = pathStop;\r\n            }\r\n        }\r\n\r\n        console.log(nearestDistance);\r\n        if (nearestDistance <= 2) {\r\n            stop = nearestStop;\r\n        }\r\n    }\r\n\r\n    showRouteList(route, bound, stop, true);\r\n    drawRouteOnMap(route, bound);\r\n}\r\n\r\nfunction mouseEnterPreviewRoute() {\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n    var provider = TransitRoutes.getProvider($(this).attr(\"gtw-provider\"));\r\n    var route = provider.getRouteById($(this).attr(\"gtw-route-id\"));\r\n    var sstop = TransitStops.getStopById($(this).attr(\"gtw-stop-id\"));\r\n    var bound = $(this).attr(\"gtw-bound\");\r\n    drawRouteOnMap(route, bound);\r\n\r\n    if (sstop) {\r\n        var targetPos = { lat: sstop.lat, lng: sstop.lng };\r\n        Map.setCenter(targetPos);\r\n        Map.setZoom(18);\r\n    } else {\r\n        var path = route.paths[bound];\r\n\r\n        var latlngs = [];\r\n        var stop;\r\n        for (var stopId of path) {\r\n            stop = TransitStops.getStopById(stopId);\r\n            latlngs.push({ lat: parseFloat(stop.lat), lng: parseFloat(stop.lng) });\r\n        }\r\n        Map.fitBounds(latlngs);\r\n    }\r\n}\r\n\r\nfunction showRouteList(route, bound, stop = false, scroll = false) {\r\n    var html = \"<div class=\\\"row\\\" style=\\\"padding: 2%;\\\"><div class=\\\"timeline-centered\\\">\";\r\n    var path = route.paths[bound];\r\n    var dbStop;\r\n    var i;\r\n    for (i = 0; i < path.length; i++) {\r\n        dbStop = TransitStops.getStopById(path[i]);\r\n        html +=\r\n            \"<article class=\\\"timeline-entry\\\" stop-id=\\\"\" + dbStop.stopId + \"\\\" stop-index=\\\"\" + i + \"\\\">\" +\r\n            \"    <div class=\\\"timeline-entry-inner\\\">\" +\r\n            \"        <div class=\\\"timeline-icon bg-light\\\">\" +\r\n            \"            \" + (i + 1) +\r\n            \"        </div>\" +\r\n            \"        <div class=\\\"timeline-label\\\">\" +\r\n            \"            <h2><button style=\\\"padding: 0px;\\\" class=\\\"btn btn-link\\\" stop-id=\\\"\" + dbStop.stopId + \"\\\">\" + Lang.localizedKey(dbStop, \"stopName\") + \"</button></h2>\" +\r\n            \"            <p></p>\" +\r\n            \"        </div>\" +\r\n            \"    </div>\" +\r\n            \"</article>\"\r\n            ;\r\n    }\r\n    html += \"</div></div>\";\r\n    $(\".half-map-container\").html(html);\r\n\r\n    $(\".half-map-container button\").on(\"click\", function () {\r\n        var x = TransitStops.getStopById($(this).attr(\"stop-id\"));\r\n        if (x) {\r\n            showRouteList(route, bound, x);\r\n        }\r\n    });\r\n\r\n    var provider = TransitRoutes.getProvider(route.provider);\r\n    var lastStopId = path[path.length - 1];\r\n    html =\r\n        \"<ul class=\\\"list-group\\\"><li class=\\\"list-group-item d-flex align-items-center route-selection\\\">\" +\r\n        \"    <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n        \"        <div>\" + Lang.localizedKey(provider, \"name\") + \"</div>\" +\r\n        \"        <div>\" + Lang.localizedKey(route, \"routeName\") + \"</div>\" +\r\n        \"    </div>\" +\r\n        \"    <div><b>\" + $.i18n(\"transit-eta-to\") + \":</b> \" + Lang.localizedKey(TransitStops.getStopById(lastStopId), \"stopName\") + \"</div>\" +\r\n        \"</li></ul>\"\r\n        ;\r\n    $(\".half-map-tab-panel\").html(html);\r\n\r\n    adjustMargin();\r\n    if (stop) {\r\n        var parent = screen.width >= 768 ? \".desktop\" : \".mobile\";\r\n\r\n        var node = $(parent + \" .timeline-entry[stop-id='\" + stop.stopId + \"']\");\r\n\r\n        var icon = node.children().children(\".timeline-icon\");\r\n        icon.removeClass(\"bg-light\");\r\n        icon.addClass(\"bg-primary\");\r\n\r\n        if (scroll) {\r\n            node[0].scrollIntoView();\r\n        }\r\n\r\n        var targetPos = { lat: stop.lat, lng: stop.lng };\r\n\r\n        Map.setCenter(targetPos);\r\n        Map.setZoom(18);\r\n\r\n        clearInterval(updateStopEtaTimer);\r\n        var func = function () {\r\n            showStopEta(route, bound, stop);\r\n        };\r\n        func();\r\n        updateStopEtaTimer = setInterval(func, 30000);\r\n    }\r\n}\r\n\r\nfunction showStopEta(route, bound, stop) {\r\n    var node = $(\".timeline-entry[stop-id='\" + stop.stopId + \"'] p\");\r\n\r\n    var content =\r\n        \"<p><u>\" + $.i18n(\"transit-eta\") + \"</u></p>\" +\r\n        \"<table class=\\\"table stop-eta\\\">\"\r\n        ;\r\n\r\n    var p = TransitEta.fetchEta({\r\n        provider: route.provider,\r\n        etaProviders: route.etaProviders,\r\n        routeId: route.routeId,\r\n        selectedPath: parseInt(bound),\r\n        stopId: stop.stopId\r\n    });\r\n    if (!p) {\r\n        content +=\r\n            \"<tr class=\\\"table-dark\\\">\" +\r\n            \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-route-not-available\") + \"</td>\" +\r\n            //\"    <td>---</td>\" +\r\n            \"</tr>\"\r\n            ;\r\n    } else {\r\n        content +=\r\n            \"<tr class=\\\"table-dark\\\">\" +\r\n            \"    <td colspan=\\\"4\\\"><div class=\\\"spinner-border spinner-border-sm\\\" role=\\\"status\\\"></div> \" + $.i18n(\"transit-eta-retrieving-data\") + \"</td>\" +\r\n            \"</tr>\";\r\n        p.then(function (data) {\r\n            var h = data.options;\r\n            var content = \"\";\r\n            var node = $(\".timeline-entry[stop-id='\" + h.stopId + \"'] p table tbody\");\r\n            if (data.code && data.code === -2) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-eta-providers\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else if (!data.schedules || data.code && data.code === -1) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-data-received\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else if (data.schedules.length === 0) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-schedules-pending\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else {\r\n                var active = false;\r\n                for (var schedule of data.schedules) {\r\n                    var eta = Math.floor((schedule.time - schedule.serverTime) / 1000 / 60);\r\n\r\n                    var html = \"<tr class=\\\"table-\";\r\n\r\n                    if (eta >= 20) {\r\n                        html += \"secondary\";\r\n                    } else if (eta >= 15) {\r\n                        html += \"info\";\r\n                    } else if (eta >= 10) {\r\n                        html += \"success\";\r\n                    } else if (eta >= 5) {\r\n                        html += \"warning\";\r\n                    } else if (eta >= 1) {\r\n                        html += \"danger\";\r\n                    } else {\r\n                        html += \"dark\";\r\n                    }\r\n\r\n                    if (!active && eta > 0) {\r\n                        active = true;\r\n                        html += \" active\";\r\n                    }\r\n\r\n                    html += \"\\\">\";\r\n\r\n                    //TODO: isOutdated\r\n\r\n                    var provider = TransitEta.getProvider(schedule.provider);\r\n                    if (!provider) {\r\n                        console.error(\"Error: Could not find TransitEta provider to get localized names: \" + schedule.provider);\r\n                        return;\r\n                    }\r\n\r\n                    var colspan = 4;\r\n\r\n                    if (h.etaProviders.length > 1) {\r\n                        html += \"<td>\" + Lang.localizedKey(provider, \"name\") + \"</td>\";\r\n                        colspan--;\r\n                    }\r\n\r\n                    if (schedule.msg !== undefined && schedule.time === undefined) {\r\n                        html += \"<td colspan=\\\"\" + colspan + \"\\\">\" + schedule.msg + \"</td>\";\r\n                    } else {\r\n                        html += \"<td>\";\r\n                        if (schedule.msg !== undefined) {\r\n                            html += schedule.msg;\r\n                        }\r\n                        if (schedule.time !== undefined) {\r\n                            if (schedule.msg !== undefined) {\r\n                                html += \"<br />\";\r\n                            }\r\n                            if (eta > 0) {\r\n                                html += $.i18n(\"transit-eta-minutes\", eta);\r\n                            } else {\r\n                                html += $.i18n(\"transit-eta-arrived-left\");\r\n                            }\r\n                        }\r\n\r\n                        html += \"</td><td\";\r\n\r\n                        if (schedule.isLive === undefined) {\r\n                            html += \" colspan=\\\"2\\\"\";\r\n                        }\r\n\r\n                        html += \">\";\r\n\r\n                        var time = new Date(schedule.time);\r\n\r\n                        if (schedule.time !== undefined) {\r\n                            html += Misc.fillZero(time.getHours()) + \":\" + Misc.fillZero(time.getMinutes());\r\n                        } else {\r\n                            html += \"---\";\r\n                        }\r\n\r\n                        html += \"</td>\";\r\n\r\n                        if (schedule.isLive !== undefined) {\r\n                            if (schedule.isLive) {\r\n                                html += \"<td><span style=\\\"color: red; float: right; font-size: 10px;\\\"><i class=\\\"fa fa-circle\\\"></i> \" + $.i18n(\"transit-eta-live\") + \"</span></td>\";\r\n                            } else {\r\n                                html += \"<td><span style=\\\"font-size: 10px; float: right; font-style: italic;\\\">\" + $.i18n(\"transit-eta-scheduled\") + \"</span></td>\";\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    //TODO: Features\r\n\r\n                    html += \"</tr>\";\r\n                    content += html;\r\n                }\r\n            }\r\n            node.html(content);\r\n        }).catch(function (options, err) {\r\n            var node = $(\".timeline-entry[stop-id='\" + options.stopId + \"'] p table tbody\");\r\n            node.html(\"<tr class=\\\"table-danger\\\"><td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-error-fetching-eta\") + \"</td></tr>\");\r\n        });\r\n    }\r\n\r\n    content += \"</table>\";\r\n\r\n    node.html(content);\r\n}\r\n\r\nfunction updateEta() {\r\n    var requestLen = RequestLimiter.requests.length;\r\n    if (requestLen > 0) {\r\n        $(\".request-progress-panel\").fadeIn(500);\r\n\r\n        var max = maxRequest;\r\n        if (!max || requestLen > max) {\r\n            max = maxRequest = requestLen;\r\n        }\r\n\r\n        $(\".request-progress-panel .progress-bar\").html($.i18n(\"transit-eta-requesting-data\", max - requestLen, max));\r\n        //$(\".request-progress-panel .progress-bar\").html(Math.floor((max - requestLen) / max * 100) + \"%\");\r\n        $(\".request-progress-panel .progress-bar\").css(\"width\", Math.floor((max - requestLen) / max * 100) + \"%\");\r\n    } else {\r\n        maxRequest = 0;\r\n        $(\".request-progress-panel .progress-bar\").css(\"width\", \"100%\");\r\n        $(\".request-progress-panel\").fadeOut(500, function () {\r\n            $(\".request-progress-panel .progress-bar\").css(\"width\", \"0%\");\r\n        });\r\n    }\r\n    //var h;\r\n    for (var result of allNearbyRoutes) {\r\n        var p = TransitEta.fetchEta({\r\n            provider: result.route.provider,\r\n            etaProviders: result.route.etaProviders,\r\n            routeId: result.route.routeId,\r\n            selectedPath: result.bound,\r\n            stopId: result.stop.stopId\r\n        });\r\n        p.then(function (eta) {\r\n            var text = \"\";\r\n            var h = eta.options;\r\n\r\n            var node = $(\".nearby-route-list .route-selection[gtw-provider=\\\"\" + h.provider + \"\\\"][gtw-route-id=\\\"\" + h.routeId + \"\\\"][gtw-bound=\\\"\" + h.selectedPath + \"\\\"][gtw-stop-id=\\\"\" + h.stopId + \"\\\"]\");\r\n\r\n            node.removeClass(\"list-group-item-secondary\");\r\n            node.removeClass(\"list-group-item-info\");\r\n            node.removeClass(\"list-group-item-success\");\r\n            node.removeClass(\"list-group-item-warning\");\r\n            node.removeClass(\"list-group-item-danger\");\r\n            node.removeClass(\"list-group-item-light\");\r\n            node.removeClass(\"list-group-item-dark\");\r\n\r\n            var badgeClass = \"btn-secondary\";\r\n\r\n            if (!eta || !eta.schedules || eta.code && eta.code < 0) {\r\n                text = $.i18n(\"transit-eta-route-not-available-short\");\r\n                node.addClass(\"list-group-item-light\");\r\n            } else if (eta.schedules.length === 0) {\r\n                text = $.i18n(\"transit-eta-no-schedules-pending-short\");\r\n                node.addClass(\"list-group-item-light\");\r\n            } else {\r\n                var schedule = eta.schedules[0];\r\n\r\n                var calcEta = Math.floor((schedule.time - schedule.serverTime) / 1000 / 60);\r\n\r\n                var css = \"\";\r\n\r\n                if (calcEta >= 20) {\r\n                    css = \"secondary\";\r\n                } else if (calcEta >= 15) {\r\n                    css = \"info\";\r\n                } else if (calcEta >= 10) {\r\n                    css = \"success\";\r\n                } else if (calcEta >= 5) {\r\n                    css = \"warning\";\r\n                } else if (calcEta >= 1) {\r\n                    css = \"danger\";\r\n                } else {\r\n                    css = \"dark\";\r\n                }\r\n                node.addClass(\"list-group-item-\" + css);\r\n\r\n                //TODO: isOutdated\r\n\r\n                if (schedule.msg !== undefined) {\r\n                    var msg = schedule.msg;\r\n                    if (msg.length > 20) {\r\n                        text = $.i18n(\"transit-eta-transit-notice\");\r\n                    } else {\r\n                        text = schedule.msg;\r\n                    }\r\n                    badgeClass = \"badge-warning\";\r\n                } else if (schedule.time !== undefined) {\r\n                    if (schedule.msg !== undefined) {\r\n                        text += \"<br />\";\r\n                    }\r\n\r\n                    badgeClass = \"badge-primary\";\r\n                    if (calcEta > 0) {\r\n                        text += $.i18n(\"transit-eta-minutes\", calcEta);\r\n                    } else {\r\n                        text += $.i18n(\"transit-eta-arrived-left\", calcEta);\r\n                        badgeClass = \"badge-dark\";\r\n                    }\r\n\r\n                    if (schedule.isLive !== undefined) {\r\n                        text += \"<br /><span style=\\\"font-size: 10px; position: absolute; top: 16px; right: 16px; \";\r\n                        if (schedule.isLive) {\r\n                            text += \"color: red;\\\"><i class=\\\"fa fa-circle\\\"></i> \" + $.i18n(\"transit-eta-live\") + \"</span>\";\r\n                        } else {\r\n                            text += \"color: black; font-style: italic;\\\">\" + $.i18n(\"transit-eta-scheduled\") + \"</span>\";\r\n                        }\r\n                    }\r\n                }\r\n\r\n                /*\r\n                if (schedule.hasTime) {\r\n                    text += Misc.fillZero(schedule.time.hr) + \":\" + Misc.fillZero(schedule.time.min);\r\n                } else {\r\n                    text += \"---\";\r\n                }\r\n                */\r\n\r\n                //TODO: Features\r\n            }\r\n            var badge = node.children(\".transit-eta\");\r\n\r\n            badge.removeClass(\"badge-primary\");\r\n            badge.removeClass(\"badge-secondary\");\r\n            badge.removeClass(\"badge-warning\");\r\n            badge.removeClass(\"badge-danger\");\r\n            badge.removeClass(\"badge-dark\");\r\n            badge.addClass(badgeClass);\r\n\r\n            badge.html(text);\r\n        }).catch(function (options, err) {\r\n            var node = $(\".nearby-route-list .route-selection[gtw-provider=\\\"\" + options.provider + \"\\\"][gtw-route-id=\\\"\" + options.routeId + \"\\\"][gtw-bound=\\\"\" + options.selectedPath + \"\\\"][gtw-stop-id=\\\"\" + options.stopId + \"\\\"]\");\r\n\r\n            node.removeClass(\"list-group-item-secondary\");\r\n            node.removeClass(\"list-group-item-info\");\r\n            node.removeClass(\"list-group-item-success\");\r\n            node.removeClass(\"list-group-item-warning\");\r\n            node.removeClass(\"list-group-item-danger\");\r\n            node.removeClass(\"list-group-item-light\");\r\n            node.removeClass(\"list-group-item-dark\");\r\n            node.addClass(\"list-group-item-light\");\r\n\r\n            var badge = node.children(\".transit-eta\");\r\n\r\n            badge.removeClass(\"badge-primary\");\r\n            badge.removeClass(\"badge-secondary\");\r\n            badge.removeClass(\"badge-warning\");\r\n            badge.removeClass(\"badge-danger\");\r\n            badge.removeClass(\"badge-dark\");\r\n            badge.addClass(\"badge-danger\");\r\n\r\n            badge.html($.i18n(\"transit-eta-error-fetching-eta-short\"));\r\n        });\r\n    }\r\n}\r\n\r\nfunction findNearbyRoutes() {\r\n    clearInterval(updateEtaTimer);\r\n\r\n    var pos = Loc.getCurrentPosition();\r\n\r\n    var lat = pos.lat;\r\n    var lng = pos.lng;\r\n\r\n    lastLat = lat;\r\n    lastLng = lng;\r\n\r\n    var range = Settings.get(\"min_nearby_transit_range\", 200) / 1000.0;\r\n\r\n    var allNearbyStops = TransitStops.getAllStopsNearby(lat, lng, range, true, true);\r\n\r\n    if (allNearbyStops.length === 0) {\r\n        var testRange = range;\r\n        do {\r\n            testRange += 0.05;\r\n            allNearbyStops = TransitStops.getAllStopsNearby(lat, lng, testRange, true, true);\r\n        } while (allNearbyStops.length === 0 && testRange < 10);\r\n\r\n        if (testRange >= 10) {\r\n            $(\".tab-panel\").append(\r\n                \"<div class=\\\"alert alert-danger alert-dismissable\\\">\" +\r\n                \"<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\" aria-hidden=\\\"true\\\" >&#215;</button>\" +\r\n                \"No routes are found in 10 km range.\" +\r\n                \"</div>\"\r\n            );\r\n        } else {\r\n            $(\".tab-panel\").append(\r\n                \"<div class=\\\"alert alert-warning alert-dismissable\\\">\" +\r\n                \"<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\" aria-hidden=\\\"true\\\" >&#215;</button>\" +\r\n                $.i18n(\"transit-eta-no-routes-found-nearby-extended-range\", range * 1000, Math.ceil(testRange * 1000)) +\r\n                \"</div>\"\r\n            );\r\n        }\r\n    }\r\n\r\n    var maxNearbyBusDisplay = Settings.get(\"max_nearby_transit_to_display\", 20);\r\n    allNearbyRoutes = [];\r\n    for (var stopResult of allNearbyStops) {\r\n        if (allNearbyRoutes.length >= maxNearbyBusDisplay) {\r\n            break;\r\n        }\r\n\r\n        var routeResults = Transit.searchRoutesOfStop(stopResult.stop);\r\n\r\n        for (var routeResult of routeResults) {\r\n            allNearbyRoutes.push({\r\n                route: routeResult.route,\r\n                bound: routeResult.bound,\r\n                stop: stopResult.stop,\r\n                distance: stopResult.distance\r\n            });\r\n        }\r\n    }\r\n\r\n    var html;\r\n    var distance;\r\n    var paths;\r\n    var stopId;\r\n    var provider;\r\n    html = \"<div class=\\\"row item-list nearby-route-list\\\"><ul class=\\\"list-group\\\">\";\r\n    for (var result of allNearbyRoutes) {\r\n        paths = result.route.paths[result.bound];\r\n        stopId = paths[paths.length - 1];\r\n        distance = Math.round(result.distance * 1000);\r\n        provider = TransitRoutes.getProvider(result.route.provider);\r\n        html +=\r\n            \"    <li class=\\\"list-group-item list-group-item-action d-flex justify-content-between align-items-center route-selection\\\" gtw-provider=\\\"\" + result.route.provider + \"\\\" gtw-route-id=\\\"\" + result.route.routeId + \"\\\" gtw-stop-id=\\\"\" + result.stop.stopId + \"\\\" gtw-bound=\\\"\" + result.bound + \"\\\">\" +\r\n            \"        <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n            \"            <div>\" + Lang.localizedKey(provider, \"name\") + \"</div>\" +\r\n            \"            <div>\" + Lang.localizedKey(result.route, \"routeName\") + \"</div>\" +\r\n            \"        </div>\" +\r\n            \"        <div class=\\\"d-flex flex-column stop-info mr-auto\\\">\" +\r\n            \"            <div>\" +\r\n            \"                <b>\" + $.i18n(\"transit-eta-to\") + \":</b> <small>\" + Lang.localizedKey(TransitStops.getStopById(stopId), \"stopName\") +\r\n            \"</small></div>\" +\r\n            \"            <div>\" +\r\n            \"                \" + Lang.localizedKey(result.stop, \"stopName\") + \" (\" + distance + $.i18n(\"transit-eta-metres\") + \")\" +\r\n            \"            </div>\" +\r\n            \"        </div>\" +\r\n            \"        <span class=\\\"badge badge-primary badge-pill transit-eta\\\">\" + $.i18n(\"transit-eta-retrieving\") + \"</span>\" +\r\n            \"    </li>\";\r\n    }\r\n    html += \"</ul></div><div class=\\\"row item-list all-route-list\\\"></div>\";\r\n\r\n    $(\".content-panel-container\").html(html);\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"mouseenter\", mouseEnterPreviewRoute);\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"mouseleave\", function () {\r\n        //Map.setCenter(Loc.getCurrentPosition());\r\n        //Map.setZoom(16);\r\n        //Map.removeAllMarkers();\r\n        //Map.removeAllPolylines();\r\n    });\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"click\", mouseClickSelectRoute);\r\n\r\n    filterProviderSort(\".nearby-route-list\");\r\n\r\n    updateEta();\r\n    updateEtaTimer = setInterval(updateEta, 30000);\r\n}\r\n\r\nexport function enable() {\r\n    RequestLimiter.clear();\r\n    TransitEta.clearCache();\r\n\r\n    TouchKeypad.addListener(touchKeypadListener = function (obj) {\r\n        var searchText;\r\n        if ($(obj).hasClass(\"touch-keypad-function-clear\")) {\r\n            clearSearch();\r\n        } else if ($(obj).hasClass(\"touch-keypad-function-backspace\")) {\r\n            searchText = $(\"#search-transit-text\").val();\r\n            $(\"#search-transit-text\").val(searchText.slice(0, -1));\r\n            searchRoutes();\r\n        } else if ($(obj).hasClass(\"touch-keypad-value\")) {\r\n            var val = $(obj).html();\r\n            searchText = $(\"#search-transit-text\").val();\r\n            $(\"#search-transit-text\").val(searchText + val);\r\n            searchRoutes();\r\n        }\r\n    });\r\n\r\n    Event.addListener(Event.EVENTS.EVENT_UI_BACK, eventUiBackListener = function (){\r\n        if (fromSearch) {\r\n            TouchKeypad.showTouchKeypad();\r\n        }\r\n        clearInterval(updateStopEtaTimer);\r\n    });\r\n\r\n    Event.addListener(Event.EVENTS.EVENT_LOCATION_CHANGE, eventLocChgListener = function () {\r\n        if (lastLat && lastLng) {\r\n            var newLoc = Loc.getCurrentPosition();\r\n            var dst = Misc.geoDistance(newLoc.lat, newLoc.lng, lastLat, lastLng);\r\n            if (dst > 0.025) {\r\n                console.log(\"Location moved 25 m away. Finding new nearby routes.\");\r\n                findNearbyRoutes();\r\n            }\r\n        }\r\n    });\r\n\r\n    var providers = TransitRoutes.getProviders();\r\n\r\n    if (providers.length > 0) {\r\n        var buttonScroll =\r\n            \"<div class=\\\"hori-scroll btn-group\\\">\" +\r\n            \"    <button type=\\\"button\\\" class=\\\"btn btn-primary gtw-providersort gtw-providersort-all\\\"><i class=\\\"fa fa-reply-all\\\"></i><br />\" + $.i18n(\"transit-eta-sort-all\") + \"</button>\";\r\n\r\n        for (var iprovider of providers) {\r\n            var image = \"\";\r\n            if (iprovider.type === TransitType.BUS) {\r\n                image = \"fa-bus\";\r\n            } else if (iprovider.type === TransitType.TRAIN) {\r\n                image = \"fa-train\";\r\n            } else {\r\n                image = \"fa-question\";\r\n            }\r\n            buttonScroll += \" <button type=\\\"button\\\" class=\\\"btn btn-default gtw-providersort gtw-providersort-provider\\\" gtw-provider=\\\"\" + iprovider.id + \"\\\"><i class=\\\"fa \" + image + \"\\\"></i><br />\" + Lang.localizedKey(iprovider, \"name\") + \"</button>\";\r\n        }\r\n\r\n        buttonScroll += \"</div>\";\r\n\r\n        $(\".tab-panel\").append(buttonScroll);\r\n\r\n        var searchField =\r\n            \"<div class=\\\"input-group mb-3\\\" style=\\\"margin-top: 16px;\\\">\" +\r\n            \"    <input type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"\" + $.i18n(\"transit-eta-placeholder-search-for-transit\") + \"\\\" aria-label=\\\"\" + $.i18n(\"transit-eta-placeholder-search-for-transit\") + \"\\\" aria-describedby=\\\"search-transit-icon\\\" id=\\\"search-transit-text\\\" readonly/>\" +\r\n            \"    <div class=\\\"input-group-append\\\">\" +\r\n            //\"        <span class=\\\"input-group-text\\\" id=\\\"search-transit-icon\\\"><i class=\\\"fas fa-search\\\"></i></span>\" +\r\n            \"        <button class=\\\"btn btn-light disabled\\\" type=\\\"button\\\" id=\\\"button-cancel-search\\\"><i class=\\\"fas fa-search\\\"></i></button>\" +\r\n            \"    </div>\" +\r\n            \"</div>\"\r\n            ;\r\n\r\n        $(\".tab-panel\").append(searchField);\r\n\r\n        var requestProgressBar =\r\n            \"<div class=\\\"request-progress-panel\\\">\" +\r\n            \"    <div class=\\\"progress bg-white\\\">\" +\r\n            \"        <div class=\\\"progress-bar progress-bar-striped progress-bar-animated\\\" role=\\\"progressbar\\\" style=\\\"width: 0%;\\\"></div>\" +\r\n            \"    </div>\" +\r\n            \"</div>\"\r\n            ;\r\n\r\n        $(\".tab-panel\").append(requestProgressBar);\r\n\r\n        $(\".gtw-providersort\").on(\"click\", function () {\r\n            if ($(this).hasClass(\"btn-primary\")) {\r\n                return;\r\n            }\r\n            //$(\".gtw-providersort\").removeClass(\"btn-default\");\r\n\r\n            if ($(this).hasClass(\"gtw-providersort-all\")) {\r\n                resetProviderSort();\r\n            } else {\r\n                $(\".gtw-providersort\").removeClass(\"btn-primary\");\r\n\r\n                var provider = $(this).attr(\"gtw-provider\");\r\n                $(this).addClass(\"btn-primary\");\r\n\r\n                $(\".gtw-providersort-provider:not([gtw-provider='\" + provider + \"'])\").addClass(\"btn-default\");\r\n                $(\".route-selection[gtw-provider='\" + provider + \"']\").attr(\"style\", \"\");\r\n                $(\".route-selection:not([gtw-provider='\" + provider + \"'])\").attr(\"style\", \"display: none!important\");\r\n            }\r\n        });\r\n\r\n        $(\"#button-cancel-search\").on(\"click\", function () {\r\n            if (!$(this).hasClass(\"disabled\")) {\r\n                clearSearch();\r\n            }\r\n        });\r\n\r\n        var useKeypad = true;\r\n        if (useKeypad) {\r\n            $(\"#search-transit-text\").on(\"click\", function () {\r\n                showTouchKeypad();\r\n                showSearchRoutes();\r\n            });\r\n        }\r\n\r\n        $(\"#search-transit-text\").on(\"input\", function () {\r\n            clearTimeout(searchTimeout);\r\n            searchTimeout = setTimeout(function () {\r\n                searchRoutes();\r\n            }, 500);\r\n        });\r\n\r\n        findNearbyRoutes();\r\n    } else {\r\n        //TODO: better message or auto add plugins according to region\r\n        $(\".tab-panel\").html(\"<br /><div class=\\\"alert alert-danger\\\" role=\\\"alert\\\"><i class=\\\"fas fa-exclamation-triangle\\\"></i> \" + $.i18n(\"transit-eta-no-plugins-providing-transit-data\") + \"</div>\");\r\n    }\r\n}\r\n\r\nexport function disable() {\r\n    TouchKeypad.removeListener(touchKeypadListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_UI_BACK, eventUiBackListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_LOCATION_CHANGE, eventLocChgListener);\r\n    clearTimeout(searchTimeout);\r\n    clearInterval(updateEtaTimer);\r\n    clearInterval(updateStopEtaTimer);\r\n    searchTimeout = false;\r\n    updateEtaTimer = false;\r\n}"],"sourceRoot":""}