(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"onload",(function(){return d}));var n=r(10),o=r(16),a=r(22),s=r(6),i=r(7),c=r(8);function u(e){var t=e.split(/[: T-]/).map(parseFloat);return new Date(t[0],t[1]-1,t[2],t[3]||0,t[4]||0,t[5]||0,0)}function d(){return n.register("db.kmbeta.ml",!0),n.register("rt.data.gov.hk",!0),c.registerProvider(TransitType.BUS,"CTB",{default:"CTB",en:"CTB",zh:"城巴"},new b),c.registerProvider(TransitType.BUS,"NWFB",{default:"NWFB",en:"NWFB",zh:"新巴"},new l),!0}var h=function(t,r,n,c,d){var h=s.getRouteById(d.routeId),f=i.getStopById(d.stopId),p=t.getRouteById(h.routeName);if(!p)return console.error("Error: Could not get CTBNWFB reference by database route name. Aborting fetch ETA."),void c();if(p.paths.length!==h.paths.length||d.selectedPath>=p.paths.length)return console.error("Error: "+h.routeName+" CTBNWFB reference database mismatch. Aborting fetch ETA."),void c();var b=a.b(h,f,d.selectedPath),l=p.paths[d.selectedPath][b],v=t.getStopById(l);if(!v)return console.error("Error: Could not get "+f.stopId+" CTBNWFB reference stop. Aborting fetch ETA."),void c();var g="https://rt.data.gov.hk/v1/transport/citybus-nwfb/eta/"+r+"/"+v.stopId+"/"+p.routeId;e.ajax({url:g,dataType:"json",cache:!1,success:function(e){n(function(e,t,r){var n,a,s=new Date,i=[];if(!e)return!1;s=u(e["generated_timestamp "]);var c=e.data;for(n=0;n<c.length;n++)if((a=c[n])&&""!==a){var d=u(a.eta),h={};h.type=TransitType.BUS,h.provider=t,h.serverTime=s.getTime();var f,p=o.getLanguage(),b=o.getLocale();(f="zh-cn"===p?a.rmk_sc:"zh-hk"===p||"zh"===b?a.rmk_tc:a.rmk_en)&&(h.msg=f);var l=d.getTime();isNaN(l)||(h.time=l),i.push(h)}return{options:r,schedules:i,serverTime:s.getTime()}}(e,r,d))},error:function(e,t,r){c()}})},f=function(t,r,n){e.ajax({url:"https://db.kmbeta.ml/ctbnwfb_db-version.json",cache:!1,dataType:"json",success:function(e){var r,o;try{r=parseInt(e.version),o=parseInt(n)}catch(e){console.error("Error: Could not parse ctbnwfb_db last updated time or cached version! Forcing to be no update"),t(!1)}t(r>o)},error:function(e){console.error("Error: Could not check ctbnwfb_db update!"),t(!1)}})},p=function(t,r,n){e.ajax({url:"https://db.kmbeta.ml/ctbnwfb_db.json",cache:!1,dataType:"json",success:function(e){t(function(e,t){var r,n=e.routes,o=e.stops,a=[];for(r=0;r<n.length;r++)n[r].provider==t&&a.push(n[r]);return{type:e.type,provider:t,routes:a,stops:o,version:e.version}}(e,n))},error:function(e,t,n){r()}})},b=function(){this.fetchDatabase=function(e,t){p(e,t,"CTB")},this.isDatabaseUpdateNeeded=function(e,t,r){f(e,0,r)},this.fetchEta=function(e,t,r){h(this,"CTB",e,t,r)}},l=function(){this.fetchDatabase=function(e,t){p(e,t,"NWFB")},this.isDatabaseUpdateNeeded=function(e,t,r){f(e,0,r)},this.fetchEta=function(e,t,r){h(this,"NWFB",e,t,r)}}}.call(this,r(0))}}]);
//# sourceMappingURL=0.857a61b4aeb2295c5d14.js.map