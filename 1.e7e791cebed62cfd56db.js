(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{106:function(t,a,e){"use strict";e.r(a),function(t){e.d(a,"enable",(function(){return W})),e.d(a,"disable",(function(){return Q}));e(9);var i,s,r,n,o,l,d,c,p,u,g=e(33),v=e(43),h=e(7),f=e(8),m=e(17),y=e(31),b=e(234),w=e(5),_=e(22),C=e(2),k=e(6),x=!1,T=!1,E=!1;function D(){b.d()}function O(a){t(".gtw-providersort-provider").each((function(){var e=t(this).attr("data-gtw-package"),i=t(this).attr("data-gtw-provider"),s=t(this).attr("data-gtw-agency");t(a+" .route-selection"+("[data-gtw-package='"+e+"'][data-gtw-provider='"+i+"'][data-gtw-agency='"+s+"']")).length>0?t(this).css("display",""):t(this).css("display","none")}))}var I=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],U=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],q=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];function A(t){var a,e,i={};for(a=0;a<I.length;a++)i[I[a]]=0;for(a=0;a<t.length;a++)for(e=0;e<I.length;e++)i[I[e]]|=t[a][I[e]];return i}function N(a,e=!1){if(a.monday&&a.tuesday&&a.wednesday&&a.thursday&&a.friday&&a.saturday&&a.sunday)return!!e&&t.i18n("transit-calendar-from-monday-to-sunday-dates");if(a.monday&&a.tuesday&&a.wednesday&&a.thursday&&a.friday&&a.saturday)return t.i18n("transit-calendar-from-monday-to-saturday"+(e?"-dates":""));if(a.monday&&a.tuesday&&a.wednesday&&a.thursday&&a.friday)return t.i18n("transit-calendar-from-monday-to-friday"+(e?"-dates":""));if(a.monday&&a.tuesday&&a.wednesday&&a.thursday)return t.i18n("transit-calendar-from-monday-to-thursday"+(e?"-dates":""));if(a.saturday&&a.sunday)return t.i18n("transit-calendar-from-saturday-to-sunday"+(e?"-dates":""));if(a.saturday)return t.i18n("transit-calendar-on-saturday"+(e?"-dates":""));if(a.sunday)return t.i18n("transit-calendar-on-sunday"+(e?"-dates":""));var i,s="";for(i=0;i<I.length;i++)s+=a[I[i]]?U[i].substr(0,1):".";return s}var M,S=!1;async function K(){var a=setTimeout((function(){t(".loading-overlay").fadeIn(500)}),500);b.g({}),b.b();var e,i=t("#search-transit-text").val();var s,r='<ul class="list-group">';if(s=Date.now(),0===i.length)console.log("FIRSTLETTERS"),S?e=S:(e=await k.g(i.length,1,!0),S=e),console.log("Used "+(Date.now()-s)+" ms"),s=Date.now();else{console.log("SEARCH");var n,o,l,d,c,p,u,g,v,h,f,y,w,_=await k.r(i);console.log("Used "+(Date.now()-s)+" ms"),s=Date.now();var C,x,T,E,D,I,U,q={};e=[];var M,K={},R={},L={},V={},H=0,F=0,B=0,P=0;for(n=0;n<_.length;n++){if(M=Date.now(),h=(g=_[n]).route_id,c=m.localizedKey(g,"route_short_name"),D=g.package,I=g.provider,U=g.agency_id,i.length<c.length){var G=c.substr(i.length,1);e.includes(G)||e.push(G)}for(v=K[(d=D+","+I+",")+U]?K[d+U]:K[d+U]=await k.f(D,I,U),p=R[d+h]?R[d+h]:R[d+h]=await k.o(D,I,h),E=[],x=[],o=0;o<p.length;o++)T=(u=p[o]).path_id,C=u.service_id,E.includes(T)||E.push(T),x.includes(C)||x.push(C);for(H+=Date.now()-M,F++,o=0;o<E.length;o++){M=Date.now(),T=E[o],r+='<li class="list-group-item list-group-item-action d-flex align-items-center route-selection"  data-gtw-package="'+D+'" data-gtw-provider="'+I+'" data-gtw-agency="'+U+'" data-gtw-route-id="'+g.route_id+'" data-gtw-path-id="'+T+'">    <div class="d-flex flex-column route-id">        <div>'+m.localizedKey(v,"agency_short_name")+"</div>        <div>"+c+'</div>    </div>    <div class="d-flex flex-column stop-info mr-auto">',f=V[d+(y=(w=L[d+T]?L[d+T]:L[d+T]=await k.n(D,I,T))[w.length-1].stop_id)]?V[d+y]:V[d+y]=await k.m(D,I,y),r+="        <div><b>"+t.i18n("transit-eta-to")+":</b> "+k.t(v.agency_id,m.localizedKey(f,"stop_name"))+"</div>";var J=[];for(l=0;l<x.length;l++)q[C=x[l]]||(q[C]=await k.h(D,I,C)),J.push(q[C]);r+="<div>";var W=!1;w[0].stop_id===f.stop_id&&(W=!0,r+='<span class="badge badge-secondary">'+t.i18n("transit-circular-path")+"</span>");var Q=N(A(J));Q&&(W&&(r+=" ",W=!1),r+='<span class="badge badge-secondary">'+Q+"</span>"),r+="        </div>    </div></li>",B+=Date.now()-M,P++}}}console.log("Used "+(Date.now()-s)+" ms"),console.log("BeforeLoopAvg: "+H/F+" ms ("+F+" times)"),console.log("AfterLoopAvg: "+B/P+" ms ("+P+" times)"),s=Date.now(),r+="</ul>",t(".all-route-list").html(r),console.log(e);var X={};for(var Y of e)X[Y]=!0;console.log(X),b.g(X),b.c(),t(".all-route-list .route-selection").on("mouseenter",z),t(".all-route-list .route-selection").on("click",j),O(".all-route-list"),clearTimeout(a),t(".loading-overlay").fadeOut(500),adjustMargin(),console.log("Used "+(Date.now()-s)+" ms")}function R(){t(".gtw-providersort").removeClass("btn-primary"),t(".gtw-providersort-all").addClass("btn-primary"),t(".route-selection").attr("style","")}function L(){t(".all-route-list").html(""),D(),t("#search-transit-text").val(""),E=!1,t("#button-cancel-search").addClass("btn-light"),t("#button-cancel-search").addClass("disabled"),t("#button-cancel-search").removeClass("btn-danger"),t("#button-cancel-search").html('<i class="fas fa-search"></i>'),t(".nearby-route-list").css("display","flex"),t(".all-route-list").css("display","none"),C.g(y.a()),C.i(16),C.e(),C.f(),R(),O(".nearby-route-list"),b.f()}async function j(){var a=t(this).attr("data-gtw-package"),e=t(this).attr("data-gtw-provider"),i=t(this).attr("data-gtw-agency"),s=t(this).attr("data-gtw-route-id"),r=t(this).attr("data-gtw-path-id"),n=t(this).attr("data-gtw-stop-id"),o=await k.n(a,e,r);if(!n&&y.d()){var l,d,c=y.a(),p=!1,u=!1;for(var g of o)l=await k.m(a,e,g.stop_id),d=f.c(l.stop_lat,l.stop_lon,c.lat,c.lng),(!p||!u||d<p)&&(p=d,u=l);console.log(p),p<=2&&(n=u.stop_id)}var v=setTimeout((function(){t(".loading-overlay").fadeIn(500)}),500);C.e(),C.f(),await async function(a,e,i,s,r,n,o=!1,l=!1){var d,c,p,u=await k.n(a,e,r),g=await k.k(a,e,s),v=await k.f(a,e,i),h=u[u.length-1],f=await k.m(a,e,h.stop_id),y=await k.o(a,e,s),b={};for(z=0;z<y.length;z++)if(r===y[z].path_id)for(var w of(c=y[z].trip_id,D=y[z].service_id,b[D]||(b[D]={calendar:await k.h(a,e,D),freqs:[]}),d=b[D],await k.j(a,e,c))){for(var _ of(p=!1,d.freqs))if(_.start_time===w.start_time&&_.end_time===w.end_time&&_.headway_secs===w.headway_secs){p=!0;break}p||d.freqs.push(w)}var x='<ul class="list-group"><li class="list-group-item d-flex align-items-center route-selection">    <div class="d-flex flex-column route-id">        <div>'+m.localizedKey(v,"agency_short_name")+"</div>        <div>"+m.localizedKey(g,"route_short_name")+'</div>    </div>    <div class="d-flex flex-column stop-info mr-auto">        <div><b>'+t.i18n("transit-eta-to")+":</b> "+k.t(i,m.localizedKey(f,"stop_name"))+"</div><div>",T=!1;u[0].stop_id===f.stop_id&&(T=!0,x+='<span class="badge badge-secondary">'+t.i18n("transit-circular-path")+"</span>");var E=[];for(var D in b)E.push(b[D].calendar);var O,I=N(A(E));I&&(T&&(x+=" ",T=!1),x+='<span class="badge badge-secondary">'+I+"</span>");for(x+='</div></div></li></ul><ul class="nav nav-pills nav-fill m-2" role="tablist" id="pills-route-list-tab">    <li class="nav-item">        <a class="nav-link active" id="pills-route-tab" data-toggle="pill" href="#pills-route" role="tab" aria-controls="pills-route" aria-selected="true">'+t.i18n("transit-route-tab-route-list")+'</a>    </li>    <li class="nav-item">        <a class="nav-link" id="pills-timetable-tab" data-toggle="pill" href="#pills-timetable" role="tab" aria-controls="pills-timetable" aria-selected="false">'+t.i18n("transit-route-tab-timetable")+'</a>    </li>    <li class="nav-item">        <a class="nav-link disabled" id="pills-other-routes-tab" data-toggle="pill" href="#pills-other-routes" role="tab" aria-controls="pills-other-routes" aria-selected="false">'+t.i18n("transit-route-tab-other-routes")+"</a>    </li></ul>",t(".split-map-tab-panel").html(x),x='<div class="tab-content" id="pills-route-list-tabContent">    <div class="tab-pane fade show active" id="pills-route" role="tabpanel" aria-labelledby="pills-route-tab">        <div class="row" style="padding: 2%;">            <div class="timeline-centered">',z=0;z<u.length;z++)O=await k.m(a,e,u[z].stop_id),x+='<article class="timeline-entry" data-gtw-package="'+a+'" data-gtw-provider="'+e+'" data-gtw-agency="'+i+'" data-gtw-route-id="'+s+'" data-gtw-path-id="'+r+'" data-gtw-stop-id="'+O.stop_id+'">    <div class="timeline-entry-inner">        <div class="timeline-icon bg-light">            '+(z+1)+'        </div>        <div class="timeline-label">            <h2><button style="padding: 0px;" class="btn btn-link" data-gtw-package="'+a+'" data-gtw-provider="'+e+'" data-gtw-agency="'+i+'" data-gtw-route-id="'+s+'" data-gtw-path-id="'+r+'" data-gtw-stop-id="'+O.stop_id+'" data-gtw-stop-sequence="'+u[z].stop_sequence+'" data-gtw-stop-index="'+z+'">'+k.t(i,m.localizedKey(O,"stop_name"))+'</button></h2>            <p class="stop-eta-info"></p>        </div>    </div></article>';x+='            </div>        </div>    </div>    <div class="tab-pane fade" id="pills-timetable" role="tabpanel" aria-labelledby="pills-timetable-tab">';var U,M='<ul class="nav nav-pills nav-fill mb-3" id="calendar-tab" role="tablist">',S='<div class="tab-content" id="calendar-tabContent">',K=new Date,R={},L=!1;for(var D in b){var j=1===b[D].calendar[q[K.getDay()]];R[D]=j,L|=j}var z=0;for(var D in b){var H,F;if(d=b[D],U=N(d.calendar,!0),L?(F=R[D],H=F):(F=!1,H=0===z),M+='<li class="nav-item">    <a class="nav-link'+(H?" active":"")+'" id="calendar-'+D+'-tab" data-toggle="pill" href="#calendar-'+D+'" role="tab" aria-controls="calendar-'+D+'" aria-selected="'+(H?"true":"false")+'">'+(F?'<i class="fas fa-hourglass-half"></i> ':"")+U+"</a></li>",S+='<div class="tab-pane fade'+(H?" show active":"")+'" id="calendar-'+D+'" role="tabpanel" aria-labelledby="calendar-'+D+'-tab">    <table class="table">        <thead class="thead-light">            <tr>                <th scope="col" colspan="'+(F&&L?"4":"3")+'">'+t.i18n("transit-calendar-header-timeslot")+'</th>                <th scope="col">'+t.i18n("transit-calendar-header-headway-min")+"</th>            </tr>        </thead>        <tbody>",z++,d.freqs.length>0)for(var w of d.freqs){var B=Math.round(w.headway_secs/60);S+="            <tr>",F&&L&&(k.p(w)?S+='                <td><i class="fas fa-hourglass-half"></i></td>':S+="                <td></td>"),S+="                <td>"+w.start_time+"</td>                <td>-</td>                <td>"+w.end_time+"</td>                <td>"+B+"</td>            </tr>"}else S+='                <td colspan="4">'+t.i18n("transit-eta-no-timetable")+"</td>            </tr>";S+="        </tbody>    </table></div>"}x+=(M+="</ul>")+S+'    </div>    <div class="tab-pane fade" id="pills-other-routes" role="tabpanel" aria-labelledby="pills-other-routes-tab">',x+="</div></div>",t(".split-map-container").html(x),t(".split-map-container button").on("click",(function(){var a=t(this).attr("data-gtw-package"),e=t(this).attr("data-gtw-provider"),i=t(this).attr("data-gtw-agency"),s=t(this).attr("data-gtw-route-id"),r=t(this).attr("data-gtw-path-id"),n=t(this).attr("data-gtw-stop-id");V(a,e,i,s,r,u,n)})),t(".nav-pills[role='tablist'] .nav-item a").on("click",(function(){var a=t(this).parent().parent().attr("id"),e=a.lastIndexOf("-tab"),i=a.substr(0,e)+"-tabContent",s=t(this).attr("aria-controls");t(".tab-content[id='"+i+"']").children(".tab-pane").each((function(){var a=t(this).attr("id");a!==s?(t(this).removeClass("show"),t(this).removeClass("active")):(t(this).addClass("show"),t(this).addClass("active"),a.startsWith("calendar-")||t(this)[0].scrollIntoView())}))})),l&&await async function(t){var a,e,i,s=[];for(i=0;i<t.length;i++)a={lat:(e=await k.m(t[i].package,t[i].provider,t[i].stop_id)).stop_lat,lng:e.stop_lon},s.push(a),C.a(a,{title:e.stop_name,label:""+(i+1)});C.b(s,"#FF0000",2)}(u);adjustMargin()}(a,e,i,s,r,0,!0,!0),_.b(),D(),await V(a,e,i,s,r,o,n),clearTimeout(v),t(".loading-overlay").fadeOut(500)}function z(){console.warn("TODO: Preview route")}async function V(a,e,i,r,n,o,l){var d=screen.width>=768?".desktop":".mobile",c=t(d+" .timeline-entry[data-gtw-stop-id='"+l+"']"),p=t(d+" .timeline-entry:not([data-gtw-stop-id='"+l+"'])"),u=c.children(".timeline-entry-inner").children(".timeline-icon"),v=c.children(".timeline-entry-inner").children(".timeline-icon");if(u.removeClass("bg-light"),u.addClass("bg-primary"),v.addClass("bg-light"),v.removeClass("bg-primary"),p.children(".timeline-entry-inner").children(".timeline-label").children("p").html(""),scroll){var h=c[0];void 0===h&&(h=t(d+" .timeline-entry")[0]),h.scrollIntoView()}if(l){var y=await k.f(a,e,i),b=await k.k(a,e,r),w=await k.i(a,e,b.route_id),x=await k.m(a,e,l),T={lat:x.stop_lat,lng:x.stop_lon};C.g(T),C.i(18),async function(a,e,i,r,n){if(F)return;F=!0;var o=t(".timeline-entry[data-gtw-stop-id='"+n.stop_id+"'] .stop-eta-info"),l="<u>"+t.i18n("transit-eta")+'</u> <div class="spinner-border spinner-border-sm eta-loading-spinner" role="status"></div><table class="table stop-eta">    <tr class="table-dark">        <td colspan="4"><div class="spinner-border spinner-border-sm" role="status"></div> '+t.i18n("transit-eta-retrieving-data")+"</td>    </tr></table>";o.html(l),M=!1,async function(a,e,i,s,r){var n=t(".timeline-entry[data-gtw-stop-id='"+s+"'] p table tbody"),o=await k.l(a,e,i,r),l=-1;for(p=0;p<o.length;p++)if(k.p(o[p])){l=p;break}var d="";if(-1!==l)for(var c=l+3>=o.length?o.length:l+3,p=l;p<c;p++){var u=Math.round(o[p].headway_secs/60),g=k.u(o[p].start_time);d+='<tr class="table-secondary'+(p==l?" active":"")+'">    <td>'+t.i18n("transit-eta-every-minutes",u)+'</td>    <td colspan="2">'+f.b(g.getHours())+":"+f.b(g.getMinutes())+"</td></tr>"}else 0===o.length?d+='<tr class="table-dark">    <td colspan="4">'+t.i18n("transit-eta-no-timetable")+"</td></tr>":d+='<tr class="table-dark">    <td colspan="4">'+t.i18n("transit-eta-not-in-service")+"</td></tr>";M||n.html(d)}(e.package,e.provider,e.route_id,n.stop_id,r[0].path_id),clearInterval(s);var d=function(){!async function(a,e,i,s,r){if(H)return;H=!0,t(".eta-loading-spinner").css("display","");try{var n=await g.fetchEta({etaProviders:a.agency_id.split("+"),agency:a,route:e,trip:i,stopTimes:s,stop:r});t(".stop-eta-msg").remove(),t(".eta-loading-spinner").css("display","none"),console.log(n);var o=n.options,l="";t(".timeline-entry[data-gtw-stop-id='"+o.stop.stop_id+"'] .stop-eta-info table tbody");if(-2===n.code){var d='<p class="stop-eta-msg">*'+t.i18n("transit-eta-no-eta-providers")+"</p>";t(".timeline-entry[data-gtw-stop-id='"+o.stop.stop_id+"'] .stop-eta-info").append(d)}else if(-1===n.code||n.feeds&&0===n.feeds.length){d='<p class="stop-eta-msg">*'+t.i18n("transit-eta-no-data-received")+"</p>";t(".timeline-entry[data-gtw-stop-id='"+o.stop.stop_id+"'] .stop-eta-info").append(d)}else{var c=[],p=[];for(var u of n.feeds)for(var v of u.entity){var h=v.tripUpdate;if(h){var y=h.timestamp?h.timestamp:u.header.timestamp;p.push({timestamp:y,entity:v})}v.alert&&c.push(v.alert)}if(c.length>0){var b="";b=1===c.length?'<div class="stop-eta-msg alert alert-warning"><i class="fas fa-exclamation-triangle"></i> <b>'+m.translatedString(c[0].headerText)+"</b></div>":'<div class="stop-eta-msg alert alert-warning"><i class="fas fa-exclamation-triangle"></i> <b>'+t.i18n("transit-eta-alerts-affecting-stop",c.length)+'</b> <button class="btn btn-link view-alert-btn">'+t.i18n("transit-eta-view-alerts-affecting-stop")+"</button></div>",t(".timeline-entry[data-gtw-stop-id='"+o.stop.stop_id+"'] .stop-eta-info").prepend(b),t(".view-alert-btn").on("click",(function(){_.d("viewgtfsalerts",c)}))}if(0===p.length){d='<p class="stop-eta-msg">*'+t.i18n("transit-eta-no-schedules-pending")+"</p>";t(".timeline-entry[data-gtw-stop-id='"+o.stop.stop_id+"'] .stop-eta-info").append(d)}else{l="";var w=!1;for(var C of p){var k=C.entity.tripUpdate.stopTimeUpdate;if(k&&k.length>0)for(var x of k)if(!x.scheduleRelationship||"SCHEDULED"===x.scheduleRelationship){var T;x.departure?T=x.departure.time:x.arrival&&(T=x.arrival.time);var E=Math.floor((T-C.timestamp)/1e3/60);d='<tr class="table-';d+=E>=20?"secondary":E>=15?"info":E>=10?"success":E>=5?"warning":E>=1?"danger":"dark",!w&&E>0&&(w=!0,d+=" active"),d+='">';C.entity.vehicle&&C.entity.vehicle.vehicle&&C.entity.vehicle.vehicle.label&&(d+="<td>"+C.entity.vehicle.vehicle.label+"</td>"),d+="<td>",d+=E>0?t.i18n("transit-eta-minutes",E):t.i18n("transit-eta-arrived-left"),d+="</td><td",d+=' colspan="2"',d+=">";var D=new Date(T);d+=f.b(D.getHours())+":"+f.b(D.getMinutes()),d+="</td>",l+=d+="</tr>"}}t(".timeline-entry[data-gtw-stop-id='"+o.stop.stop_id+"'] .stop-eta-info table tbody").html(l),M=!0}}}catch(a){t(".eta-loading-spinner").css("display","none");d='<p class="text-danger stop-eta-msg">*'+t.i18n("transit-eta-error-fetching-eta")+"</p>";t(".timeline-entry[data-gtw-stop-id='"+r.stop_id+"'] .stop-eta-info").append(d)}H=!1}(a,e,i,r,n)};d(),s=setInterval(d,3e4),F=!1}(y,b,w,o,x)}}var H=!1;var F=!1;function B(){var a=v.b.length;if(a>0){t(".request-progress-panel").fadeIn(500);var e=o;(!e||a>e)&&(e=o=a),t(".request-progress-panel .progress-bar").html(t.i18n("transit-eta-requesting-data",e-a,e)),t(".request-progress-panel .progress-bar").css("width",Math.floor((e-a)/e*100)+"%")}else o=0,t(".request-progress-panel .progress-bar").css("width","100%"),t(".request-progress-panel").fadeOut(500,(function(){t(".request-progress-panel .progress-bar").css("width","0%")}));for(var i of n){k.get;g.fetchEta({etaProviders:i.route.agency_id.split("+"),agency:i.agency,route:i.route,trip:i.trip,stop:i.stop,stopTimes:i.path}).then((function(a){var e="",i=a.options,s=t('.nearby-route-list .route-selection[data-gtw-package="'+i.agency.package+'"][data-gtw-provider="'+i.agency.provider+'"][data-gtw-agency="'+i.agency.agency_id+'"][data-gtw-route-id="'+i.route.route_id+'"][data-gtw-path-id="'+i.trip.path_id+'"][data-gtw-stop-id="'+i.stop.stop_id+'"]');s.removeClass("list-group-item-secondary"),s.removeClass("list-group-item-info"),s.removeClass("list-group-item-success"),s.removeClass("list-group-item-warning"),s.removeClass("list-group-item-danger"),s.removeClass("list-group-item-light"),s.removeClass("list-group-item-dark");var r="btn-secondary";if(a.code<0)e=t.i18n("transit-eta-route-not-available-short"),s.addClass("list-group-item-light");else if(0===a.feeds.length)e=t.i18n("transit-eta-no-feed-received"),s.addClass("list-group-item-light");else{var n=[];for(var o of a.feeds)for(var l of o.entity){var d=l.tripUpdate;if(d){var c=d.timestamp?d.timestamp:o.header.timestamp;n.push({timestamp:c,tripUpdate:d})}}if(0===n.length)e=t.i18n("transit-eta-no-schedules-pending-short"),s.addClass("list-group-item-light");else{var p=n[0],u=p.tripUpdate.stopTimeUpdate;if(u&&u.length>0){var g=u[0];if(g.scheduleRelationship&&"SCHEDULED"!==g.scheduleRelationship)console.log("NODATA");else{var v;g.departure?v=g.departure.time:g.arrival&&(v=g.arrival.time);var h=Math.floor((v-p.timestamp)/1e3/60),f="";f=h>=20?"secondary":h>=15?"info":h>=10?"success":h>=5?"warning":h>=1?"danger":"dark",s.addClass("list-group-item-"+f),r="badge-primary",h>0?e+=t.i18n("transit-eta-minutes",h):(e+=t.i18n("transit-eta-arrived-left",h),r="badge-dark")}}else console.log("Cancelled")}}var m=s.children(".transit-eta");m.removeClass("badge-primary"),m.removeClass("badge-secondary"),m.removeClass("badge-warning"),m.removeClass("badge-danger"),m.removeClass("badge-dark"),m.addClass(r),m.html(e)})).catch((function(a,e){var i=t('.nearby-route-list .route-selection[data-gtw-package="'+a.agency.package+'"][data-gtw-provider="'+a.agency.provider+'"][data-gtw-agency="'+a.agency.agency_id+'"][data-gtw-route-id="'+a.route.route_id+'"][data-gtw-path-id="'+a.trip.path_id+'"][data-gtw-stop-id="'+a.stop.stop_id+'"]');i.removeClass("list-group-item-secondary"),i.removeClass("list-group-item-info"),i.removeClass("list-group-item-success"),i.removeClass("list-group-item-warning"),i.removeClass("list-group-item-danger"),i.removeClass("list-group-item-light"),i.removeClass("list-group-item-dark"),i.addClass("list-group-item-light");var s=i.children(".transit-eta");s.removeClass("badge-primary"),s.removeClass("badge-secondary"),s.removeClass("badge-warning"),s.removeClass("badge-danger"),s.removeClass("badge-dark"),s.addClass("badge-danger"),s.html(t.i18n("transit-eta-error-fetching-eta-short"))}))}}async function P(){clearInterval(r);var a=y.a(),e=a.lat,i=a.lng;x=e,T=i;var s=h.get("min_nearby_transit_range",200)/1e3,o=Date.now(),l=await k.q(e,i,s,!0);if(0===l.length){var d=s;do{d+=.05,l=await k.q(e,i,d,!0,!0)}while(0===l.length&&d<10);d>=10?t(".tab-panel").append('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" >&#215;</button>'+t.i18n("transit-eta-no-routes-found-10-km")+"</div>"):t(".tab-panel").append('<div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" >&#215;</button>'+t.i18n("transit-eta-no-routes-found-nearby-extended-range",1e3*s,Math.ceil(1e3*d))+"</div>")}console.log("Used: "+(Date.now()-o)),o=Date.now();var c,p=h.get("max_nearby_transit_to_display",20);for(var u of(n=[],console.log(l),l)){if(n.length>=p)break;var g,v=(g=u.stop).package,f=g.provider,b=await k.s(v,f,g.stop_id);for(var w in b.trips){var _=b.trips[w],C=await k.f(v,f,b.routes[w].agency_id),E=await k.n(v,f,_.path_id);n.push({agency:C,route:b.routes[w],trip:_,stop:g,stopTime:b.stopTimes[_.path_id],path:E,distance:u.distance})}}console.log("Used: "+(Date.now()-o)),o=Date.now(),n.sort((t,a)=>t.distance-a.distance),console.log("Used: "+(Date.now()-o)),o=Date.now(),console.log(n);var D='<ul class="list-group">';for(var I of n)c=Math.round(1e3*I.distance),C=await k.f(I.route.package,I.route.provider,I.route.agency_id),g=await k.m(I.stopTime.package,I.stopTime.provider,I.stopTime.stop_id),D+='    <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center route-selection" data-gtw-package="'+I.route.package+'" data-gtw-provider="'+I.route.provider+'" data-gtw-agency="'+I.route.agency_id+'" data-gtw-route-id="'+I.route.route_id+'" data-gtw-path-id="'+I.trip.path_id+'" data-gtw-stop-id="'+I.stopTime.stop_id+'" data-gtw-stop-seq="'+I.stopTime.stop_sequence+'">        <div class="d-flex flex-column route-id">            <div>'+m.localizedKey(C,"agency_short_name")+"</div>            <div>"+m.localizedKey(I.route,"route_short_name")+'</div>        </div>        <div class="d-flex flex-column stop-info mr-auto">            <div>                '+k.t(C.agency_id,m.localizedKey(g,"stop_name"))+" ("+c+t.i18n("transit-eta-metres")+')            </div>        </div>        <span class="badge badge-primary badge-pill transit-eta">'+t.i18n("transit-eta-retrieving")+"</span>    </li>";D+="</ul>",t(".nearby-route-list").html(D),console.log("Used: "+(Date.now()-o)),t(".nearby-route-list .route-selection").on("mouseenter",z),t(".nearby-route-list .route-selection").on("mouseleave",(function(){})),t(".nearby-route-list .route-selection").on("click",j),O(".nearby-route-list"),B(),r=setInterval(B,3e4)}function G(){var a='<div class="d-flex justify-content-center w-100">    <div class="text-center">        <div class="spinner-grow m-5" style="width: 3rem; height: 3rem;"></div>        <div>'+t.i18n("transit-searching-nearby-routes")+"</div>    </div></div>";t(".nearby-route-list").html(a),P()}function J(a){console.log(a);var e='<div class="d-flex justify-content-center w-100">    <div class="text-center text-dark">        <i class="fas fa-exclamation-triangle m-5" style="width: 3rem; height: 3rem;"></i>        <div class="ml-3 mr-3">'+(1===a.code?t.i18n("location-error-user-denied-location"):2===a.code||3===a.code?t.i18n("location-error-could-not-get-location"):t.i18n("location-error-unknown",a.message))+"</div>    </div></div>";t(".nearby-route-list").html(e)}async function W(){v.a(),g.clearCache(),b.a(l=function(a){var e;if(t(a).hasClass("touch-keypad-function-done"))D(),adjustMargin();else if(t(a).hasClass("touch-keypad-function-backspace"))e=t("#search-transit-text").val(),t("#search-transit-text").val(e.slice(0,-1)),K();else if(t(a).hasClass("touch-keypad-value")){var i=t(a).html();e=t("#search-transit-text").val(),t("#search-transit-text").val(e+i),K()}}),w.b(w.a.EVENT_UI_BACK,d=function(){E&&b.h(),clearInterval(s)}),w.b(w.a.EVENT_LOCATION_ERROR,u=function(t){J(t)}),w.b(w.a.EVENT_LOCATION_SUCCESS,p=function(){G()}),w.b(w.a.EVENT_LOCATION_CHANGE,c=function(){if(x&&T){var t=y.a();f.c(t.lat,t.lng,x,T)>.125&&(console.log("Location moved 125 m away. Finding new nearby routes."),P())}});var a=await k.e();if(a.length>0){var e='<div class="hori-scroll btn-group">    <button type="button" class="btn btn-primary gtw-providersort gtw-providersort-all"><i class="fa fa-reply-all"></i><br />'+t.i18n("transit-eta-sort-all")+"</button>";for(var r of a){e+=' <button type="button" class="btn btn-default gtw-providersort gtw-providersort-provider" data-gtw-package="'+r.package+'" data-gtw-provider="'+r.provider+'" data-gtw-agency="'+r.agency_id+'"><i class="fa fa-bus"></i><br />'+m.localizedKey(r,"agency_short_name")+"</button>"}e+="</div>",t(".tab-panel").append(e);var n='<div class="input-group mb-3" style="margin-top: 16px;">    <input type="text" class="form-control" placeholder="'+t.i18n("transit-eta-placeholder-search-for-transit")+'" aria-label="'+t.i18n("transit-eta-placeholder-search-for-transit")+'" aria-describedby="search-transit-icon" id="search-transit-text" readonly/>    <div class="input-group-append">        <button class="btn btn-light disabled" type="button" id="button-cancel-search"><i class="fas fa-search"></i></button>    </div></div>';t(".tab-panel").append(n);t(".tab-panel").append('<div class="request-progress-panel">    <div class="progress bg-white">        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;"></div>    </div></div>'),t(".gtw-providersort").on("click",(function(){if(!t(this).hasClass("btn-primary"))if(t(this).hasClass("gtw-providersort-all"))R();else{t(".gtw-providersort").removeClass("btn-primary");var a=t(this).attr("data-gtw-package"),e=t(this).attr("data-gtw-provider"),i=t(this).attr("data-gtw-agency");t(this).addClass("btn-primary");var s="[data-gtw-package='"+a+"'][data-gtw-provider='"+e+"'][data-gtw-agency='"+i+"']";t(".gtw-providersort-provider:not("+s+")").addClass("btn-default"),t(".route-selection"+s).attr("style",""),t(".route-selection:not("+s+")").attr("style","display: none!important")}})),t("#button-cancel-search").on("click",(function(){t(this).hasClass("disabled")||L()}));t("#search-transit-text").on("click",(function(){b.h(),E=!0,t("#button-cancel-search").removeClass("btn-light"),t("#button-cancel-search").removeClass("disabled"),t("#button-cancel-search").addClass("btn-danger"),t("#button-cancel-search").html('<i class="fas fa-times"></i>'),t(".nearby-route-list").css("display","none"),t(".all-route-list").css("display","flex"),C.g(y.a()),C.i(16),C.e(),C.f(),K(),R(),O(".all-route-list")})),t("#search-transit-text").on("input",(function(){clearTimeout(i),i=setTimeout((function(){K()}),500)}));if(t(".content-panel-container").html('<div class="row item-list nearby-route-list"></div><div class="row item-list all-route-list"></div>'),y.c())J(y.b());else if(y.d())G();else{var o='<div class="d-flex justify-content-center w-100">    <div class="text-center">        <div class="spinner-grow m-5" style="width: 3rem; height: 3rem;"></div>        <div>'+t.i18n("transit-locating-your-location")+"</div>    </div></div>";t(".nearby-route-list").html(o)}}else t(".tab-panel").html('<br /><div class="alert alert-danger" role="alert"><i class="fas fa-exclamation-triangle"></i> '+t.i18n("transit-eta-no-plugins-providing-transit-data")+"</div>")}function Q(){b.e(l),w.d(w.a.EVENT_UI_BACK,d),w.d(w.a.EVENT_LOCATION_ERROR,u),w.d(w.a.EVENT_LOCATION_SUCCESS,p),w.d(w.a.EVENT_LOCATION_CHANGE,c),clearTimeout(i),clearInterval(r),clearInterval(s),i=!1,r=!1}}.call(this,e(0))},234:function(t,a,e){"use strict";(function(t){e.d(a,"f",(function(){return r})),e.d(a,"h",(function(){return n})),e.d(a,"d",(function(){return o})),e.d(a,"a",(function(){return l})),e.d(a,"e",(function(){return d})),e.d(a,"c",(function(){return c})),e.d(a,"b",(function(){return p})),e.d(a,"g",(function(){return u}));var i=[];function s(){if(t(this).blur(),!t(this).hasClass("disabled"))for(var a of i)a(this)}function r(){t(".numeric-keypad .touch-keypad-value").each((function(){t(this).removeClass("disabled"),t(this).removeClass("btn-secondary"),t(this).addClass("btn-outline-secondary")}))}function n(){t(".touch-keypad").css("display","flex"),adjustMargin()}function o(){t(".touch-keypad").css("display",""),adjustMargin()}function l(t){return"function"==typeof t&&(i.push(t),!0)}function d(t){if("function"!=typeof t)return!1;var a=i.indexOf(t);return-1!==a&&(i.splice(a,1),!0)}function c(){t(".touch-keypad-function").removeClass("disabled")}function p(){t(".touch-keypad-function").addClass("disabled")}function u(a){t(".numeric-keypad .touch-keypad-value").each((function(){var e=t(this).html();a[e]?(t(this).removeClass("disabled"),t(this).removeClass("btn-secondary"),t(this).addClass("btn-outline-secondary")):(t(this).addClass("disabled"),t(this).addClass("btn-secondary"),t(this).removeClass("btn-outline-secondary")),delete a[e]}));var e=Object.keys(a);e.sort((function(t,a){return t.charCodeAt(0)-a.charCodeAt(0)}));var i="";for(var r of e)i+='<button type="button" class="btn btn-outline-secondary py-3 touch-keypad-key touch-keypad-value">'+r+"</button>";t(".letter-keypad").html(i),t(".letter-keypad .touch-keypad-value").on("click",s)}t(".touch-keypad-function-done").on("click",s),t(".touch-keypad-function-backspace").on("click",s),t(".touch-keypad-value").on("click",s)}).call(this,e(0))}}]);
//# sourceMappingURL=1.e7e791cebed62cfd56db.js.map