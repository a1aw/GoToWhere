{"version":3,"sources":["webpack:///./src/gtw-ui-tab-navigation.js","webpack:///./src/gtw-ui-select-location.js"],"names":["fromPos","fromName","toPos","toName","async","selectFromLocation","pos","posToName","$","val","fadeIn","searchNavigation","fadeOut","selectToLocation","console","log","st","Date","now","navigationResults","distance","agency","html","result","Math","round","startDistance","endDistance","route","pathId","startStop","endStop","i18n","enable","fromPrepend","fromPlaceholder","toPrepend","toPlaceholder","tabPanelHtml","currentLoc","then","on","disable","nearbyStops","lat","lng","length","localizedName","stop","selectedLocation","marker","eventCenterChgListener","select","text","selectedListener","backListener","EVENT_MAP_CENTER_CHANGED","center","loc","css","EVENT_LOCATION_SELECTED","show","Promise","resolve","reject","EVENT_UI_BACK","removeAttr"],"mappings":"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","file":"1.7a95f881853e65e8992f.js","sourcesContent":["import * as selectLoc from './gtw-ui-select-location';\r\nimport * as Loc from './gtw-location';\r\nimport * as gtfs from './gtw-citydata-transit-gtfs';\r\nimport * as Lang from './gtw-lang';\r\nimport * as Map from './gtw-map';\r\n\r\nvar fromPos = false;\r\nvar fromName = false;\r\nvar toPos = false;\r\nvar toName = false;\r\n\r\nasync function selectFromLocation() {\r\n    if (fromPos) {\r\n        Map.setZoom(18);\r\n        Map.setCenter(fromPos);\r\n    }\r\n    var pos = await selectLoc.select();\r\n    if (pos) {\r\n        fromPos = pos;\r\n        fromName = await posToName(pos);\r\n        $(\".from-location-field\").val(fromName);\r\n        if (fromPos && toPos) {\r\n            $(\".loading-overlay\").fadeIn(1000);\r\n            await searchNavigation();\r\n            $(\".loading-overlay\").fadeOut(1000);\r\n        }\r\n    }\r\n\r\n    Map.setCenter(Loc.getCurrentPosition());\r\n    Map.setZoom(16);\r\n}\r\n\r\nasync function selectToLocation() {\r\n    if (toPos) {\r\n        Map.setZoom(18);\r\n        Map.setCenter(toPos);\r\n    }\r\n    var pos = await selectLoc.select();\r\n    if (pos) {\r\n        toPos = pos;\r\n        toName = await posToName(pos);\r\n        $(\".to-location-field\").val(toName);\r\n        if (fromPos && toPos) {\r\n            $(\".loading-overlay\").fadeIn(1000);\r\n            await searchNavigation();\r\n            $(\".loading-overlay\").fadeOut(1000);\r\n        }\r\n    }\r\n\r\n    Map.setCenter(Loc.getCurrentPosition());\r\n    Map.setZoom(16);\r\n}\r\n\r\nasync function searchNavigation() {\r\n    console.log(\"peform search\");\r\n    var st = Date.now();\r\n    var navigationResults = await gtfs.navigate(fromPos, toPos, 0.5);\r\n    console.log(navigationResults);\r\n    console.log(\"Used: \" + (Date.now() - st));\r\n    var html = \"<ul class=\\\"list-group\\\">\";\r\n\r\n    var distance;\r\n    var agency;\r\n\r\n    for (var result of navigationResults) {\r\n        distance = Math.round((result.startDistance + result.endDistance) * 1000);\r\n        agency = await gtfs.getAgency(result.route[\"package\"], result.route[\"provider\"], result.route[\"agency_id\"]);\r\n\r\n        html +=\r\n            \"    <li class=\\\"list-group-item list-group-item-action d-flex justify-content-between align-items-center route-selection\\\" data-gtw-package=\\\"\" + result.route[\"package\"] + \"\\\" data-gtw-provider=\\\"\" + result.route[\"provider\"] + \"\\\" data-gtw-agency=\\\"\" + result.route[\"agency_id\"] + \"\\\" data-gtw-route-id=\\\"\" + result.route[\"route_id\"] + \"\\\" data-gtw-path-id=\\\"\" + result.pathId + \"\\\" data-gtw-start-stop-id=\\\"\" + result.startStop[\"stop_id\"] + \"\\\" data-gtw-end-stop-id=\\\"\" + result.endStop[\"stop_id\"] + \"\\\">\" +\r\n            \"        <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n            \"            <div>\" + Lang.localizedKey(agency, \"agency_short_name\") + \"</div>\" +\r\n            \"            <div>\" + Lang.localizedKey(result.route, \"route_short_name\") + \"</div>\" +\r\n            \"        </div>\" +\r\n            \"        <div class=\\\"d-flex flex-column stop-info mr-auto\\\">\" +\r\n            \"            <div>\" +\r\n            \"                \" + gtfs.selectAgencyStopName(agency[\"agency_id\"], Lang.localizedKey(result.startStop, \"stop_name\")) + \" <i class=\\\"fas fa-arrow-right\\\"></i> \" + gtfs.selectAgencyStopName(agency[\"agency_id\"], Lang.localizedKey(result.endStop, \"stop_name\")) +\r\n            \"            </div>\" +\r\n            \"            <div>\" + $.i18n(\"navigate-walk-distance\", distance) +\r\n            \"            </div>\" +\r\n            \"        </div>\" +\r\n            \"        <span class=\\\"badge badge-primary badge-pill transit-eta\\\">\" + $.i18n(\"transit-eta-route-not-available-short\") + \"</span>\" +\r\n            \"    </li>\";\r\n    }\r\n\r\n    html += \"</ul>\";\r\n    $(\".navigation-results\").html(html);\r\n}\r\n\r\nexport function enable() {\r\n    var fromPrepend = $.i18n(\"location-from-location-short\");\r\n    var fromPlaceholder = $.i18n(\"location-from-location-long\");\r\n    var toPrepend = $.i18n(\"location-to-location-short\");\r\n    var toPlaceholder = $.i18n(\"location-to-location-long\");\r\n    var tabPanelHtml =\r\n        \"<div class=\\\"input-group mt-2 mb-2\\\">\" +\r\n        \"    <div class=\\\"input-group-prepend\\\">\" +\r\n        \"        <span class=\\\"input-group-text\\\" id=\\\"from-location-text\\\">\" + fromPrepend + \"</span>\" +\r\n        \"    </div>\" +\r\n        \"    <input type=\\\"text\\\" class=\\\"form-control select-location-field from-location-field\\\" placeholder=\\\"\" + fromPlaceholder + \"\\\" aria-label=\\\"\" + fromPlaceholder + \"\\\" aria-describedby=\\\"from-location-text\\\" readonly>\" +\r\n        \"</div>\" +\r\n        \"<div class=\\\"input-group mb-2\\\">\" +\r\n        \"    <div class=\\\"input-group-prepend\\\">\" +\r\n        \"        <span class=\\\"input-group-text\\\" id=\\\"to-location-text\\\">\" + toPrepend + \"</span>\" +\r\n        \"    </div>\" +\r\n        \"    <input type=\\\"text\\\" class=\\\"form-control select-location-field to-location-field\\\" placeholder=\\\"\" + toPlaceholder + \"\\\" aria-label=\\\"\" + toPlaceholder + \"\\\" aria-describedby=\\\"to-location-text\\\" readonly>\" +\r\n        \"</div>\"\r\n        ;\r\n    $(\".tab-panel\").html(tabPanelHtml);\r\n\r\n    var itemListHtml =\r\n        \"<div class=\\\"row item-list navigation-results\\\">\" +\r\n        \"</div>\"\r\n        ;\r\n    $(\".content-panel-container\").html(itemListHtml);\r\n\r\n    if (Loc.isLocated()) {\r\n        var currentLoc = Loc.getCurrentPosition();\r\n        fromPos = currentLoc;\r\n        posToName(currentLoc).then(fromName => {\r\n            $(\".from-location-field\").val(fromName);\r\n        });\r\n    }\r\n\r\n    $(\".from-location-field\").on(\"click\", selectFromLocation);\r\n\r\n    $(\".to-location-field\").on(\"click\", selectToLocation);\r\n}\r\n\r\nexport function disable() {\r\n    fromPos = false;\r\n    fromName = false;\r\n    toPos = false;\r\n    toName = false;\r\n}\r\n\r\nasync function posToName(pos) {\r\n    var nearbyStops = await gtfs.searchNearbyStops(pos.lat, pos.lng, 1, true);\r\n    if (nearbyStops.length > 0) {\r\n        var localizedName = Lang.localizedKey(nearbyStops[0].stop, \"stop_name\");\r\n        return gtfs.selectFirstAgencyStopName(localizedName);\r\n    } else {\r\n        return (Math.round(pos.lat * 10000000) / 10000000) + \", \" + (Math.round(pos.lng * 10000000) / 10000000);\r\n    }\r\n}","import * as UI from './gtw-ui';\r\nimport * as Map from './gtw-map';\r\nimport * as Event from './gtw-event';\r\n\r\nvar selectedLocation = false;\r\nvar marker = false;\r\nvar eventCenterChgListener = false;\r\n\r\nfunction show(text) {\r\n    selectedLocation = false;\r\n\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n\r\n    if (eventCenterChgListener) {\r\n        Event.removeListener(Event.EVENTS.EVENT_MAP_CENTER_CHANGED, eventCenterChgListener);\r\n        eventCenterChgListener = false;\r\n    }\r\n\r\n    var center = Map.getCenter();\r\n    marker = Map.addMarker(center);\r\n    Event.addListener(Event.EVENTS.EVENT_MAP_CENTER_CHANGED, eventCenterChgListener = function (loc) {\r\n        Map.setMarkerPosition(marker, loc);\r\n    });\r\n\r\n    $(\".ui-pull-up-btn\").css(\"display\", \"none\");\r\n    $(\".ui-pull-down-btn\").css(\"display\", \"none\");\r\n    $(\".mobile-split-container\").css(\"height\", \"20%\");\r\n    $(\".split-map-container\").html(\"\");\r\n\r\n    if (!text) {\r\n        text = $.i18n(\"location-move-to-desired-location\");\r\n    }\r\n\r\n    var tabPanelHtml =\r\n        \"<div class=\\\"text-center\\\">\" +\r\n        \"    <p class=\\\"lead\\\">\" + text + \"</p>\" +\r\n        \"    <button class=\\\"btn btn-block btn-success location-move-confirm\\\" type=\\\"button\\\">\" + $.i18n(\"location-move-to-desired-location-confirm-btn\") + \"</button>\" +\r\n        \"</div>\"\r\n        ;\r\n    $(\".split-map-tab-panel\").html(tabPanelHtml);\r\n\r\n    $(\".location-move-confirm\").on(\"click\", function () {\r\n        selectedLocation = Map.getCenter();\r\n        Event.dispatchEvent(Event.EVENTS.EVENT_LOCATION_SELECTED, selectedLocation);\r\n        UI.showPanel();\r\n    });\r\n\r\n    UI.hidePanel();\r\n}\r\n\r\nexport async function select(text) {\r\n    show(text);\r\n    var selectedListener;\r\n    var backListener;\r\n    var val = await new Promise((resolve, reject) => {\r\n        Event.addListener(Event.EVENTS.EVENT_LOCATION_SELECTED, selectedListener = function (loc) {\r\n            resolve(loc);\r\n        });\r\n        Event.addListener(Event.EVENTS.EVENT_UI_BACK, backListener = function () {\r\n            resolve(false);\r\n        });\r\n    });\r\n    Event.removeListener(Event.EVENTS.EVENT_LOCATION_SELECTED, selectedListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_UI_BACK, backListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_MAP_CENTER_CHANGED, eventCenterChgListener);\r\n    $(\".ui-pull-up-btn\").css(\"display\", \"\");\r\n    $(\".ui-pull-down-btn\").css(\"display\", \"\");\r\n    $(\".mobile-split-container\").removeAttr(\"style\");\r\n    eventCenterChgListener = false;\r\n    Map.removeMarker(marker);\r\n    return val;\r\n}\r\n\r\nexport function getSelectedLocation() {\r\n    return selectedLocation;\r\n}"],"sourceRoot":""}