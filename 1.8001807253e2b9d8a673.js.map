{"version":3,"sources":["webpack:///./src/gtw-ui-touchkeypad.js","webpack:///./src/gtw-ui-tab-transit.js"],"names":["onClickListeners","mouseClickTouchKeypadValue","$","this","hasClass","listener","reset","each","removeClass","addClass","showTouchKeypad","css","adjustMargin","hideTouchKeypad","addListener","push","removeListener","index","indexOf","splice","setEnabled","keyMap","val","html","keys","Object","sort","a","b","charCodeAt","letterKeypadHtml","key","on","searchTimeout","updateStopEtaTimer","updateEtaTimer","allNearbyRoutes","maxRequest","touchKeypadListener","eventUiBackListener","eventLocChgListener","lastLat","lastLng","fromSearch","attr","filterProviderSort","listNodeCss","provider","length","searchRoutes","lastStop","stopId","path","rp","i","routeName","routes","searchList","route","paths","startsWith","bound","sim","search","availableKeypads","charAt","id","routeId","i18n","mouseEnterPreviewRoute","mouseClickSelectRoute","resetProviderSort","clearSearch","drawRouteOnMap","pos","dbStop","coords","lat","lng","title","stopName","label","parent","getRouteById","stop","pathStop","distance","nearestDistance","nearestStop","console","log","showRouteList","scroll","x","lastStopId","screen","width","node","icon","children","scrollIntoView","targetPos","clearInterval","func","content","p","etaProviders","selectedPath","parseInt","then","data","h","options","code","schedules","active","schedule","eta","Math","floor","time","serverTime","error","colspan","undefined","msg","isLive","Date","getHours","getMinutes","catch","err","showStopEta","setInterval","sstop","latlngs","parseFloat","updateEta","requestLen","fadeIn","max","fadeOut","result","text","badgeClass","calcEta","badge","findNearbyRoutes","range","allNearbyStops","testRange","append","ceil","maxNearbyBusDisplay","stopResult","routeResults","routeResult","round","enable","obj","searchText","slice","EVENT_UI_BACK","EVENT_LOCATION_CHANGE","newLoc","providers","buttonScroll","iprovider","image","type","TransitType","BUS","TRAIN","searchField","removeAttr","clearTimeout","setTimeout","disable"],"mappings":"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","file":"1.8001807253e2b9d8a673.js","sourcesContent":["var onClickListeners = [];\r\n\r\n$(\".touch-keypad-function-clear\").on(\"click\", mouseClickTouchKeypadValue);\r\n$(\".touch-keypad-function-backspace\").on(\"click\", mouseClickTouchKeypadValue);\r\n$(\".touch-keypad-value\").on(\"click\", mouseClickTouchKeypadValue);\r\n\r\nfunction mouseClickTouchKeypadValue() {\r\n    if ($(this).hasClass(\"disabled\")) {\r\n        return;\r\n    }\r\n    for (var listener of onClickListeners) {\r\n        listener(this);\r\n    }\r\n}\r\n\r\nexport function reset() {\r\n    $(\".numeric-keypad .touch-keypad-value\").each(function () {\r\n        $(this).removeClass(\"disabled\");\r\n        $(this).removeClass(\"btn-secondary\");\r\n        $(this).addClass(\"btn-outline-secondary\");\r\n    });\r\n}\r\n\r\nexport function showTouchKeypad() {\r\n    $(\".touch-keypad\").css(\"display\", \"flex\");\r\n    adjustMargin();\r\n}\r\n\r\nexport function hideTouchKeypad() {\r\n    $(\".touch-keypad\").css(\"display\", \"\");\r\n    adjustMargin();\r\n}\r\n\r\nexport function addListener(listener) {\r\n    if (typeof listener !== \"function\") {\r\n        return false;\r\n    }\r\n    onClickListeners.push(listener);\r\n    return true;\r\n}\r\n\r\nexport function removeListener(listener) {\r\n    if (typeof listener !== \"function\") {\r\n        return false;\r\n    }\r\n    var index = onClickListeners.indexOf(listener);\r\n    if (index !== -1) {\r\n        onClickListeners.splice(index, 1);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function setEnabled(keyMap) {\r\n    $(\".numeric-keypad .touch-keypad-value\").each(function () {\r\n        var val = $(this).html();\r\n        if (!keyMap[val]) {\r\n            $(this).addClass(\"disabled\");\r\n            $(this).addClass(\"btn-secondary\");\r\n            $(this).removeClass(\"btn-outline-secondary\");\r\n        } else {\r\n            $(this).removeClass(\"disabled\");\r\n            $(this).removeClass(\"btn-secondary\");\r\n            $(this).addClass(\"btn-outline-secondary\");\r\n        }\r\n        delete keyMap[val];\r\n    });\r\n\r\n    var keys = Object.keys(keyMap);\r\n    keys.sort(function (a, b) {\r\n        return a.charCodeAt(0) - b.charCodeAt(0);\r\n    });\r\n\r\n    var letterKeypadHtml = \"\";\r\n    for (var key of keys) {\r\n        letterKeypadHtml += \"<button type=\\\"button\\\" class=\\\"btn btn-outline-secondary py-3 touch-keypad-key touch-keypad-value\\\">\" + key + \"</button>\";\r\n    }\r\n    $(\".letter-keypad\").html(letterKeypadHtml);\r\n\r\n    $(\".letter-keypad .touch-keypad-value\").on(\"click\", mouseClickTouchKeypadValue);\r\n}","import * as Transit from './gtw-citydata-transit';\r\nimport * as TransitRoutes from './gtw-citydata-transit-routes';\r\nimport * as TransitStops from './gtw-citydata-transit-stops';\r\nimport * as TransitEta from './gtw-citydata-transit-eta';\r\nimport * as RequestLimiter from './gtw-requestlimiter';\r\nimport * as Settings from './gtw-settings';\r\nimport * as Misc from './gtw-misc';\r\nimport * as Lang from './gtw-lang';\r\nimport * as Loc from './gtw-location';\r\nimport * as TouchKeypad from './gtw-ui-touchkeypad';\r\nimport * as Event from './gtw-event';\r\nimport * as UI from './gtw-ui';\r\nimport * as Map from './gtw-map';\r\n\r\nvar searchTimeout;\r\nvar updateStopEtaTimer;\r\nvar updateEtaTimer;\r\nvar allNearbyRoutes;\r\nvar maxRequest;\r\nvar touchKeypadListener;\r\nvar eventUiBackListener;\r\nvar eventLocChgListener;\r\nvar lastLat = false;\r\nvar lastLng = false;\r\nvar fromSearch = false;\r\n\r\nfunction showTouchKeypad() {\r\n    $(\"#search-transit-text\").removeAttr(\"readonly\");\r\n    TouchKeypad.showTouchKeypad();\r\n}\r\n\r\nfunction hideTouchKeypad() {\r\n    $(\"#search-transit-text\").attr(\"readonly\", \"readonly\");\r\n    TouchKeypad.hideTouchKeypad();\r\n}\r\n\r\nfunction showSearchRoutes() {\r\n    $(\"#button-cancel-search\").removeClass(\"btn-light\");\r\n    $(\"#button-cancel-search\").removeClass(\"disabled\");\r\n    $(\"#button-cancel-search\").addClass(\"btn-danger\");\r\n    $(\"#button-cancel-search\").html(\"<i class=\\\"fas fa-times\\\"></i>\");\r\n\r\n    $(\".nearby-route-list\").css(\"display\", \"none\");\r\n    $(\".all-route-list\").css(\"display\", \"flex\");\r\n    Map.setCenter(Loc.getCurrentPosition());\r\n    Map.setZoom(16);\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n    searchRoutes();\r\n    resetProviderSort();\r\n    filterProviderSort(\".all-route-list\");\r\n}\r\n\r\nfunction hideSearchRoutes() {\r\n    $(\"#button-cancel-search\").addClass(\"btn-light\");\r\n    $(\"#button-cancel-search\").addClass(\"disabled\");\r\n    $(\"#button-cancel-search\").removeClass(\"btn-danger\");\r\n    $(\"#button-cancel-search\").html(\"<i class=\\\"fas fa-search\\\"></i>\");\r\n\r\n    $(\".nearby-route-list\").css(\"display\", \"flex\");\r\n    $(\".all-route-list\").css(\"display\", \"none\");\r\n\r\n    Map.setCenter(Loc.getCurrentPosition());\r\n    Map.setZoom(16);\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n\r\n    resetProviderSort();\r\n    filterProviderSort(\".nearby-route-list\");\r\n}\r\n\r\nfunction filterProviderSort(listNodeCss) {\r\n    $(\".gtw-providersort-provider\").each(function () {\r\n        var provider = $(this).attr(\"gtw-provider\");\r\n        var contain = $(listNodeCss + \" .route-selection[gtw-provider='\" + provider + \"']\").length > 0;\r\n        if (contain) {\r\n            $(this).css(\"display\", \"\");\r\n        } else {\r\n            $(this).css(\"display\", \"none\");\r\n        }\r\n    });\r\n}\r\n\r\nfunction searchRoutes() {\r\n    var val = $(\"#search-transit-text\").val();\r\n    var useKeypad = true;\r\n    if (!useKeypad) {\r\n        clearSearch();\r\n        return;\r\n    }\r\n\r\n    var routes = TransitRoutes.getAllRoutes();\r\n\r\n    var lastStop;\r\n    var stopId;\r\n    var provider;\r\n    var path;\r\n    var rp;\r\n    var pp;\r\n    var sp;\r\n    var i;\r\n    var sim;\r\n    var routeName;\r\n    var providerName;\r\n    var stopName;\r\n    //var routeNameIncludes;\r\n\r\n    var searchList = [];\r\n\r\n    for (var route of routes) {\r\n        for (i = 0; i < route.paths.length; i++) {\r\n            path = route.paths[i];\r\n            stopId = path[path.length - 1];\r\n            provider = TransitRoutes.getProvider(route.provider);\r\n            lastStop = TransitStops.getStopById(stopId);\r\n\r\n            routeName = Lang.localizedKey(route, \"routeName\");\r\n            providerName = Lang.localizedKey(provider, \"name\");\r\n            stopName = Lang.localizedKey(lastStop, \"stopName\");\r\n\r\n            rp = Misc.similarity(routeName, val);\r\n            /*\r\n            pp = Misc.similarity(providerName, val);\r\n            sp = Misc.similarity(stopName, val);\r\n            routeNameIncludes = routeName.includes(val);\r\n\r\n            if (!routeNameIncludes && rp < 0.3 && pp < 0.3 && sp < 0.3) {\r\n                continue;\r\n            }\r\n            */\r\n            if (!routeName.startsWith(val)) {\r\n                continue;\r\n            }\r\n\r\n            //sim = Math.max(rp, pp, sp);\r\n\r\n            searchList.push({\r\n                provider: provider,\r\n                route: route,\r\n                bound: i,\r\n                lastStop: lastStop,\r\n                sim: rp\r\n                //routeNameIncludes: routeNameIncludes\r\n            });\r\n        }\r\n    }\r\n\r\n    searchList.sort(function (a, b) {\r\n        return b.sim - a.sim;\r\n    });\r\n\r\n    var html = \"<ul class=\\\"list-group\\\">\";\r\n\r\n    var search;\r\n    var availableKeypads = {};\r\n    for (i = 0; i < searchList.length; i++) {\r\n        search = searchList[i];\r\n        routeName = Lang.localizedKey(search.route, \"routeName\");\r\n\r\n        if (val.length < routeName.length) {\r\n            var letter = routeName.charAt(val.length);\r\n            availableKeypads[letter] = true;\r\n        }\r\n\r\n        if (i <= 20) {\r\n            html +=\r\n                \"<li class=\\\"list-group-item list-group-item-action d-flex align-items-center route-selection\\\" gtw-provider=\\\"\" + search.provider.id + \"\\\" gtw-route-id=\\\"\" + search.route.routeId + \"\\\" gtw-bound=\\\"\" + search.bound + \"\\\">\" +\r\n                \"    <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n                \"        <div>\" + Lang.localizedKey(search.provider, \"name\") + \"</div>\" +\r\n                \"        <div>\" + routeName + \"</div>\" +\r\n                \"    </div>\" +\r\n                \"    <div><b>\" + $.i18n(\"transit-eta-to\") + \":</b> \" + Lang.localizedKey(search.lastStop, \"stopName\") + \"</div>\" +\r\n                \"</li>\";\r\n        }\r\n    }\r\n\r\n    html += \"</ul>\";\r\n    $(\".all-route-list\").html(html);\r\n\r\n    TouchKeypad.setEnabled(availableKeypads);\r\n\r\n    $(\".all-route-list .route-selection\").on(\"mouseenter\", mouseEnterPreviewRoute);\r\n    $(\".all-route-list .route-selection\").on(\"click\", mouseClickSelectRoute);\r\n\r\n    //$(\".all-route-list .route-selection:nth-child(1)\").mouseenter();\r\n\r\n    filterProviderSort(\".all-route-list\");\r\n}\r\n\r\nfunction resetProviderSort() {\r\n    $(\".gtw-providersort\").removeClass(\"btn-primary\");\r\n    $(\".gtw-providersort-all\").addClass(\"btn-primary\");\r\n\r\n    //$(\".gtw-providersort-provider\").addClass(\"btn-default\");\r\n    $(\".route-selection\").attr(\"style\", \"\");\r\n}\r\n\r\nfunction clearSearch() {\r\n    hideTouchKeypad();\r\n    $(\"#search-transit-text\").val(\"\");\r\n    hideSearchRoutes();\r\n    TouchKeypad.reset();\r\n}\r\n\r\nfunction drawRouteOnMap(route, bound) {\r\n    var path = route.paths[bound];\r\n\r\n    var coords = [];\r\n    var pos;\r\n    var dbStop;\r\n    var i;\r\n    for (i = 0; i < path.length; i++) {\r\n        dbStop = TransitStops.getStopById(path[i]);\r\n        pos = { lat: dbStop.lat, lng: dbStop.lng };\r\n        coords.push(pos);\r\n        Map.addMarker(pos, {\r\n            title: dbStop.stopName,\r\n            label: \"\" + (i + 1)\r\n        });\r\n    }\r\n\r\n    Map.addPolyline(coords, \"#FF0000\", 2);\r\n}\r\n\r\nfunction mouseClickSelectRoute() {\r\n    fromSearch = $(this).parent().parent().hasClass(\"all-route-list\");\r\n\r\n    UI.hidePanel();\r\n    hideTouchKeypad();\r\n\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n\r\n    var provider = TransitRoutes.getProvider($(this).attr(\"gtw-provider\"));\r\n    var route = provider.getRouteById($(this).attr(\"gtw-route-id\"));\r\n    var stop = TransitStops.getStopById($(this).attr(\"gtw-stop-id\"));\r\n    var bound = $(this).attr(\"gtw-bound\");\r\n\r\n    if (!stop) {\r\n        var pos = Loc.getCurrentPosition();\r\n        var path = route.paths[bound];\r\n        var pathStop;\r\n        var distance;\r\n        var nearestDistance = false;\r\n        var nearestStop = false;\r\n        for (var stopId of path) {\r\n            pathStop = TransitStops.getStopById(stopId);\r\n            distance = Misc.geoDistance(pathStop.lat, pathStop.lng, pos.lat, pos.lng);\r\n            if (!nearestDistance || !nearestStop || distance < nearestDistance) {\r\n                nearestDistance = distance;\r\n                nearestStop = pathStop;\r\n            }\r\n        }\r\n\r\n        console.log(nearestDistance);\r\n        if (nearestDistance <= 2) {\r\n            stop = nearestStop;\r\n        }\r\n    }\r\n\r\n    showRouteList(route, bound, stop, true);\r\n    drawRouteOnMap(route, bound);\r\n}\r\n\r\nfunction mouseEnterPreviewRoute() {\r\n    Map.removeAllMarkers();\r\n    Map.removeAllPolylines();\r\n    var provider = TransitRoutes.getProvider($(this).attr(\"gtw-provider\"));\r\n    var route = provider.getRouteById($(this).attr(\"gtw-route-id\"));\r\n    var sstop = TransitStops.getStopById($(this).attr(\"gtw-stop-id\"));\r\n    var bound = $(this).attr(\"gtw-bound\");\r\n    drawRouteOnMap(route, bound);\r\n\r\n    if (sstop) {\r\n        var targetPos = { lat: sstop.lat, lng: sstop.lng };\r\n        Map.setCenter(targetPos);\r\n        Map.setZoom(18);\r\n    } else {\r\n        var path = route.paths[bound];\r\n\r\n        var latlngs = [];\r\n        var stop;\r\n        for (var stopId of path) {\r\n            stop = TransitStops.getStopById(stopId);\r\n            latlngs.push({ lat: parseFloat(stop.lat), lng: parseFloat(stop.lng) });\r\n        }\r\n        Map.fitBounds(latlngs);\r\n    }\r\n}\r\n\r\nfunction showRouteList(route, bound, stop = false, scroll = false) {\r\n    var html = \"<div class=\\\"row\\\" style=\\\"padding: 2%;\\\"><div class=\\\"timeline-centered\\\">\";\r\n    var path = route.paths[bound];\r\n    var dbStop;\r\n    var i;\r\n    for (i = 0; i < path.length; i++) {\r\n        dbStop = TransitStops.getStopById(path[i]);\r\n        html +=\r\n            \"<article class=\\\"timeline-entry\\\" stop-id=\\\"\" + dbStop.stopId + \"\\\" stop-index=\\\"\" + i + \"\\\">\" +\r\n            \"    <div class=\\\"timeline-entry-inner\\\">\" +\r\n            \"        <div class=\\\"timeline-icon bg-light\\\">\" +\r\n            \"            \" + (i + 1) +\r\n            \"        </div>\" +\r\n            \"        <div class=\\\"timeline-label\\\">\" +\r\n            \"            <h2><button style=\\\"padding: 0px;\\\" class=\\\"btn btn-link\\\" stop-id=\\\"\" + dbStop.stopId + \"\\\">\" + Lang.localizedKey(dbStop, \"stopName\") + \"</button></h2>\" +\r\n            \"            <p></p>\" +\r\n            \"        </div>\" +\r\n            \"    </div>\" +\r\n            \"</article>\"\r\n            ;\r\n    }\r\n    html += \"</div></div>\";\r\n    $(\".half-map-container\").html(html);\r\n\r\n    $(\".half-map-container button\").on(\"click\", function () {\r\n        var x = TransitStops.getStopById($(this).attr(\"stop-id\"));\r\n        if (x) {\r\n            showRouteList(route, bound, x);\r\n        }\r\n    });\r\n\r\n    var provider = TransitRoutes.getProvider(route.provider);\r\n    var lastStopId = path[path.length - 1];\r\n    html =\r\n        \"<ul class=\\\"list-group\\\"><li class=\\\"list-group-item d-flex align-items-center route-selection\\\">\" +\r\n        \"    <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n        \"        <div>\" + Lang.localizedKey(provider, \"name\") + \"</div>\" +\r\n        \"        <div>\" + Lang.localizedKey(route, \"routeName\") + \"</div>\" +\r\n        \"    </div>\" +\r\n        \"    <div><b>\" + $.i18n(\"transit-eta-to\") + \":</b> \" + Lang.localizedKey(TransitStops.getStopById(lastStopId), \"stopName\") + \"</div>\" +\r\n        \"</li></ul>\"\r\n        ;\r\n    $(\".half-map-tab-panel\").html(html);\r\n\r\n    adjustMargin();\r\n    if (stop) {\r\n        var parent = screen.width >= 768 ? \".desktop\" : \".mobile\";\r\n\r\n        var node = $(parent + \" .timeline-entry[stop-id='\" + stop.stopId + \"']\");\r\n\r\n        var icon = node.children().children(\".timeline-icon\");\r\n        icon.removeClass(\"bg-light\");\r\n        icon.addClass(\"bg-primary\");\r\n\r\n        if (scroll) {\r\n            node[0].scrollIntoView();\r\n        }\r\n\r\n        var targetPos = { lat: stop.lat, lng: stop.lng };\r\n\r\n        Map.setCenter(targetPos);\r\n        Map.setZoom(18);\r\n\r\n        clearInterval(updateStopEtaTimer);\r\n        var func = function () {\r\n            showStopEta(route, bound, stop);\r\n        };\r\n        func();\r\n        updateStopEtaTimer = setInterval(func, 30000);\r\n    }\r\n}\r\n\r\nfunction showStopEta(route, bound, stop) {\r\n    var node = $(\".timeline-entry[stop-id='\" + stop.stopId + \"'] p\");\r\n\r\n    var content =\r\n        \"<p><u>\" + $.i18n(\"transit-eta\") + \"</u></p>\" +\r\n        \"<table class=\\\"table stop-eta\\\">\"\r\n        ;\r\n\r\n    var p = TransitEta.fetchEta({\r\n        provider: route.provider,\r\n        etaProviders: route.etaProviders,\r\n        routeId: route.routeId,\r\n        selectedPath: parseInt(bound),\r\n        stopId: stop.stopId\r\n    });\r\n    if (!p) {\r\n        content +=\r\n            \"<tr class=\\\"table-dark\\\">\" +\r\n            \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-route-not-available\") + \"</td>\" +\r\n            //\"    <td>---</td>\" +\r\n            \"</tr>\"\r\n            ;\r\n    } else {\r\n        content +=\r\n            \"<tr class=\\\"table-dark\\\">\" +\r\n            \"    <td colspan=\\\"4\\\"><div class=\\\"spinner-border spinner-border-sm\\\" role=\\\"status\\\"></div> \" + $.i18n(\"transit-eta-retrieving-data\") + \"</td>\" +\r\n            \"</tr>\";\r\n        p.then(function (data) {\r\n            var h = data.options;\r\n            var content = \"\";\r\n            var node = $(\".timeline-entry[stop-id='\" + h.stopId + \"'] p table tbody\");\r\n            if (data.code && data.code === -2) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-eta-providers\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else if (!data.schedules || data.code && data.code === -1) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-data-received\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else if (data.schedules.length === 0) {\r\n                content +=\r\n                    \"<tr class=\\\"table-dark\\\">\" +\r\n                    \"    <td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-no-schedules-pending\") + \"</td>\" +\r\n                    //\"    <td>---</td>\" +\r\n                    \"</tr>\"\r\n                    ;\r\n            } else {\r\n                var active = false;\r\n                for (var schedule of data.schedules) {\r\n                    var eta = Math.floor((schedule.time - schedule.serverTime) / 1000 / 60);\r\n\r\n                    var html = \"<tr class=\\\"table-\";\r\n\r\n                    if (eta >= 20) {\r\n                        html += \"secondary\";\r\n                    } else if (eta >= 15) {\r\n                        html += \"info\";\r\n                    } else if (eta >= 10) {\r\n                        html += \"success\";\r\n                    } else if (eta >= 5) {\r\n                        html += \"warning\";\r\n                    } else if (eta >= 1) {\r\n                        html += \"danger\";\r\n                    } else {\r\n                        html += \"dark\";\r\n                    }\r\n\r\n                    if (!active && eta > 0) {\r\n                        active = true;\r\n                        html += \" active\";\r\n                    }\r\n\r\n                    html += \"\\\">\";\r\n\r\n                    //TODO: isOutdated\r\n\r\n                    var provider = TransitEta.getProvider(schedule.provider);\r\n                    if (!provider) {\r\n                        console.error(\"Error: Could not find TransitEta provider to get localized names: \" + schedule.provider);\r\n                        return;\r\n                    }\r\n\r\n                    var colspan = 4;\r\n\r\n                    if (h.etaProviders.length > 1) {\r\n                        html += \"<td>\" + Lang.localizedKey(provider, \"name\") + \"</td>\";\r\n                        colspan--;\r\n                    }\r\n\r\n                    if (schedule.msg !== undefined && schedule.time === undefined) {\r\n                        html += \"<td colspan=\\\"\" + colspan + \"\\\">\" + schedule.msg + \"</td>\";\r\n                    } else {\r\n                        html += \"<td>\";\r\n                        if (schedule.msg !== undefined) {\r\n                            html += schedule.msg;\r\n                        }\r\n                        if (schedule.time !== undefined) {\r\n                            if (schedule.msg !== undefined) {\r\n                                html += \"<br />\";\r\n                            }\r\n                            if (eta > 0) {\r\n                                html += $.i18n(\"transit-eta-minutes\", eta);\r\n                            } else {\r\n                                html += $.i18n(\"transit-eta-arrived-left\");\r\n                            }\r\n                        }\r\n\r\n                        html += \"</td><td\";\r\n\r\n                        if (schedule.isLive === undefined) {\r\n                            html += \" colspan=\\\"2\\\"\";\r\n                        }\r\n\r\n                        html += \">\";\r\n\r\n                        var time = new Date(schedule.time);\r\n\r\n                        if (schedule.time !== undefined) {\r\n                            html += Misc.fillZero(time.getHours()) + \":\" + Misc.fillZero(time.getMinutes());\r\n                        } else {\r\n                            html += \"---\";\r\n                        }\r\n\r\n                        html += \"</td>\";\r\n\r\n                        if (schedule.isLive !== undefined) {\r\n                            if (schedule.isLive) {\r\n                                html += \"<td><span style=\\\"color: red; float: right; font-size: 10px;\\\"><i class=\\\"fa fa-circle\\\"></i> \" + $.i18n(\"transit-eta-live\") + \"</span></td>\";\r\n                            } else {\r\n                                html += \"<td><span style=\\\"font-size: 10px; float: right; font-style: italic;\\\">\" + $.i18n(\"transit-eta-scheduled\") + \"</span></td>\";\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    //TODO: Features\r\n\r\n                    html += \"</tr>\";\r\n                    content += html;\r\n                }\r\n            }\r\n            node.html(content);\r\n        }).catch(function (options, err) {\r\n            var node = $(\".timeline-entry[stop-id='\" + options.stopId + \"'] p table tbody\");\r\n            node.html(\"<tr class=\\\"table-danger\\\"><td colspan=\\\"4\\\">\" + $.i18n(\"transit-eta-error-fetching-eta\") + \"</td></tr>\");\r\n        });\r\n    }\r\n\r\n    content += \"</table>\";\r\n\r\n    node.html(content);\r\n}\r\n\r\nfunction updateEta() {\r\n    var requestLen = RequestLimiter.requests.length;\r\n    if (requestLen > 0) {\r\n        $(\".request-progress-panel\").fadeIn(500);\r\n\r\n        var max = maxRequest;\r\n        if (!max || requestLen > max) {\r\n            max = maxRequest = requestLen;\r\n        }\r\n\r\n        $(\".request-progress-panel .progress-bar\").html($.i18n(\"transit-eta-requesting-data\", max - requestLen, max));\r\n        //$(\".request-progress-panel .progress-bar\").html(Math.floor((max - requestLen) / max * 100) + \"%\");\r\n        $(\".request-progress-panel .progress-bar\").css(\"width\", Math.floor((max - requestLen) / max * 100) + \"%\");\r\n    } else {\r\n        maxRequest = 0;\r\n        $(\".request-progress-panel .progress-bar\").css(\"width\", \"100%\");\r\n        $(\".request-progress-panel\").fadeOut(500, function () {\r\n            $(\".request-progress-panel .progress-bar\").css(\"width\", \"0%\");\r\n        });\r\n    }\r\n    //var h;\r\n    for (var result of allNearbyRoutes) {\r\n        var p = TransitEta.fetchEta({\r\n            provider: result.route.provider,\r\n            etaProviders: result.route.etaProviders,\r\n            routeId: result.route.routeId,\r\n            selectedPath: result.bound,\r\n            stopId: result.stop.stopId\r\n        });\r\n        p.then(function (eta) {\r\n            var text = \"\";\r\n            var h = eta.options;\r\n\r\n            var node = $(\".nearby-route-list .route-selection[gtw-provider=\\\"\" + h.provider + \"\\\"][gtw-route-id=\\\"\" + h.routeId + \"\\\"][gtw-bound=\\\"\" + h.selectedPath + \"\\\"][gtw-stop-id=\\\"\" + h.stopId + \"\\\"]\");\r\n\r\n            node.removeClass(\"list-group-item-secondary\");\r\n            node.removeClass(\"list-group-item-info\");\r\n            node.removeClass(\"list-group-item-success\");\r\n            node.removeClass(\"list-group-item-warning\");\r\n            node.removeClass(\"list-group-item-danger\");\r\n            node.removeClass(\"list-group-item-light\");\r\n            node.removeClass(\"list-group-item-dark\");\r\n\r\n            var badgeClass = \"btn-secondary\";\r\n\r\n            if (!eta || !eta.schedules || eta.code && eta.code < 0) {\r\n                text = $.i18n(\"transit-eta-route-not-available-short\");\r\n                node.addClass(\"list-group-item-light\");\r\n            } else if (eta.schedules.length === 0) {\r\n                text = $.i18n(\"transit-eta-no-schedules-pending-short\");\r\n                node.addClass(\"list-group-item-light\");\r\n            } else {\r\n                var schedule = eta.schedules[0];\r\n\r\n                var calcEta = Math.floor((schedule.time - schedule.serverTime) / 1000 / 60);\r\n\r\n                var css = \"\";\r\n\r\n                if (calcEta >= 20) {\r\n                    css = \"secondary\";\r\n                } else if (calcEta >= 15) {\r\n                    css = \"info\";\r\n                } else if (calcEta >= 10) {\r\n                    css = \"success\";\r\n                } else if (calcEta >= 5) {\r\n                    css = \"warning\";\r\n                } else if (calcEta >= 1) {\r\n                    css = \"danger\";\r\n                } else {\r\n                    css = \"dark\";\r\n                }\r\n                node.addClass(\"list-group-item-\" + css);\r\n\r\n                //TODO: isOutdated\r\n\r\n                if (schedule.msg !== undefined) {\r\n                    var msg = schedule.msg;\r\n                    if (msg.length > 20) {\r\n                        text = $.i18n(\"transit-eta-transit-notice\");\r\n                    } else {\r\n                        text = schedule.msg;\r\n                    }\r\n                    badgeClass = \"badge-warning\";\r\n                } else if (schedule.time !== undefined) {\r\n                    if (schedule.msg !== undefined) {\r\n                        text += \"<br />\";\r\n                    }\r\n\r\n                    badgeClass = \"badge-primary\";\r\n                    if (calcEta > 0) {\r\n                        text += $.i18n(\"transit-eta-minutes\", calcEta);\r\n                    } else {\r\n                        text += $.i18n(\"transit-eta-arrived-left\", calcEta);\r\n                        badgeClass = \"badge-dark\";\r\n                    }\r\n\r\n                    if (schedule.isLive !== undefined) {\r\n                        text += \"<br /><span style=\\\"font-size: 10px; position: absolute; top: 16px; right: 16px; \";\r\n                        if (schedule.isLive) {\r\n                            text += \"color: red;\\\"><i class=\\\"fa fa-circle\\\"></i> \" + $.i18n(\"transit-eta-live\") + \"</span>\";\r\n                        } else {\r\n                            text += \"color: black; font-style: italic;\\\">\" + $.i18n(\"transit-eta-scheduled\") + \"</span>\";\r\n                        }\r\n                    }\r\n                }\r\n\r\n                /*\r\n                if (schedule.hasTime) {\r\n                    text += Misc.fillZero(schedule.time.hr) + \":\" + Misc.fillZero(schedule.time.min);\r\n                } else {\r\n                    text += \"---\";\r\n                }\r\n                */\r\n\r\n                //TODO: Features\r\n            }\r\n            var badge = node.children(\".transit-eta\");\r\n\r\n            badge.removeClass(\"badge-primary\");\r\n            badge.removeClass(\"badge-secondary\");\r\n            badge.removeClass(\"badge-warning\");\r\n            badge.removeClass(\"badge-danger\");\r\n            badge.removeClass(\"badge-dark\");\r\n            badge.addClass(badgeClass);\r\n\r\n            badge.html(text);\r\n        }).catch(function (options, err) {\r\n            var node = $(\".nearby-route-list .route-selection[gtw-provider=\\\"\" + options.provider + \"\\\"][gtw-route-id=\\\"\" + options.routeId + \"\\\"][gtw-bound=\\\"\" + options.selectedPath + \"\\\"][gtw-stop-id=\\\"\" + options.stopId + \"\\\"]\");\r\n\r\n            node.removeClass(\"list-group-item-secondary\");\r\n            node.removeClass(\"list-group-item-info\");\r\n            node.removeClass(\"list-group-item-success\");\r\n            node.removeClass(\"list-group-item-warning\");\r\n            node.removeClass(\"list-group-item-danger\");\r\n            node.removeClass(\"list-group-item-light\");\r\n            node.removeClass(\"list-group-item-dark\");\r\n            node.addClass(\"list-group-item-light\");\r\n\r\n            var badge = node.children(\".transit-eta\");\r\n\r\n            badge.removeClass(\"badge-primary\");\r\n            badge.removeClass(\"badge-secondary\");\r\n            badge.removeClass(\"badge-warning\");\r\n            badge.removeClass(\"badge-danger\");\r\n            badge.removeClass(\"badge-dark\");\r\n            badge.addClass(\"badge-danger\");\r\n\r\n            badge.html($.i18n(\"transit-eta-error-fetching-eta-short\"));\r\n        });\r\n    }\r\n}\r\n\r\nfunction findNearbyRoutes() {\r\n    clearInterval(updateEtaTimer);\r\n\r\n    var pos = Loc.getCurrentPosition();\r\n\r\n    var lat = pos.lat;\r\n    var lng = pos.lng;\r\n\r\n    lastLat = lat;\r\n    lastLng = lng;\r\n\r\n    var range = Settings.get(\"min_nearby_transit_range\", 200) / 1000.0;\r\n\r\n    var allNearbyStops = TransitStops.getAllStopsNearby(lat, lng, range, true, true);\r\n\r\n    if (allNearbyStops.length === 0) {\r\n        var testRange = range;\r\n        do {\r\n            testRange += 0.05;\r\n            allNearbyStops = TransitStops.getAllStopsNearby(lat, lng, testRange, true, true);\r\n        } while (allNearbyStops.length === 0 && testRange < 10);\r\n\r\n        if (testRange >= 10) {\r\n            $(\".tab-panel\").append(\r\n                \"<div class=\\\"alert alert-danger alert-dismissable\\\">\" +\r\n                \"<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\" aria-hidden=\\\"true\\\" >&#215;</button>\" +\r\n                \"No routes are found in 10 km range.\" +\r\n                \"</div>\"\r\n            );\r\n        } else {\r\n            $(\".tab-panel\").append(\r\n                \"<div class=\\\"alert alert-warning alert-dismissable\\\">\" +\r\n                \"<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\" aria-hidden=\\\"true\\\" >&#215;</button>\" +\r\n                $.i18n(\"transit-eta-no-routes-found-nearby-extended-range\", range * 1000, Math.ceil(testRange * 1000)) +\r\n                \"</div>\"\r\n            );\r\n        }\r\n    }\r\n\r\n    var maxNearbyBusDisplay = Settings.get(\"max_nearby_transit_to_display\", 20);\r\n    allNearbyRoutes = [];\r\n    for (var stopResult of allNearbyStops) {\r\n        if (allNearbyRoutes.length >= maxNearbyBusDisplay) {\r\n            break;\r\n        }\r\n\r\n        var routeResults = Transit.searchRoutesOfStop(stopResult.stop);\r\n\r\n        for (var routeResult of routeResults) {\r\n            allNearbyRoutes.push({\r\n                route: routeResult.route,\r\n                bound: routeResult.bound,\r\n                stop: stopResult.stop,\r\n                distance: stopResult.distance\r\n            });\r\n        }\r\n    }\r\n\r\n    var html;\r\n    var distance;\r\n    var paths;\r\n    var stopId;\r\n    var provider;\r\n    html = \"<div class=\\\"row item-list nearby-route-list\\\"><ul class=\\\"list-group\\\">\";\r\n    for (var result of allNearbyRoutes) {\r\n        paths = result.route.paths[result.bound];\r\n        stopId = paths[paths.length - 1];\r\n        distance = Math.round(result.distance * 1000);\r\n        provider = TransitRoutes.getProvider(result.route.provider);\r\n        html +=\r\n            \"    <li class=\\\"list-group-item list-group-item-action d-flex justify-content-between align-items-center route-selection\\\" gtw-provider=\\\"\" + result.route.provider + \"\\\" gtw-route-id=\\\"\" + result.route.routeId + \"\\\" gtw-stop-id=\\\"\" + result.stop.stopId + \"\\\" gtw-bound=\\\"\" + result.bound + \"\\\">\" +\r\n            \"        <div class=\\\"d-flex flex-column route-id\\\">\" +\r\n            \"            <div>\" + Lang.localizedKey(provider, \"name\") + \"</div>\" +\r\n            \"            <div>\" + Lang.localizedKey(result.route, \"routeName\") + \"</div>\" +\r\n            \"        </div>\" +\r\n            \"        <div class=\\\"d-flex flex-column stop-info mr-auto\\\">\" +\r\n            \"            <div>\" +\r\n            \"                <b>\" + $.i18n(\"transit-eta-to\") + \":</b> <small>\" + Lang.localizedKey(TransitStops.getStopById(stopId), \"stopName\") +\r\n            \"</small></div>\" +\r\n            \"            <div>\" +\r\n            \"                \" + Lang.localizedKey(result.stop, \"stopName\") + \" (\" + distance + $.i18n(\"transit-eta-metres\") + \")\" +\r\n            \"            </div>\" +\r\n            \"        </div>\" +\r\n            \"        <span class=\\\"badge badge-primary badge-pill transit-eta\\\">\" + $.i18n(\"transit-eta-retrieving\") + \"</span>\" +\r\n            \"    </li>\";\r\n    }\r\n    html += \"</ul></div><div class=\\\"row item-list all-route-list\\\"></div>\";\r\n\r\n    $(\".content-panel-container\").html(html);\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"mouseenter\", mouseEnterPreviewRoute);\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"mouseleave\", function () {\r\n        //Map.setCenter(Loc.getCurrentPosition());\r\n        //Map.setZoom(16);\r\n        //Map.removeAllMarkers();\r\n        //Map.removeAllPolylines();\r\n    });\r\n\r\n    $(\".nearby-route-list .route-selection\").on(\"click\", mouseClickSelectRoute);\r\n\r\n    filterProviderSort(\".nearby-route-list\");\r\n\r\n    updateEta();\r\n    updateEtaTimer = setInterval(updateEta, 30000);\r\n}\r\n\r\nexport function enable() {\r\n    RequestLimiter.clear();\r\n    TransitEta.clearCache();\r\n\r\n    TouchKeypad.addListener(touchKeypadListener = function (obj) {\r\n        var searchText;\r\n        if ($(obj).hasClass(\"touch-keypad-function-clear\")) {\r\n            clearSearch();\r\n        } else if ($(obj).hasClass(\"touch-keypad-function-backspace\")) {\r\n            searchText = $(\"#search-transit-text\").val();\r\n            $(\"#search-transit-text\").val(searchText.slice(0, -1));\r\n            searchRoutes();\r\n        } else if ($(obj).hasClass(\"touch-keypad-value\")) {\r\n            var val = $(obj).html();\r\n            searchText = $(\"#search-transit-text\").val();\r\n            $(\"#search-transit-text\").val(searchText + val);\r\n            searchRoutes();\r\n        }\r\n    });\r\n\r\n    Event.addListener(Event.EVENTS.EVENT_UI_BACK, eventUiBackListener = function (){\r\n        if (fromSearch) {\r\n            TouchKeypad.showTouchKeypad();\r\n        }\r\n        clearInterval(updateStopEtaTimer);\r\n    });\r\n\r\n    Event.addListener(Event.EVENTS.EVENT_LOCATION_CHANGE, eventLocChgListener = function () {\r\n        if (lastLat && lastLng) {\r\n            var newLoc = Loc.getCurrentPosition();\r\n            var dst = Misc.geoDistance(newLoc.lat, newLoc.lng, lastLat, lastLng);\r\n            if (dst > 0.025) {\r\n                console.log(\"Location moved 25 m away. Finding new nearby routes.\");\r\n                findNearbyRoutes();\r\n            }\r\n        }\r\n    });\r\n\r\n    var providers = TransitRoutes.getProviders();\r\n\r\n    if (providers.length > 0) {\r\n        var buttonScroll =\r\n            \"<div class=\\\"hori-scroll btn-group\\\">\" +\r\n            \"    <button type=\\\"button\\\" class=\\\"btn btn-primary gtw-providersort gtw-providersort-all\\\"><i class=\\\"fa fa-reply-all\\\"></i><br />\" + $.i18n(\"transit-eta-sort-all\") + \"</button>\";\r\n\r\n        for (var iprovider of providers) {\r\n            var image = \"\";\r\n            if (iprovider.type === TransitType.BUS) {\r\n                image = \"fa-bus\";\r\n            } else if (iprovider.type === TransitType.TRAIN) {\r\n                image = \"fa-train\";\r\n            } else {\r\n                image = \"fa-question\";\r\n            }\r\n            buttonScroll += \" <button type=\\\"button\\\" class=\\\"btn btn-default gtw-providersort gtw-providersort-provider\\\" gtw-provider=\\\"\" + iprovider.id + \"\\\"><i class=\\\"fa \" + image + \"\\\"></i><br />\" + Lang.localizedKey(iprovider, \"name\") + \"</button>\";\r\n        }\r\n\r\n        buttonScroll += \"</div>\";\r\n\r\n        $(\".tab-panel\").append(buttonScroll);\r\n\r\n        var searchField =\r\n            \"<div class=\\\"input-group mb-3\\\" style=\\\"margin-top: 16px;\\\">\" +\r\n            \"    <input type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"\" + $.i18n(\"transit-eta-placeholder-search-for-transit\") + \"\\\" aria-label=\\\"\" + $.i18n(\"transit-eta-placeholder-search-for-transit\") + \"\\\" aria-describedby=\\\"search-transit-icon\\\" id=\\\"search-transit-text\\\" readonly/>\" +\r\n            \"    <div class=\\\"input-group-append\\\">\" +\r\n            //\"        <span class=\\\"input-group-text\\\" id=\\\"search-transit-icon\\\"><i class=\\\"fas fa-search\\\"></i></span>\" +\r\n            \"        <button class=\\\"btn btn-light disabled\\\" type=\\\"button\\\" id=\\\"button-cancel-search\\\"><i class=\\\"fas fa-search\\\"></i></button>\" +\r\n            \"    </div>\" +\r\n            \"</div>\"\r\n            ;\r\n\r\n        $(\".tab-panel\").append(searchField);\r\n\r\n        var requestProgressBar =\r\n            \"<div class=\\\"request-progress-panel\\\">\" +\r\n            \"    <div class=\\\"progress bg-white\\\">\" +\r\n            \"        <div class=\\\"progress-bar progress-bar-striped progress-bar-animated\\\" role=\\\"progressbar\\\" style=\\\"width: 0%;\\\"></div>\" +\r\n            \"    </div>\" +\r\n            \"</div>\"\r\n            ;\r\n\r\n        $(\".tab-panel\").append(requestProgressBar);\r\n\r\n        $(\".gtw-providersort\").on(\"click\", function () {\r\n            if ($(this).hasClass(\"btn-primary\")) {\r\n                return;\r\n            }\r\n            //$(\".gtw-providersort\").removeClass(\"btn-default\");\r\n\r\n            if ($(this).hasClass(\"gtw-providersort-all\")) {\r\n                resetProviderSort();\r\n            } else {\r\n                $(\".gtw-providersort\").removeClass(\"btn-primary\");\r\n\r\n                var provider = $(this).attr(\"gtw-provider\");\r\n                $(this).addClass(\"btn-primary\");\r\n\r\n                $(\".gtw-providersort-provider:not([gtw-provider='\" + provider + \"'])\").addClass(\"btn-default\");\r\n                $(\".route-selection[gtw-provider='\" + provider + \"']\").attr(\"style\", \"\");\r\n                $(\".route-selection:not([gtw-provider='\" + provider + \"'])\").attr(\"style\", \"display: none!important\");\r\n            }\r\n        });\r\n\r\n        $(\"#button-cancel-search\").on(\"click\", function () {\r\n            if (!$(this).hasClass(\"disabled\")) {\r\n                clearSearch();\r\n            }\r\n        });\r\n\r\n        var useKeypad = true;\r\n        if (useKeypad) {\r\n            $(\"#search-transit-text\").on(\"click\", function () {\r\n                showTouchKeypad();\r\n                showSearchRoutes();\r\n            });\r\n        }\r\n\r\n        $(\"#search-transit-text\").on(\"input\", function () {\r\n            clearTimeout(searchTimeout);\r\n            searchTimeout = setTimeout(function () {\r\n                searchRoutes();\r\n            }, 500);\r\n        });\r\n\r\n        findNearbyRoutes();\r\n    } else {\r\n        //TODO: better message or auto add plugins according to region\r\n        $(\".tab-panel\").html(\"<br /><div class=\\\"alert alert-danger\\\" role=\\\"alert\\\"><i class=\\\"fas fa-exclamation-triangle\\\"></i> \" + $.i18n(\"transit-eta-no-plugins-providing-transit-data\") + \"</div>\");\r\n    }\r\n}\r\n\r\nexport function disable() {\r\n    TouchKeypad.removeListener(touchKeypadListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_UI_BACK, eventUiBackListener);\r\n    Event.removeListener(Event.EVENTS.EVENT_LOCATION_CHANGE, eventLocChgListener);\r\n    clearTimeout(searchTimeout);\r\n    clearInterval(updateEtaTimer);\r\n    clearInterval(updateStopEtaTimer);\r\n    searchTimeout = false;\r\n    updateEtaTimer = false;\r\n}"],"sourceRoot":""}